---
title: "Google Cloud Professional Cloud Security Engineerè©¦é¨“å—é¨“ãƒ¡ãƒ¢"
emoji: "ðŸ™"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GCP", "certificate", ]
published: false
---

## æ„Ÿæƒ³

- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å‹‰å¼·ã«ã‚‚ãªã£ã¦è‰¯ã‹ã£ãŸã€‚
- æ¥­å‹™ã«ã‚‚å½¹ç«‹ã¡ãã†ã€‚

## å—é¨“ã«ã¤ã„ã¦

- é«˜ç”°é¦¬å ´ãƒ†ã‚¹ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ã§å—é¨“
- è‹±èªžã§å—ã‘ãŸãŒã€åˆ¶é™æ™‚é–“ 2h ãªã®ã§ä½™è£•ã‚’ã‚‚ã£ã¦è¦‹ç›´ã›ã‚‹
- è©¦é¨“ä¼šå ´ã§è§£ç­”ã‚’æå‡ºãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ãã®å ´ã§åˆå¦ãŒåˆ†ã‹ã‚‹(å¾Œæ—¥æ­£å¼ãªçµæžœãŒå±Šã)

---

## å‹‰å¼·å†…å®¹ãƒ¡ãƒ¢ï¼ˆQAï¼‰

:::details GCP ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å®šç¾©ã‚’ç°¡æ½”ã«ã„ãˆ
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯èª²é‡‘ã•ã‚Œã‚‹å¯¾è±¡ã§ã€å†…éƒ¨ã«è¤‡æ•°ã€œ5 å€‹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æŒã¤ã‚‚ã®
[]()
![image.png](/images/20221015_professional-cloud-security-engineer/image.png)
:::

:::details VPC ã¨ã¯ï¼Ÿ

> A VPC network is a **global resource** that consists of a **list of regional virtual subnetworks (subnets) in data centers**, all connected by a global wide area network (WAN). VPC networks are logically isolated from each other in Google Cloud.

â‡’ ãƒªãƒ¼ã‚¸ãƒ§ãƒŠãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ãŒ VPC ã®ã‚µãƒ–ãƒãƒƒãƒˆã«å¯¾å¿œã—ã€ãã®é›†åˆä½“ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒä¸€ã¤ã®è«–ç†çš„ãª VPC ã‚’æ§‹æˆã—ã¦ã„ã‚‹ã€‚

- VPC ã® subnet ã¯ auto ãƒ¢ãƒ¼ãƒ‰ã§ region ã”ã¨ã«ä½œã‚‰ã‚Œã‚‹
- VM ä½œæˆæ™‚ã® NetworkInterface ã¯ VPC(ã®ä¸­ã®ã‚µãƒ–ãƒãƒƒãƒˆ)ã‚’é¸æŠžã§ãã‚‹ã€‚ãƒžã‚·ãƒ³ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ãã£ã¤ã‘ã‚‹æ„Ÿã˜ï¼Ÿ
  :::
  :::details VPC Network Peering ã¨ã¯? åŒã˜ peering ã§ã‚‚é•ã†ã‚µãƒ¼ãƒ“ã‚¹ã‚’æŒ‡ã—ã¦ã„ã‚‹ã‚‚ã®ã¯ä½•ï¼Ÿã¾ãŸã€SharedVPC ã¨ã®é•ã„ã¯ï¼Ÿ

## VPC Peering

[]()

- vpc network peering ã¯ VPC ã‚’å…±æœ‰ã™ã‚‹ä»•çµ„ã¿ã€‚GCP ã«æŽ¥ç¶šã™ã‚‹æ–¹æ³•ã®ä¸€ã¤ã§ã‚ã‚‹ direct/carrier peering ã¨ã¯åˆ¥ï¼å¾Œè€…ã®ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¯ã€BGP ã®çµŒè·¯ã‚’ GCP ã®ãƒ«ãƒ¼ã‚¿ã¨äº¤æ›ã—ã€ç›´æŽ¥ãƒ«ãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹ã€‚ãªã®ã§ externalIP ã®ã¿ã§ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã§ããªã„ã€‚
  - Direct Peering can only access external IP addresses.
- VPC Peering ã¯ VPC ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã ãŒã€ã‚ªãƒ³ãƒ—ãƒ¬ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã§ããªã„ï¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–“ã§ã®é–‰ã˜ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚
  ![image.png](/images/20221015_professional-cloud-security-engineer/image1.png)
- VPC network peering can be configured for different VPC networks **within and across organizations**.
- VPC peering ã¯è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¹‹ã’ã‚‰ã‚Œã€å†…éƒ¨ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãªã®ã§ã€VPN ãªã©ã®ã‚ˆã†ã«å¤–éƒ¨ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ä½¿ã†ã‚ˆã‚Šé«˜é€Ÿï¼
  []()
  ![image.png](/images/20221015_professional-cloud-security-engineer/image2.png)
  ã—ã‹ã‚‚ egress ã«èª²é‡‘ã•ã‚Œã‚‹ã®ã§ã€å†…éƒ¨ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã¯ã‚³ã‚¹ãƒˆãŒå®‰ã„ï¼
- DNS ã§ã¯åå‰è§£æ±ºã§ããªã„
  Compute Engine internal DNS names created in a network are not accessible to peered networks. The IP address of the VM should be used to reach the VM instances in peered network.
  â‡’ Internal DNS ã¯å„ VPC æ¯Žã«ä»˜å±žã™ã‚‹ãƒ¡ã‚¿ã‚µãƒ¼ãƒã®ä¸€ç¨®ãªã¯ãšãªã®ã§ã€åˆ¥ã® VPC ã‹ã‚‰ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã®ã§ã¯ï¼Ÿ
  - you cannot use a tag or service account from one peered network in the other peered network
    ï¼ˆè¿½è¨˜ï¼‰DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚¾ãƒ¼ãƒ³ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€Producer DNS ã‚¾ãƒ¼ãƒ³ã®åå‰ã‚’ Consumer DNS ã‚¾ãƒ¼ãƒ³ã‹ã‚‰å‚ç…§ã§ãã‚‹ã€‚ï¼ˆ[DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¨ã¯ï¼ŸVPC ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¨ã®é–¢ä¿‚æ€§ã¨é•ã„ã¯ä½•ã‹ï¼Ÿ](https://www.notion.so/Google-Cloud-Platform-Certified-Professional-Cloud-Security-Engineer-Exam-518b9659cac843419433812359bcd221)ï¼‰
- peering ã¯ k8sEngine ã§ã‚‚ä½¿ã‚ã‚Œã‚‹ã€‚
  â‡’ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ä½œã‚‹ã¨ã€ãã®ãƒžã‚¹ã‚¿ãƒ¼ãƒŽãƒ¼ãƒ‰ãŒ VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ peering ã™ã‚‹ï¼

## shared vpc

[]()
web service ã¨ã‹ã§ host pj ã¨ service pj ã§åˆ†ã‘ä¸­å¤®ã§ç®¡ç†ã™ã‚‹ã‚ˆã†ãªã¨ã
![image.png](/images/20221015_professional-cloud-security-engineer/image3.png)

- å„ service pj ã¨ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆé€šä¿¡ã§ãã‚‹
- host å´ã§ subnet ã‚’åˆ†ã‘ã‚‹
- ä¸­å¤®ã§ç®¡ç†
  â‡” peering ã¯ãã‚Œãžã‚Œã§ç®¡ç†

## shared vpc vs vpc peering

[]()
vpc peering wont allow connecting on-premise resources.
![image.png](/images/20221015_professional-cloud-security-engineer/image4.png)
â€» VPC Peering ã«ã¯ã„ã‚ã‚†ã‚‹**2-hop åˆ¶é™**ãŒã‚ã‚ŠæŽ¨ç§»çš„ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¯å‡ºæ¥ãªã„ã€‚ã¤ã¾ã‚Š 1:1 ã®åŒæ–¹å‘ã®ã¿ã€‚3 ã¤ä»¥ä¸Šã® VPC ã‚’å…±æœ‰ã™ã‚‹å ´åˆã€ãƒ•ãƒ«ãƒ¡ãƒƒã‚·ãƒ¥ã§ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚â‡” å…±æœ‰ VPC ãªã‚‰ã€è¤‡æ•°ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ VPC ã‚’å…±æœ‰ã—ã€ç®¡ç†æ©Ÿèƒ½ã‚’ãƒ›ã‚¹ãƒˆ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç¶­æŒã—ãŸã¾ã¾ã€ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€å…±æœ‰ VPC å†…ã® IP ã§ã® VM ä½œæˆã®ã¿ã«åˆ¶é™ã§ãã‚‹
â€» shared VPC ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–“ã®ã¿ã€‚çµ„ç¹”é–“ã‚„ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ã‚µãƒ–ãƒãƒƒãƒˆé–“ã®å…±æœ‰ã«ã¯ vpc peering ã‚’ä½¿ã†ï¼

- SharedVPC ã§ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç®¡ç†ã¨ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã‚’åˆ‡ã‚Šåˆ†ã‘ãŸã„å ´åˆã«æœ‰åŠ¹ã€‚ã‚¢ãƒ—ãƒªã‚„é–‹ç™ºã‚¤ãƒ³ãƒ•ãƒ©æ‹…å½“è€…ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¤‰æ›´ã¾ã§ã—ã¦æ¬²ã—ããªã„å ´åˆãªã©ã«æ¤œè¨Žã€‚

:::

:::details ADFS ã¨ã¯ï¼Ÿ
Active Directory Federation Services
Federationï¼šé€£æºã€é€£åˆ
ADFS ã¯ SSO ç’°å¢ƒã‚’æä¾›ã™ã‚‹ã‚‚ã®ã€‚ActiveDirectory ã®æ©Ÿèƒ½ã®ä¸€ã¤ã€‚ADFS ã¯åˆ©ç”¨è€…ã®èªè¨¼ã‚’è¡Œã„ã€ãã‚Œã‚’å„ã‚·ã‚¹ãƒ†ãƒ ã«ä¼é”ã™ã‚‹ã€€ IdPï¼šIdentity Provider ã€€ã¨ã—ã¦æŒ¯ã‚‹èˆžã†ã€‚
ADFS ã¨å„ã‚µãƒ¼ãƒ“ã‚¹ã¯åˆ©ç”¨è€…ã®è­˜åˆ¥æƒ…å ±ã¨èªè¨¼çŠ¶æ…‹ãªã©ã‚’é€šçŸ¥ã™ã‚‹ token ã¨ã‚’äº¤æ›ã—ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ã®ç§˜å¯†ã®æƒ…å ±ã®ç™»éŒ²ã‚„ç…§åˆãªã©ã¯ IdPï¼ˆADFSï¼‰å´ãŒé›†ä¸­çš„ã«ç®¡ç†ã™ã‚‹ã€‚
ãƒˆãƒ¼ã‚¯ãƒ³ã®å½¢å¼ã‚„ä¼é”æ–¹å¼ãªã©ã¯ WS-Federation ã‚„**[SAML](https://e-words.jp/w/SAML.html)**ã€**[OpenID Connect](https://e-words.jp/w/OpenID.html#Section_OpenIDConnect)**ãªã©ã®æ¨™æº–çš„ãªè¦æ ¼ã‚’åˆ©ç”¨ã™ã‚‹ã€‚

> In order to be able to keep using the existing identity management system, identities need to be synchronized between AD and GCP IAM. To do so google provides a tool called **Cloud Directory Sync**. This tool will read all identities in AD and replicate those within GCP.
> Once the identities have been replicated then it's possible to apply IAM permissions on the groups. After that you will configure SAML so google can act as a service provider and either your **ADFS** or other third party tools like Ping or Okta will act as the identity provider. This way you effectively delegate the authentication from Google to something that is under your control.

â€»Cloud Directory Sync ã¯ä¸€æ–¹å‘ã®ã¿ãªã®ã§ã€AD/LDAP å´ã‚’å¤‰æ›´ã—ã€å¤‰æ›´ã‚’é©å®œ Cloud Identity ã¸åŒæœŸã™ã‚‹ã€‚ç›´æŽ¥ Cloud Identity ã‚’ç·¨é›†ã™ã‚‹ã¨ã€é£Ÿã„é•ã„ãŒç™ºç”Ÿã™ã‚‹ã€‚

:::

:::details LDAP ã¨ã¯ï¼Ÿ

> LDAPï¼ˆLightweight Directory Access Protocolï¼‰ã¯ã€Active Directory ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ TCP ãƒãƒ¼ãƒˆç•ªå· 389 ã‚’ä½¿ç”¨ã—ã¦ LDAP ã‚µãƒ¼ãƒã«æŽ¥ç¶šã‚’è¡Œã„å±žæ€§ï¼ˆå€‹äººåã‚„éƒ¨ç½²åï¼‰ã§æ§‹æˆã™ã‚‹ã‚¨ãƒ³ãƒˆãƒªï¼ˆé–¢é€£å±žæ€§ã®ã¾ã¨ã¾ã‚Šï¼‰ã®æ¤œç´¢ã€è¿½åŠ ã€å‰Šé™¤ã®æ“ä½œã‚’ã™ã‚‹ã€‚

â€»LDAPSï¼šLDAP over SSL/TLS

:::

:::details SAML ã¨ã¯ã©ã“ã§ä½¿ã‚ã‚Œã‚‹ã‹ï¼ŸOAuthã€OIDC ã¨ã®é•ã„ã‚’ç°¡æ½”ã«èª¬æ˜Žã›ã‚ˆã€‚

ã‚·ãƒ³ã‚°ãƒ«ãƒ»ã‚µã‚¤ãƒ³ã‚ªãƒ³(SSO)ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã¨ã—ã¦ã€SAML ã¨ OAuth ã¨ãŒã‚ã‚‹ã€‚äº’ã„ã«ä»£æ›¿ã™ã‚‹ã¨ã„ã†ã‚ˆã‚Šè£œå®Œã—åˆã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚ä¾‹ãˆã° Microsoft ç’°å¢ƒã§ã¯ SAML ãŒã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä»˜ä¸Žã—ã€OAuth ãŒã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¨­å®šã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¿è­·ã™ã‚‹ã€‚OAuth ã¨ SAML ã¯ã©ã¡ã‚‰ã‚‚ã€ç›¸äº’é‹ç”¨ã‚’å¥¨åŠ±ã—æ¨™æº–åŒ–ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼å/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¢—åŠ ã—ç¶šã‘ã¦é‡è¦ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¦¨ã’ã‚‰ã‚Œã‚‹äº‹æ…‹ã‚’å›žé¿

- SAML(Security Assertion Markup Language)ã¯ã€Œèªè¨¼ã€ã«å¯¾å¿œã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã«ãªã‚‹å‚¾å‘ãŒã‚ã‚‹ã€‚æ¯Žæœã€ä»•äº‹ã‚’å§‹ã‚ã‚‹éš›ã«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ãã«ã¯ã€SAML ãŒä½¿ç”¨ã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã€‚SAML èªè¨¼ãŒå®Œäº†ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ä¼æ¥­ã®ã‚¤ãƒ³ãƒˆãƒ©ãƒãƒƒãƒˆã€Microsoft Officeã€ãƒ–ãƒ©ã‚¦ã‚¶ãªã©ã®ãƒ„ãƒ¼ãƒ«ã‚¹ã‚¤ãƒ¼ãƒˆå…¨ä½“ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚SAML ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ 1 ã¤ã®ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã§ã“ã‚Œã‚‰ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ã™ã¹ã¦åˆ©ç”¨ã§ãã‚‹ã€‚
  â€»SAML ã¯ SSO ã ã‘ã§ãªã MFA ã¨ã‹ãƒªã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹èªè¨¼ãªã©ã€æ§˜ã€…ãªèªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled.png)
- OAuth(Open Authorization)ã¯ã€Œèªå¯(æ‰¿èª)ã€ã«å¯¾å¿œã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã«ãªã‚‹å‚¾å‘ãŒã‚ã‚‹
  [SAML ã¨ OAuth ã®é•ã„ | IT ç®¡ç†ã‚¯ãƒ©ã‚¦ãƒ‰](https://i.moneyforward.com/resources/saml_sso)

### SAML ã«ã‚ˆã‚‹ SSO ã®ä»•çµ„ã¿

æ§˜ã€…ãªãƒ™ãƒ³ãƒ€ãŒã€XML å½¢å¼ã®ãƒžãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªžã«ã‚ˆã‚‹ SAML ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¯¾å¿œã—ãŸ IDasS(Identity As A Service)ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¦ã„ã‚‹ã€‚

- èªè¨¼æƒ…å ±ã‚’æä¾›ã™ã‚‹å´ã‚’ã€ŒIdPï¼ˆIdentity Providerï¼‰ã€
  â‡’ GCP ã® Cloud Identityã€oktaã€MicrosoftÂ® Azure Active Directory (Azure AD)ã€VMware Workspace One...etc
- èªè¨¼æƒ…å ±ã‚’åˆ©ç”¨ã™ã‚‹å´ã‚’ã€ŒSPï¼ˆService Providerï¼‰ã€
  â‡’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨ã™ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰å«ã‚€ã‚¢ãƒ—ãƒªã€ã‚µãƒ¼ãƒ“ã‚¹
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled1.png)

## OpenID Connect

SAML ã¨åŒã˜ã SSO ã®èªè¨¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€‚IdP ã¯ SAML ã ã‘ã§ãªãã€OIDC ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ã‚‚å¯¾å¿œã—ã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ã€‚ã—ã‹ã—ã€OpenID Connect ã¯ OAuth ã‚’æ‹¡å¼µã—ãŸè¦æ ¼ã§ã‚ã‚Šã€OAuth ã¨ä¸€ç·’ã«åˆ©ç”¨ã•ã‚Œã¦ã€Faceboook ã‚„ Twitter ãªã©ã® SNS èªè¨¼éƒ¨åˆ†ã‚’æ‹…ã†ã‚ˆã†ãªä½¿ã‚ã‚Œæ–¹ãŒå¤šã„ã€‚
â‡” SAML ã¯éžå¸¸ã«è¤‡é›‘ãªæ¨©é™ç®¡ç†ã‚’è¡Œã†ã“ã¨ãŒã§ãã€Active Directory ã®æ©Ÿèƒ½ã®ä¸€ã¤ã§ã‚ã‚‹ ADFSï¼ˆActive Directory Fereration Serviceï¼‰ã‚„ Okta ãªã© IDP ã‚µãƒ¼ãƒ“ã‚¹ã§ä¸»ã«ç”¨ã„ã‚‰ã‚Œã‚‹
![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled2.png)

:::

:::details SSO ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¨ SAML ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®é•ã„ã¯ï¼ŸSAML ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆã¨ã€SP ã¸ã®äº‹å‰ç™»éŒ²ã«ã¤ã„ã¦èª¬æ˜Žã›ã‚ˆã€‚

### SSO ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¨ SAML ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«

SSO ã®å®Ÿç¾æ‰‹æ®µã¨ã—ã¦ SAML ãŒä½¿ã‚ã‚Œã‚‹ã€‚SSO ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Cloud Identity ã¾ãŸã¯ Google Workspace ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãã‚Œã«å¯¾å¿œã™ã‚‹å¤–éƒ¨ IdP ã® ID ãŒå¿…è¦ã«ãªã‚‹ã€‚å¿…è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼/ã‚°ãƒ«ãƒ¼ãƒ—/çµ„ç¹”ã« SSO ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ï¼ˆIdP æ¯Žã«ï¼‰ä½œæˆã—ã€ãã‚Œã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ãŸã‚ã« SAML ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

> ã‚·ãƒ³ã‚°ãƒ« ã‚µã‚¤ãƒ³ã‚ªãƒ³ï¼ˆSSOï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã« Cloud Identity ã¾ãŸã¯ Google Workspace ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ§‹æˆã§ãã¾ã™ã€‚SSO ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ Google ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ã‚’æ±‚ã‚ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«ã€å¤–éƒ¨ ID ãƒ—ãƒ­ãƒã‚¤ãƒ€ï¼ˆIdPï¼‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™ã€‚ï¼ˆ**SP Initiated SSO**ï¼‰

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒžãƒƒãƒ”ãƒ³ã‚°ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒžã‚¹ã‚¯ã‚’ä½¿ã£ã¦ SSO ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åˆ¶é™ã§ãã‚‹

> Users with an IP address in the range specified for the Network masks can continue using SSO, while users with IP addresses not in the range of the Network masks must use a password-based login. For example, you can use the Network masks to allow desktop users to use SSO and mobile users to use a password-based login.

SAML SSO ã®æµã‚Œï¼ˆSP Initiated SSOï¼‰
![https://cdn-ak.f.st-hatena.com/images/fotolife/c/cybozuinsideout/20180821/20180821170728.png](https://cdn-ak.f.st-hatena.com/images/fotolife/c/cybozuinsideout/20180821/20180821170728.png)

â€»èªè¨¼ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒ SP ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‹ã‚‰å§‹ã¾ã‚‹ SSO ã‚’ã€**SP Initiated SSO**ã¨å‘¼ã¶
â€»SP ã‹ã‚‰ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆçµŒç”±ã§ã¯ãªãã€IdP ã‹ã‚‰ç›´æŽ¥ SP ã¸è¡Œãå ´åˆï¼ˆ4â†’8ï¼‰**IdP initiated SSO**

### SAML ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆ

SAML ã¯è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ§‹æˆã•ã‚Œã€çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚Šæ§˜ã€…ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã§ãã‚‹ã€‚ä¿¡é ¼é–¢ä¿‚ãŒç¢ºç«‹ã•ã‚ŒãŸçµ„ç¹”é–“ã§ IDãƒ»èªè¨¼ãƒ»å±žæ€§ãƒ»èªå¯ã®æƒ…å ±ï¼ˆï¼ SAML ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‚’ä¼é”ã™ã‚‹ã€‚SAML ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¯ Bindings ã«ã‚ˆã£ã¦ Protocols ã¨ BIND ã•ã‚Œã‚‹ã€‚
![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled3.png)
[SAML Tech OverView SAML Architecture ãƒ¡ãƒ¢ - pikesaku's blog](https://pikesaku.hatenablog.com/entry/2022/04/10/084631)

### SP ã¸ã®äº‹å‰ç™»éŒ²ï¼ˆGCP ã‚’ SP ã¨ã™ã‚‹å ´åˆï¼‰

SAML ã§ SSO ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€äº‹å‰ã« IdP ã¨ SP ã®é–“ã§ä¿¡é ¼é–¢ä¿‚ã‚’æ§‹ç¯‰ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã® IdP æ¯Žã« SSO ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ˆã‹ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼/ã‚°ãƒ«ãƒ¼ãƒ—/çµ„ç¹”ã«å‰²ã‚Šå½“ã¦ã‚‹ï¼‰ã€‚ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚„ã€å…¬é–‹éµã®ç™»éŒ²ãªã©ã§å®Ÿç¾ã™ã‚‹ã€‚

- Apigee ã¸ã® IdP ã®äº‹å‰ç™»éŒ²ã®ä¾‹
  Use **openssl** to generate public and private keys.
  Store the public key in an X.509 certificate, and encrypt using RSA or DSA for SAML
:::

:::details ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã€è¨¼æ˜Žæ›¸ãƒã‚§ãƒ¼ãƒ³ã€X.509 ã«ã¤ã„ã¦å®Œçµã«èª¬æ˜Žã›ã‚ˆ
### ãƒ‡ã‚¸ã‚¿ãƒ«ç½²å
ã€Œ**ç§˜å¯†éµ**ã‚’ç”¨ã„ã¦ç”Ÿæˆã•ã‚ŒãŸ**ç½²å**ã‚’**å…¬é–‹éµ**ã§**æ¤œè¨¼**ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã€ã€Œãƒ‡ãƒ¼ã‚¿ãŒæ”¹ç«„ã•ã‚Œã¦ã„ãªã„ã“ã¨ã€ã‚„ã€Œç§˜å¯†éµã®ä¿æŒè€…ãŒç¢ºã‹ã«ç½²åã—ãŸã“ã¨ã€ã‚’ç¢ºèªã™ã‚‹
æµã‚Œ
1. ç§˜å¯†éµã¨å…¬é–‹éµã®ãƒšã‚¢ã‚’ä½œã‚‹ã€‚
2. ç›¸æ‰‹ã«é€ã‚ŠãŸã„ãƒ‡ãƒ¼ã‚¿ã‚’ç§˜å¯†éµã‚’ç”¨ã„ã¦ç½²åã«å¤‰æ›ã—ã€ãƒ‡ãƒ¼ã‚¿ï¼‹ç½²åã‚’ç›¸æ‰‹ã«é€ã‚‹ã€‚â†’ ã“ã‚Œã£ã¦ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚·ãƒ¥ã‚’ç§˜å¯†éµã§æš—å·åŒ–ã™ã‚Œã°ã€ãã‚Œã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ã¤ã¾ã‚Šãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã£ã¦æ”¹ã–ã‚“æ¤œçŸ¥ã¨ã‹ã«ä½¿ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆã®ã“ã¨ã‹ï¼ï¼Ÿå—å–ã‚Šå´ã§ã¯å…¬é–‹éµã§å¾©å·ã—ãŸãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚·ãƒ¥å€¤ã¨ã€è‡ªåˆ†ã§è¨ˆç®—ã—ãŸãƒãƒƒã‚·ãƒ¥ã‚’æ¯”è¼ƒã—ã¦æ”¹ç«„ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèªã§ãã‚‹ã€‚
3. ä½•ã‚‰ã‹ã®æ–¹æ³•ã§ç›¸æ‰‹ã«å…¬é–‹éµã‚’æ¸¡ã™ã€‚
4. ç›¸æ‰‹ã¯å…¬é–‹éµã‚’ç”¨ã„ã¦ç½²åã‚’æ¤œè¨¼ã™ã‚‹ã€‚

   ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled4.png)

### è¨¼æ˜Žæ›¸ãƒã‚§ãƒ¼ãƒ³

ãã®å…¬é–‹éµãŒæœ¬ç‰©ã‹ã©ã†ã‹ç¬¬ä¸‰è€…ãŒè¨¼æ˜Žæ›¸ã‚’ä½œæˆã™ã‚‹

1. è¨¼æ˜Žæ›¸ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€è¨¼æ˜Žå¯¾è±¡ã¨ãªã‚‹å…¬é–‹éµï¼‹ãã®å…¬é–‹éµã«å¯¾å¿œã™ã‚‹ç§˜å¯†éµã‚’æŒã£ã¦ã„ã‚‹äººã®æƒ…å ±ï¼‹è¨¼æ˜Žæ›¸ã®ç™ºè¡Œè€…ï¼ˆè‡ªåˆ†ï¼‰ã®æƒ…å ±
2. ã“ã®è¨¼æ˜Žæ›¸ã®å†…å®¹ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã€ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã‚’ã™ã‚‹ã€‚
3. ãã®ãŸã‚ã«ã€ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åç”¨ã®ç§˜å¯†éµã¨å…¬é–‹éµã®ãƒšã‚¢ã‚’ä½œæˆ
4. ãã‚Œã‹ã‚‰ã€ç§˜å¯†éµã‚’ç”¨ã„ã¦ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã‚’ãŠã“ãªã†ã€‚ã“ã‚Œã§è¨¼æ˜Žæ›¸ã®å®Œæˆ
5. å…¬é–‹éµã‚’ç›´æŽ¥æ¸¡ã™ä»£ã‚ã‚Šã«ã€ãã®å…¬é–‹éµã‚’å«ã¿ã€ãã®å‡ºæ‰€ã‚’è¨¼æ˜Žã™ã‚‹è¨¼æ˜Žæ›¸ã‚’æ¸¡ã™ã€‚

   ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled5.png)

6. ã“ã‚Œã«ã‚ˆã‚Šã€å…ƒã€…æ¬²ã—ã‹ã£ãŸå…¬é–‹éµï¼ˆå›³ä¸­ã®ã€ŒA ã®å…¬é–‹éµã€ï¼‰ã¯è¨¼æ˜Žä»˜ãã§å…¥æ‰‹ã§ãã‚‹ã€‚ã—ã‹ã—ã€è¨¼æ˜Žæ›¸ã®ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®å…¬é–‹éµï¼ˆå›³ä¸­ã®ã€ŒB ã®å…¬é–‹éµã€ï¼‰ãŒå¿…è¦ã«ãªã£ã¦ã—ã¾ã†ã€‚ã€‚ã€‚ã€‚ã“ã‚Œã§ã¯éš›é™ãŒãªãæ€ãˆã‚‹ãŒã€å…¬é–‹éµã®è¨¼æ˜Žæ›¸ã‚’å…¬é–‹éµã®ä¸»ä½“è€…æœ¬äººãŒä½œæˆã™ã‚‹ã“ã¨ã§çµ‚çµã™ã‚‹ã€‚ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã‚’ä»˜ã‘ã‚‹éš›ã«ä½¿ã†ç§˜å¯†éµã¯ã€è¨¼æ˜Žå¯¾è±¡ã®å…¬é–‹éµã¨ãƒšã‚¢ã®ç§˜å¯†éµã‚’ä½¿ã†ã€‚ã“ã®ã‚ˆã†ã«ã€è¨¼æ˜Žå¯¾è±¡ã¨ãªã‚‹å…¬é–‹éµã¨ãƒšã‚¢ã«ãªã£ã¦ã„ã‚‹ç§˜å¯†éµã‚’ç”¨ã„ã¦ç½²åã™ã‚‹ã“ã¨ã‚’ã€**è‡ªå·±ç½²å**ã¨è¨€ã„ã€è‡ªå·±ç½²åã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸè¨¼æ˜Žæ›¸ã‚’**è‡ªå·±ç½²åè¨¼æ˜Žæ›¸**ã¨è¨€ã†
7. è‡ªå·±ç½²åè¨¼æ˜Žæ›¸ã¯èµ·ç‚¹ã¨ãªã‚‹è¨¼æ˜Žæ›¸ãªã®ã§ã€ä¿¡é ¼æ¸ˆã¿ã®è¨¼æ˜Žæ›¸ã¨ã—ã¦ã‚ã‚‰ã‹ã˜ã‚æŒã£ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

   ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled6.png)

8. ã“ã‚Œã‚‰ã®è¨¼æ˜Žæ›¸ã¯éŽ–ã®ã‚ˆã†ã«ç¹‹ãŒã£ã¦ã„ã‚‹ã€‚ã“ã®ã‚ˆã†ã«é€£ãªã£ãŸè¨¼æ˜Žæ›¸ç¾¤å…¨ä½“ã‚’**è¨¼æ˜Žæ›¸ãƒã‚§ãƒ¼ãƒ³**ï¼ˆcertificate chainï¼‰ã¨å‘¼ã³ã¾ã™ã€‚
9. ãã—ã¦ã€èµ·ç‚¹ã¨ãªã‚‹è‡ªå·±ç½²åè¨¼æ˜Žæ›¸ã‚’**ãƒ«ãƒ¼ãƒˆè¨¼æ˜Žæ›¸**ï¼ˆroot certificateï¼‰ã€ä¸­é–“ã«ã‚ã‚‹è¨¼æ˜Žæ›¸ã‚’**ä¸­é–“è¨¼æ˜Žæ›¸**ï¼ˆintermediate certificateï¼‰ã¨å‘¼ã³ã¾ã™ã€‚ä¸­é–“è¨¼æ˜Žæ›¸ã®æ•°ã¯ 2 ä»¥ä¸Šã«ãªã‚Šãˆã¾ã™ã€‚
   [å›³è§£ X.509 è¨¼æ˜Žæ›¸ - Qiita](https://qiita.com/TakahikoKawasaki/items/4c35ac38c52978805c69)

### X.509 è¨¼æ˜Žæ›¸

è¨¼æ˜Žæ›¸ã®æ§‹é€ ã¯ Â [RFC 5280](https://tools.ietf.org/html/rfc5280)
Â  ã¨ã„ã†æŠ€è¡“æ–‡æ›¸ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚X.509 è¨¼æ˜Žæ›¸ã¨ã„ã†åå‰ã¯ã€åŒæŠ€è¡“æ–‡æ›¸ã®ã‚¿ã‚¤ãƒˆãƒ«ã€ŒInternet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profileã€ã‹ã‚‰æ¥ã¦ã„ã¾ã™ã€‚
![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled7.png)

:::

:::details å…¬é–‹éµæš—å·ã¨å…±é€šéµæš—å·ã®æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä»£è¡¨ä¾‹ã‚’æŒ™ã’ã‚ˆ
![screenshot-www.infraexpert.com-2022.08.05-12_38_22.png](/images/20221015_professional-cloud-security-engineer/screenshot-www.infraexpert.com-2022.08.05-12_38_22.png)
:::

:::details ãƒªã‚½ãƒ¼ã‚¹éšŽå±¤ã¨ãƒãƒªã‚·ãƒ¼ã®é–¢ä¿‚æ€§ã‚’è¨€ãˆ
- ãƒãƒªã‚·ãƒ¼ï¼ãƒ­ãƒ¼ãƒ«ï¼‹ãƒ¦ãƒ¼ã‚¶ãƒ¼
  []()
  ![image.png](/images/20221015_professional-cloud-security-engineer/image5.png)
- ãƒªã‚½ãƒ¼ã‚¹éšŽå±¤ã«ãƒãƒªã‚·ãƒ¼(=ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ SA ã¨ãƒ­ãƒ¼ãƒ«)ã‚’ãã£ä»˜ã‘ã¦è¨­å®šã—ã€ç¶™æ‰¿ã•ã›ã‚‹
- GCP ã®ãƒªã‚½ãƒ¼ã‚¹éšŽå±¤ã«ã¯ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ¡ãƒ³ãƒãƒ¼ã¨ã‹ Gmail ãƒ¡ãƒ³ãƒãƒ¼ã‚‚è¿½åŠ ã§ãã‚‹ï¼
  []()
  ![image.png](/images/20221015_professional-cloud-security-engineer/image6.png)
:::

:::details Cloud IAM ã® custom roles ã® etagã€--stage flag ã¨ã¯ï¼Ÿ
### --stage flag

--stage flag ã‚’ ENABLE ã«ã—ãŸã‚Š DISABLE ã«ã§ãã‚‹ã—ã€custom roles ã‚’ delete ã™ã‚‹ã¨ã€stage ãŒ Deleted ã«ãªã‚‹ã€‚Role ã‚’æ–°ã—ã„ã‚‚ã®ã«ç½®ãæ›ãˆãŸæ™‚ã«å¤ã„ã‚‚ã®ã‚’ DEPRECATED ã® stage ã«è¨­å®šã™ã‚‹ã“ã¨ã‚‚æŽ¨å¥¨ã•ã‚Œã‚‹ã€‚ä¸€æ—¦ delete ã—ãŸå¾Œã« undelete ã‚³ãƒžãƒ³ãƒ‰ã§å¾©æ´»ã•ã›ã‚‹ã¨ã€--stage ã‚¿ã‚°ãŒã‚‚ã¨ã«æˆ»ã£ã¦ã„ã‚‹ã€‚
â€» [ã‚­ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³](https://www.notion.so/f609f89cda7d43b6824d6a45040523c6) ã¨é¡žä¼¼ã€‚
### etag
> if two owners for a project try to make conflicting changes to a role at the same time, some changes could fail.
> Cloud IAM solves this problem using anÂ `etag`Â property in custom roles. This property is used to verify if the custom role has changed since the last request. When you make a request to Cloud IAM with an etag value, Cloud IAM compares the etag value in the request with the existing etag value associated with the custom role. It writes the change only if the etag values match.

:::

:::details Dynamic Group ã¨ã¯?

> å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ã¯ã€ãƒ¡ãƒ³ãƒãƒ¼ã‚¯ã‚¨ãƒªã‚„ã€å½¹è·ã‚„å‹¤å‹™åœ°ãªã©ã®å¾“æ¥­å“¡å±žæ€§ã®ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦è‡ªå‹•çš„ã«ç®¡ç†ã•ã‚Œã‚‹ Google ã‚°ãƒ«ãƒ¼ãƒ—ã§ã™ã€‚ãŸã¨ãˆã°ã€ãƒ¡ãƒ³ãƒãƒ¼ã‚¯ã‚¨ãƒªã¯ã€Œçµ„ç¹”å†…ã§ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ãƒ©ã‚¤ã‚¿ãƒ¼ã®å½¹å‰²ã‚’æŒã¤ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãªã©ã«ãªã‚Šã¾ã™ã€‚
> In Dynamic Groups, users are automatically managed and added based on Identity
> attributes, such as department.
> [å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ã®æ¦‚è¦ | Cloud Identity | Google Cloud](https://cloud.google.com/identity/docs/concepts/overview-dynamic-groups?hl=ja)

:::

:::details Lien ã¨ã¯ï¼Ÿ
ã€Œãƒªãƒ¼ã‚¨ãƒ³ã€ã¯ã€å˜ç´”ãªãƒŸã‚¹ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒæ¶ˆãˆãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿è­·ç”¨ã®è¨­å®šã®ã“ã¨

ä¾‹ï¼‰çµ„ç¹”ãƒ¬ãƒ™ãƒ«ã®ãƒãƒªã‚·ãƒ¼åˆ¶ç´„ã§ã€compute.restrictXpnProjectLienRemoval ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèª¤ã£ã¦å‰Šé™¤ã—ãªã„ã‚ˆã†ã«å¼·åˆ¶ã§ãã‚‹ã€‚(xpnï¼šSharedVPC ã®ã“ã¨ã€‚CrossProjectNetwork)
:::

:::details GCS ã® IAM ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¯ã©ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ï¼Ÿ
bucket level ã¾ã§ã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ¯Žã«ã¯è¨­å®šã§ããªã„ã‚‰ã—ã„ã€‚
â†’ ç´°ã‹ã„ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã«ã¯ ACL ã‚’ä½¿ã†ã€‚ãŒã€æŽ¨å¥¨ã¯ã•ã‚Œãªã„ã€‚
![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled8.png)
:::

:::details ãƒ‰ãƒ¡ã‚¤ãƒ³å…¨ä½“ã¸ã®ç§»è­²ã¨ã¯ï¼Ÿ

> in order to be able to access user's google drive accounts on user's behalf we need to use wide domain delegation. In order to make this work the steps would be the following:
>
> 1)Â Enable Gmail API at the project level in GCP:Â we need to do this to access google drive.
>
> 2)Â Create a service account
>
> 3)Â Grant domain access to the account and enable g suite domain-wide delegation
>
> 4)Â Include the code to use the API (e.g using python) in our App Engine application.

:::

:::details Google Cloud ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®ç¨®é¡žã¨ä½¿ã„åˆ†ã‘ã«ã¤ã„ã¦èª¬æ˜Žã›ã‚ˆã€‚ãƒ—ãƒ­ã‚­ã‚·åž‹ã¨ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼åž‹ã¯ä½•ãŒé•ã†ã‹ï¼ŸIAP ã¨ã®é–¢ä¿‚ã«ã¤ã„ã¦å®Œçµã«è¿°ã¹ã‚ˆã€‚

> å‚è€ƒï¼š[https://www.topgate.co.jp/google-cloud-load-balancer#i-5](https://www.topgate.co.jp/google-cloud-load-balancer#i-5)

- å…¨ã¦ã®è¦ç´ ã‚’ä¸€æžšã§å›³ç¤ºã—ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã€‚

  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled9.png)

- ãƒ„ãƒªãƒ¼å½¢å¼ã§å›³ç¤ºã™ã‚‹ã¨ä¸‹è¨˜
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled10.png)
- internal ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¯ãƒªãƒ¼ã‚¸ãƒ§ãƒŠãƒ«ã®ã¿
- å†…éƒ¨ãƒ—ãƒ­ã‚­ã‚·åž‹ã® LB ã¯ã€OSS ã® envoy proxy ãŒãƒ™ãƒ¼ã‚¹ã«ãªã£ã¦ã„ã‚‹
- Google ã®ã‚¢ãƒ³ãƒ‰ãƒ­ãƒ¡ãƒ€ã®ãƒ–ãƒ­ã‚°ãƒã‚¹ãƒˆèª­ã‚
- å¤–éƒ¨ HTTPï¼ˆSï¼‰è² è·åˆ†æ•£ã¨å†…éƒ¨ HTTPï¼ˆSï¼‰è² è·åˆ†æ•£ã§ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«æ‰‹ã‚’å…¥ã‚Œãšã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å®Ÿç¾ã§ãã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç°¡å˜ãª A/B ãƒ†ã‚¹ãƒˆã‚„ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã€å†è©¦è¡Œã€å¤–ã‚Œå€¤æ¤œå‡ºã€ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ etc.ã‚’è¡Œã†ã“ã¨ãŒå¯èƒ½ã€‚

### ãƒ—ãƒ­ã‚­ã‚·åž‹ã¨ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼åž‹ã«ã¤ã„ã¦ã€‚

[]()

- å·¦ãŒãƒ—ãƒ­ã‚­ã‚·åž‹ã€å³ãŒãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼åž‹
  ![image.png](/images/20221015_professional-cloud-security-engineer/image7.png)
- ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã«ã¯ã€ãƒ—ãƒ­ã‚­ã‚·åž‹ã¨ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼åž‹ã¨ã„ã†åˆ†é¡žãŒã‚ã‚‹ã€‚ãƒ—ãƒ­ã‚­ã‚·åž‹ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰å±Šã„ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§å—ã‘å–ã‚Šã€ãã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ãŒåˆ¥ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«é€šä¿¡ã‚’è¡Œã†ã€‚ãã®ãŸã‚ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå±Šãå‰å¾Œã§é€ä¿¡å…ƒã¨é€ä¿¡å…ˆãŒå¤‰ã‚ã‚‹ã€‚
  â‡’ ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å¤‰æ›ãŒå¯èƒ½ï¼
- ä¸€æ–¹ã€ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼åž‹ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰å±Šã„ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãã®ã¾ã¾ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«å±Šã‘ã‚‹ã€‚ãã®ãŸã‚ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå±Šãå‰å¾Œã§é€ä¿¡å…ƒã¨é€ä¿¡å…ˆãŒå¤‰ã‚ã‚‹ã“ã¨ã¯ãªã„ã€‚
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled11.png)

### IAP(Identity-Aware Proxy)ã¨ã®é–¢ä¿‚ã«ã¤ã„ã¦

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«èªè¨¼ã‚’è¿½åŠ ã™ã‚‹å ´åˆã€æœ¬æ¥ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è‡ªä½“ã«æ‰‹ã‚’åŠ ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ Identity-Aware Proxy ï¼ˆIAPï¼‰ã‚’ä½¿ã†ã“ã¨ã§èªè¨¼éƒ¨åˆ†ã‚’ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§å®Œçµã§ãã€èªè¨¼ãŒçµ‚ã‚ã£ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«é€ã‚‹ã“ã¨ãŒå¯èƒ½ã€‚
èªè¨¼ã«ã¯ã€ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚„ OAuth ã€ SAML ã€ OIDC ãªã©ã®ä¸€èˆ¬çš„ãªèªè¨¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ç¶²ç¾…ã—ã¦ã„ã¦ã€æ—¢å­˜ã®èªè¨¼ DB ã‚’ãã®ã¾ã¾åˆ©ç”¨ã—ã¦èªè¨¼ã§ãã‚‹ç‚¹ã‚‚å¤§ããªãƒ¡ãƒªãƒƒãƒˆã€‚
â‡’ IAP ã‚‚ã€Cloud Armor ã¿ãŸã„ã«ã€LB ã«ã¤ãï¼
![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled12.png)
:::

:::details SSL ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® SSL ãƒãƒªã‚·ãƒ¼ã¯ï¼Ÿ
SSL load balancers have three pre-configured profile:

- **COMPATIBLE.**Â Allows the broadest set of clients, including clients that support only out-of-date SSL features, to negotiate SSL with the load balancer.
- **MODERN.**Â Supports a wide set of SSL features, allowing modern clients to negotiate SSL.
- **RESTRICTED.**Â Supports a reduced set of SSL features, intended to meet stricter compliance requirements.
  If no SSL policy is set, your load balancer will use the default SSL policy, which is equivalent to one that uses a COMPATIBLE profile with a minimum TLS version of TLS 1.0.
  :::

:::details TCP proxy/TCPUDP ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®é•ã„ï¼Ÿ

- TCP Proxy Load Balancing is implemented on GFEs that are distributed globally. If you choose the Premium Tier of Network Service Tiers, a TCP proxy load balancer is **global**. In Premium Tier, you can deploy backends in multiple regions, and the load balancer automatically directs user traffic to the closest region that has capacity. TCP Proxy Load Balancing is intended for TCP traffic on specific well-known ports, such as port 25 for Simple Mail Transfer Protocol (SMTP) or 995 (POP3).
- TCP/UDP network load balancer is **regional** not global.
  :::
  :::details IAP TCP è»¢é€ã¨ã¯ï¼Ÿãƒ¡ãƒªãƒƒãƒˆã¯ï¼Ÿ
  å¤–éƒ¨ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒãŸãªã„ã€ã¾ãŸã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆçµŒç”±ã®ç›´æŽ¥ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ãªã„ VM ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ IAP ã‚’ä»‹ã—ã¦ ssh æŽ¥ç¶šã¨ã‹ã‚’ã™ã‚‹æ–¹æ³•
- ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã‚’å¯¾è±¡ã®éžå…¬é–‹ VPC ã«è¨­å®šã—ã€IP ç¯„å›² Â `35.235.240.0/20`Â  ã‹ã‚‰ã®ä¸Šã‚Šï¼ˆå†…å‘ãï¼‰ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’è¨±å¯ã™ã‚‹
- ã“ã®ç¯„å›²ã«ã¯ã€IAP ãŒ TCP è»¢é€ã«ä½¿ç”¨ã™ã‚‹ã™ã¹ã¦ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
- IAP TCP è»¢é€ã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹ã™ã¹ã¦ã®ãƒãƒ¼ãƒˆã¸ã®æŽ¥ç¶šã‚’è¨±å¯ã—ã¾ã™ã€‚ãŸã¨ãˆã°ã€SSH ã®ãƒãƒ¼ãƒˆ Â `22`Â  ã¨ RDP ã®ãƒãƒ¼ãƒˆ Â `3389`Â  ã§ã™ã€‚
  **ãƒ¡ãƒªãƒƒãƒˆ**ã¯ã€IAP ã‚’ä½¿ãˆã°è¸ã¿å°ã‚µãƒ¼ãƒãŒä¸è¦ã«ãªã‚‹ã“ã¨ï¼
  â‡” é€†ã«å¤–éƒ¨ IP ã‚’æŒãŸãªã„ VM ãŒ Egress ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€

1. NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’ä½¿ã†
2. Private Google Access ã‚’ä½¿ã†(Google API ã®ã¿)ã¨ã„ã†æ–¹æ³•ãŒã‚ã‚‹
   [Using IAP for TCP forwarding | Identity-Aware Proxy | Google Cloud](https://cloud.google.com/iap/docs/using-tcp-forwarding)
   :::
   :::details VPN ã®å®Ÿè£…æ–¹å¼ã®ç¨®é¡žã‚’æ•´ç†ã›ã‚ˆã€‚SSL ã¨ IPSec ã®é•ã„ã€VPN ã¨ IAP ã®é•ã„ã‚’è¿°ã¹ã‚ˆã€‚Cloud VPN ã®ç‰¹å¾´ã¯ï¼Ÿ

### VPN ã®åˆ†é¡ž

1. ä½¿ç”¨ã™ã‚‹å›žç·šã«ã‚ˆã£ã¦åˆ†é¡ž
   - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ VPN
   - IP-VPN(é€šä¿¡äº‹æ¥­è€…ã®ã‚¢ã‚¯ã‚»ã‚¹å›žç·šã‚’ä½¿ç”¨)
2. ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§åˆ†é¡ž
   - SSL-VPN
   - IPSec-VPN
   - PPTP-VPN
   - L2TP-VPN
   - ãªã©ã€‚
     ![IMG_7541.jpg](/images/20221015_professional-cloud-security-engineer/IMG_7541.jpg)

### IPSec VPN vs SSL VPN

- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸¸ã”ã¨ã‹ã€ãƒãƒ¼ãƒˆæ¯Žã‹
- å®Ÿç¾ã™ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã¯åŒã˜ãã‚‰ã„
- IPSec ã¯å°‚ç”¨ã®æ©Ÿå™¨ãŒã„ã‚‹ã®ã§ã€ã‚³ã‚¹ãƒˆé«˜ã„ã€‚ãŒã€é«˜é€Ÿã€‚IPSec ã¯ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ã® TCP ã‚„ UDP ã®ãƒ˜ãƒƒãƒ€ãŒè¦‹ãˆãªã„ã®ã§ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã§ããªã„
- SSL ã¯ã‚½ã‚±ãƒƒãƒˆå…¨ä½“ã§ãªã„ã®ã§ã€ç´°ã‹ã„è¨­å®šãŒã§ãã‚‹ã€‚ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã¯åŸºæœ¬çš„ã« web ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãªã„ã¨ã€å°Žå…¥ãŒé¢å€’ã€‚SSL-VPN ã¯ https ã‚’åˆ©ç”¨ã—ãŸ VPNã€https-VPN ã¨ã‚‚è¨€ãˆãã†ï¼Ÿ

### IAP ã¨ã®é•ã„

æœ¬è³ªçš„ãªé•ã„

- VPN ã¯ç¤¾å†…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å…¨ä½“ã‚’åˆ¶å¾¡(=å¢ƒç•Œåˆ¶å¾¡)ã€‚ä¸€åº¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¼æ´©ã—ã¦ä¾µå…¥ã•ã‚Œã‚‹ã¨å±é™ºæ€§é«˜ã„ã€‚
- IAP ã¯ IAM ã¨é€£æºã—ã¦ã„ã‚‹ã®ã§ã€ã‚¢ãƒ—ãƒªå˜ä½ã§ç´°ã‹ãèªè¨¼ã€èªå¯ã§ãã‚‹ã€‚ä¾µå…¥ã•ã‚Œã¦ã‚‚æ”»æ’ƒãŒä»–ã®ã‚¢ãƒ—ãƒªã«åŠã°ãªã„ã€‚
  é¡žä¼¼ç‚¹
- ã¨ã¯ã„ãˆ IAP ã‚‚æŠ€è¡“çš„ã«ã¯ SSL-VPN ã¨é¡žä¼¼ã€‚ä»¥ä¸‹ã®è¨˜äº‹ã§æ›¸ã„ã¦ã‚ã‚‹ãŒã€SSL over WebSocket ãŒå®Ÿä½“ã‚‰ã—ã„ã€‚
  > Cloud IAP ã¯ç°¡å˜ã«è¨€ã†ã¨ Google Cloud (æ—§ç§° GCP) ãŒæä¾›ã™ã‚‹**ãƒ•ãƒ«ãƒžãƒãƒ¼ã‚¸ãƒ‰ã®ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·**ã§ã™ã€‚ãƒ•ãƒ«ãƒžãƒãƒ¼ã‚¸ãƒ‰ã§ã™ã®ã§ã€åˆ©ç”¨è€…ã¯ IAP ã‚’æ§‹ç¯‰ã—ãŸã‚Šé‹ç”¨ãƒ»ä¿å®ˆã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- IAP ã®ã‚³ãƒã‚¯ã‚¿ã¨ã‹ã€VPN ã®ã‚µãƒ¼ãƒã‚’ã‚¯ãƒ©ã‚¦ãƒ‰å´ã§ç®¡ç†ã—ã¦ãã‚Œã‚‹ã€Managed VPN ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã«è¿‘ã„ã‹ã‚‚ã€‚Cloud IAP ã¯ Google ãŒç®¡ç†ã—ã¦ãã‚Œã¦ã„ã‚‹ VPN ã‚µãƒ¼ãƒã®ã‚ˆã†ãªã‚‚ã®ã§ã€èƒŒå¾Œã§ IAM ã¨é€£æºã—ã¦ã„ã‚‹ã€‚ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ãŒã€IP ã§ã¯ãªãã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§å‹•ä½œã—ã¦ã€ç´°ã‹ãåˆ¶å¾¡ã™ã‚‹ã®ã ã€‚

### Cloud VPN ã«ã¤ã„ã¦

- Cloud Router ã¨ä¸€ç·’ã«ä½¿ã†ã“ã¨ã§ã€Dynamic routing ã—ã¦ãã‚Œã‚‹ã€‚
  []()
  ![image.png](/images/20221015_professional-cloud-security-engineer/image8.png)
- æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯è‡ªå‹•çš„ã«é€šçŸ¥(ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚º)ã•ã‚Œã€é™çš„ IP ã®ç®¡ç†ã¯ä¸è¦
  []()
  ![image.png](/images/20221015_professional-cloud-security-engineer/image9.png)
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ«ãƒ¼ãƒˆ ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚º=ãƒªãƒ¼ã‚¸ãƒ§ãƒŠãƒ«
  - Cloud Router ã¯ã€åŸºæœ¬çš„ã«ãƒªãƒ¼ã‚¸ãƒ§ãƒŠãƒ«ã€‚
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒžãƒ«ãƒãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã® VPC ã«ä¸€ã¤ã® Cloud Router ãŒå¯¾å¿œã™ã‚‹ã®ã§ã¯ãªãã¦ã€ãã®ä¸­ã®ç‰¹å®šãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚µãƒ–ãƒãƒƒãƒˆã«å¯¾ã—ã¦ä¸€ã¤ã® Cloud Router ãŒå¯¾å¿œã™ã‚‹(**ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰**)
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° - è¨­å®šã‚’å¤‰ãˆã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã€ã¤ã¾ã‚Š VPC ã®ã‚µãƒ–ãƒãƒƒãƒˆå…¨ä½“ã®ãƒ«ãƒ¼ãƒˆã‚’ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚ºã™ã‚‹**ã‚°ãƒ­ãƒ¼ãƒãƒ«å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰**ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚ > Cloud Router ã«ã‚ˆã£ã¦ã€ãƒ«ãƒ¼ã‚¿ãƒ¼ãŒæ§‹æˆã•ã‚Œã¦ã„ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¾ãŸã¯ Virtual Private Cloudï¼ˆVPCï¼‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å…¨ä½“ã§ã‚µãƒ–ãƒãƒƒãƒˆãŒå‹•çš„ã«ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚ºã•ã‚Œã¦ã€å­¦ç¿’æ¸ˆã¿ãƒ«ãƒ¼ãƒˆãŒä¼æ’­ã•ã‚Œã¾ã™ã€‚ > VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã® Cloud Router ãŒãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‹ã¯ã€VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã¾ãŸã¯ç·¨é›†ã™ã‚‹ã¨ãã«ã€å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¾ãŸã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è¨­å®šã§ãã¾ã™ã€‚ > [å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ | Cloud Router | Google Cloud](https://cloud.google.com/network-connectivity/docs/router/how-to/configuring-routing-mode?hl=ja) > â€» **ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚ºã™ã‚‹** > ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶å¾¡åˆ†é‡Žã®ç”¨èªžã€‚Cloud Router ã®å ´åˆã€éš£æŽ¥ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒ«ãƒ¼ã‚¿ã«å¯¾è±¡ï¼ˆã‚µãƒ–ãƒãƒƒãƒˆã‚„å¤–éƒ¨ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã¸ã®çµŒè·¯æƒ…å ±ã‚’ä¼é”ã™ã‚‹ã“ã¨ã‚’æŒ‡ã™ã€‚ > [GCP IAP tunnel ã‚’ HTTP ãƒ—ãƒ­ã‚­ã‚·ã‚’é€šã—ã¦åˆ©ç”¨ã™ã‚‹å ´åˆã®æ³¨æ„ç‚¹](https://www.qoosky.io/techs/fd7e826326) > [PPTP - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å…¥é–€ã‚µã‚¤ãƒˆ](https://beginners-network.com/vpn_pptp.html) > [IPsec vs. SSL VPN: Comparing speed, security risks and technology](https://www.techtarget.com/searchsecurity/tip/IPSec-VPN-vs-SSL-VPN-Comparing-respective-VPN-security-risks)
  :::
  :::details GCP ã«ãŠã‘ã‚‹ DNS ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒã«ã¤ã„ã¦èª¬æ˜Žã›ã‚ˆã€‚
- ~~å„ VM ã¯~~å„ VPC ã¯ãã‚Œãžã‚Œãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒãƒ¼ã‚’æŒã£ã¦ãŠã‚Šã€ãã‚ŒãŒ DNSresolver ã¨ã—ã¦ã‚‚åƒãã€‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒªã‚½ãƒ¼ã‚¹ã®åå‰è§£æ±ºã®å•ã„åˆã‚ã›ã«å¿œãˆã‚‹ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒªã‚½ãƒ¼ã‚¹ä»¥å¤–ã¯ Google ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ DNS ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã€‚
  - ExternalIP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ Google ã® CloudDNS ã‚„ Google ä»¥å¤–ã® DNS ã‚µãƒ¼ãƒ“ã‚¹ã«ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚å†…éƒ¨ DNS ã ã‘ã§ãªãã€‚
  - internalIP ã¯ VM ãŒãƒžã‚¹ãƒˆã§æŒã¤ã€‚External IP ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€ä¸€æ™‚çš„ã€‚
    internalIP ã¯ VM ã® OS ãŒè‡ªåˆ†ã§çŸ¥ã£ã¦ã„ã‚‹ãŒã€external ã¯çŸ¥ã‚‰ãªã„ï¼å¤–å´ã‹ã‚‰ãƒžãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã®ã ï¼
- DNS ã‚µãƒ¼ãƒ“ã‚¹ã‚’æŒã¤ã®ã¯ã€å„ VM ã§ã¯ãªãã¦ã€VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚‰ã—ã„
  > VPC networks have an internal DNS service that allows you to address instances by their DNS names instead of their internal IP addresses. When an internal DNS query is made with the instance hostname, it resolves to the primary interface (nic0) of the instance.
  > â‡’ VPC ã«å±žã™ã‚‹ã™ã¹ã¦ã® VM ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç®¡ç†ã™ã‚‹**ãƒ¡ã‚¿ã‚µãƒ¼ãƒ**ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã£ã¦ã€ãã‚ŒãŒ DNS ã‚µãƒ¼ãƒ“ã‚¹ã‚‚ã—ã¦ã„ã‚‹æ„Ÿã˜ï¼Ÿãã® VPC ã«å±žã—ã¦ã„ã‚‹ VM ã®åå‰è§£æ±ºã‚¯ã‚¨ãƒªãŒæ¥ãŸã‚‰å¿œç­”ã™ã‚‹ï¼Ÿã§ã€è¤‡æ•° NIC ã‚’ã‚‚ã¤ VM ãŒã‚ã‚‹å ´åˆã€NIC ï¼ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸åå‰è§£æ±ºã•ã‚Œã‚‹ã½ã„ã€‚
- VPC ã®**ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ Google Access**ã‚’æœ‰åŠ¹ã«ã—ã¦ãŠã‘ã°ã€BQ ã¨ã‹ GCS ãªã© Google ã® API ã«å†…éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ï¼
  â‡” æ™®é€šã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæŽ¥ç¶šã¯ NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤è¨­å®šã—ãªã„ã¨ãƒ€ãƒ¡ã€‚
  - Cloud function ã¨ã‹ Cloud Run ã¨ã‹ã¯å¤–éƒ¨ IP ã‚’æŒã£ã¦ã‚‹ã‹ã‚‰ã€Google API ã§ BQ ã¨ã‹ GCS ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã€‚
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒãƒ¼ã® IP ã¯ã€169.254.169.254 ã§å›ºå®šã€‚ãªã®ã§ã€InternalDNS ã§ã‚‚ metadata.google.internal ã§åå‰è§£æ±ºã§ãã‚‹ã€‚
  â€»ã“ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ¬ãƒ³ã‚¸ã¯ã€TCP IAP è»¢é€ã§ã€å¤–éƒ¨ IP ã‚’æŒãŸãªã„éžå…¬é–‹ VPC ã«è¸ã¿å°ç„¡ã—ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‚ˆã†ãªæ™‚ã«ã€ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ã§è¨±å¯ã—ã¦ãŠããƒ¬ãƒ³ã‚¸ã€‚è¦ã™ã‚‹ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒãƒ¼(ãã‚Œã‹è¿‘ãã®ãƒ¬ãƒ³ã‚¸ã®ã‚µãƒ¼ãƒãƒ¼)çµŒç”±ã§ IAP æŽ¥ç¶šã•ã‚Œã‚‹ã¯ãšã€‚
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® VPC ã‚’å‰Šé™¤ã™ã‚‹ã¨ã€æ–°ãŸã«è‡ªåˆ†ã§ VPC ã‚’ä½œã‚‰ãªã„é™ã‚Šã€æ–°ãŸãª VM ã¯ä½œã‚Œãªã„ï¼ã¤ã¾ã‚Šæœ¬æ¥ VPC ã®ä¸­ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚‹ã®ã§ã‚ã£ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯è¦‹ãˆãªããªã£ã¦ã„ã‚‹ã®ã ã€‚ãã®è¦‹ãˆãªã„ã‚‚ã®ã®ä¸­ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒãªã©ã‚‚ã‚ã‚‹ã€‚
  :::
  :::details Cloud DNS ã«ãŠã‘ã‚‹ã€è»¢é€ã‚¾ãƒ¼ãƒ³ã€ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚¾ãƒ¼ãƒ³ã€ãƒžãƒãƒ¼ã‚¸ãƒ‰é€†å¼•ãå‚ç…§ã‚¾ãƒ¼ãƒ³ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–“ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚¾ãƒ¼ãƒ³ã«ã¤ã„ã¦ã€ãã‚Œãžã‚Œç°¡å˜ã«èª¬æ˜Žã›ã‚ˆã€‚

### ãƒžãƒãƒ¼ã‚¸ãƒ‰ ã‚¾ãƒ¼ãƒ³

- Cloud DNS ã§ã¯ã€ãƒžãƒãƒ¼ã‚¸ãƒ‰ ã‚¾ãƒ¼ãƒ³ã¯ **DNS ã‚¾ãƒ¼ãƒ³**ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹
  â‡’ Google ãƒžãƒãƒ¼ã‚¸ãƒ‰ãª DNS ã‚¾ãƒ¼ãƒ³
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯è¤‡æ•°ã®ãƒžãƒãƒ¼ã‚¸ãƒ‰ ã‚¾ãƒ¼ãƒ³ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹
- ãƒžãƒãƒ¼ã‚¸ãƒ‰ ã‚¾ãƒ¼ãƒ³å†…ã®ã™ã¹ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ GCP ãƒžãƒãƒ¼ã‚¸ãƒ‰ãªãƒãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ãƒ›ã‚¹ãƒˆã•ã‚Œã€ãã®ã‚¾ãƒ¼ãƒ³ã«å¯¾ã™ã‚‹ DNS ã‚¯ã‚¨ãƒªã«å¿œç­”ã™ã‚‹ã€‚

â€»ä»¥ä¸‹ã¯å…¨ã¦ãƒžãƒãƒ¼ã‚¸ãƒ‰ã‚¾ãƒ¼ãƒ³

### ä¸€èˆ¬å…¬é–‹ã‚¾ãƒ¼ãƒ³

- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«å…¬é–‹ã•ã‚Œã‚‹ DNS ã‚¾ãƒ¼ãƒ³
- Cloud DNS ã«ã¯ã€ã‚¯ã‚¨ãƒªã®ç™ºä¿¡å…ƒã«é–¢ä¿‚ãªãã€ä¸€èˆ¬å…¬é–‹ã‚¾ãƒ¼ãƒ³ã«é–¢ã™ã‚‹ã‚¯ã‚¨ãƒªã«å¿œç­”ã™ã‚‹ä¸€èˆ¬å…¬é–‹ã•ã‚ŒãŸæ¨©å¨ãƒãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ãŒã‚ã‚‹

### é™å®šå…¬é–‹ã‚¾ãƒ¼ãƒ³

- æ‰¿èªã—ãŸ 1 ã¤ä»¥ä¸Šã® Virtual Private Cloudï¼ˆVPCï¼‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã‚ˆã£ã¦ã®ã¿ã‚¯ã‚¨ãƒªã§ãã‚‹ DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒ³ãƒ†ãƒŠã€‚
- åŸºã«ãªã‚‹ DNS ãƒ‡ãƒ¼ã‚¿ã‚’å…¬å…±ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ã•ã‚‰ã™ã“ã¨ãªãã€ä»®æƒ³ãƒžã‚·ãƒ³ï¼ˆVMï¼‰ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã€ãã®ä»–ã® Google Cloud ãƒªã‚½ãƒ¼ã‚¹ã®ã‚«ã‚¹ã‚¿ãƒ  ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’ç®¡ç†ã§ãã‚‹ã€‚
- é™å®šå…¬é–‹ã‚¾ãƒ¼ãƒ³ã¯ã€ãã‚ŒãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹**åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã® VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®ã¿**ã‚¯ã‚¨ãƒªã§ãã‚‹ã€‚â‡” ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é™å®šå…¬é–‹ãƒžãƒãƒ¼ã‚¸ãƒ‰ ã‚¾ãƒ¼ãƒ³ã«ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ã‚¨ãƒªã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

### è»¢é€ã‚¾ãƒ¼ãƒ³

- ãã®ã‚¾ãƒ¼ãƒ³ã«å¯¾ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€å…ˆã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«é€ä¿¡ã™ã‚‹ Cloud DNS é™å®šå…¬é–‹ãƒžãƒãƒ¼ã‚¸ãƒ‰ ã‚¾ãƒ¼ãƒ³

### ãƒ”ã‚¢ãƒªãƒ³ã‚° ã‚¾ãƒ¼ãƒ³

- **ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åå‰è§£æ±ºé †åºã«å¾“ã†** Cloud DNS é™å®šå…¬é–‹ãƒžãƒãƒ¼ã‚¸ãƒ‰ ã‚¾ãƒ¼ãƒ³
- ãƒ‡ãƒ¼ã‚¿ã¯ã€åå‰è§£æ±ºé †åºã«å¾“ã£ã¦ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å–å¾—ã•ã‚Œã‚‹ã€‚
- ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒžãƒ¼ VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ã€‚

### ãƒžãƒãƒ¼ã‚¸ãƒ‰é€†å¼•ãå‚ç…§ã‚¾ãƒ¼ãƒ³

- Compute Engine ã® DNS ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ PTR å‚ç…§ã‚’å®Ÿè¡Œã§ãã‚‹ç‰¹åˆ¥ãªå±žæ€§ï¼ˆï¼ PTR ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼‰ã‚’æŒã£ãŸé™å®šå…¬é–‹ DNS ã‚¾ãƒ¼ãƒ³
  - ãƒªãƒãƒ¼ã‚¹ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼šé€†å‚ç…§ã€‚IP ã‚¢ãƒ‰ãƒ¬ã‚¹ â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³åã®å¤‰æ›ã€‚DNS æ¨©å¨ï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰ã‚µãƒ¼ãƒãƒ¼ãŒå‚ç…§ã™ã‚‹ã‚¾ãƒ¼ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ã€Aï¼ˆAAAAï¼‰ãƒ¬ã‚³ãƒ¼ãƒ‰ã®é€†ã«ã‚ãŸã‚‹ PTR ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã†ã€‚
- A reverse lookup private zone helps you create PTR (pointer) records.
  PTR records help translating IP addresses to domain names, which is not the
  requirement.

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–“ï¼ˆã‚¯ãƒ­ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚¾ãƒ¼ãƒ³

- å…±æœ‰ VPC ã«ãŠã„ã¦ã€å„ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã€è‡ªèº«ã®ã‚µãƒ–ãƒãƒƒãƒˆã® DNS åå‰ç©ºé–“æ‰€æœ‰æ¨©ã‚’ä¿æŒã§ãã‚‹ DNS ã‚¾ãƒ¼ãƒ³ã€‚è²¬ä»»ç¯„å›²ã®åˆ†é›¢ã¨è‡ªå¾‹æ€§ãŒé«˜ã¾ã‚‹ã€‚
  â‡” ä¸€èˆ¬çš„ãªå…±æœ‰ VPC è¨­å®šã§ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä»®æƒ³ãƒžã‚·ãƒ³ï¼ˆVMï¼‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¾ãŸã¯ã‚µãƒ¼ãƒ“ã‚¹ã®æ‰€æœ‰æ¨©ã‚’æŒã£ã¦ã„ã‚‹ãŒã€VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®æ‰€æœ‰æ¨©ã¯ãƒ›ã‚¹ãƒˆ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒæ‰€æœ‰ã™ã‚‹ã€‚

> A cross-project binding zone allows you to manage the ownership of
> DNS zones between a shared VPC and the VPCs consuming the resources,

æ¬¡ã®å›³ã¯ã€DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’ä½¿ç”¨ã—ãŸä¸€èˆ¬çš„ãªå…±æœ‰ VPC è¨­å®šã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled13.png)

æ¬¡ã®å›³ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–“ã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä½¿ç”¨ã—ãŸè¨­å®šã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled14.png)

[Key terms | Cloud DNS | Google Cloud](https://cloud.google.com/dns/docs/key-terms)

:::
:::details DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¨ã¯ï¼ŸVPC ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¨ã®é–¢ä¿‚æ€§ã¨é•ã„ã¯ä½•ã‹ï¼Ÿé™å®šå…¬é–‹ã‚¾ãƒ¼ãƒ³ã€ã‚¯ãƒ­ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚¾ãƒ¼ãƒ³ã¨ã®ä½¿ã„åˆ†ã‘ã¯ï¼Ÿ

### DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°

A DNS peering zone creates a producer-consumer bridge between two
VPCs. The consumer VPC can then perform lookups in the producer VPC network,
including records hosted inside a Compute Engine instance. Use DNSSEC to
authorize requests and protect from exfiltration.

> DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’æä¾›ã™ã‚‹ã«ã¯ã€**Cloud DNS ãƒ”ã‚¢ãƒªãƒ³ã‚° ã‚¾ãƒ¼ãƒ³**ã‚’ä½œæˆã—ã€ãã®ã‚¾ãƒ¼ãƒ³ã®åå‰ç©ºé–“ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒåˆ©ç”¨å¯èƒ½ãª VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ DNS ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’è¡Œã†ã‚ˆã†ã«æ§‹æˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

â€» **ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**é™å®šå…¬é–‹ãƒžãƒãƒ¼ã‚¸ãƒ‰ ã‚¾ãƒ¼ãƒ³ã«ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ã‚‚ã¤ Cloud DNS ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µãƒ¼ãƒãƒ¼ã«ã‚¯ã‚¨ãƒªã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€**DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ï¼ˆãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚¾ãƒ¼ãƒ³ï¼‰**ã‚’ä½¿ç”¨ã™ã‚‹ã€‚â‡” ä¸€æ–¹ã€**åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®**VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®ã¿ã‚¯ã‚¨ãƒªã™ã‚‹å ´åˆã€**é™å®šå…¬é–‹ã‚¾ãƒ¼ãƒ³**ã‚’ä½¿ã†ã€‚

â€» å…±æœ‰ VPC ã«ãŠã„ã¦ã€å„ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã€è‡ªèº«ã®ã‚µãƒ–ãƒãƒƒãƒˆã® DNS åå‰ç©ºé–“æ‰€æœ‰æ¨©ã‚’ä¿æŒã§ãã‚‹ DNS ã‚¾ãƒ¼ãƒ³ã¯**ã‚¯ãƒ­ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚¾ãƒ¼ãƒ³**ã€‚è²¬ä»»ç¯„å›²ã®åˆ†é›¢ã¨è‡ªå¾‹æ€§ãŒé«˜ã¾ã‚‹ã€‚â‡” ä¸€èˆ¬çš„ãªå…±æœ‰ VPC è¨­å®šã§ã¯ã€DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã§ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚¾ãƒ¼ãƒ³ã‚’ä½œæˆã‚‚ã§ãã‚‹ãŒã€DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã ã¨ VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¤ãƒ³ãƒ•ãƒ©ã®æ‰€æœ‰æ¨©ã¯ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ãªããƒ›ã‚¹ãƒˆ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒæ‰€æœ‰ã™ã‚‹ã€‚

### VPC ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¨ã®é–¢ä¿‚æ€§

> â€¢ DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¨ Â [VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ”ã‚¢ãƒªãƒ³ã‚°](https://cloud.google.com/vpc/docs/vpc-peering)ã¯ç•°ãªã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¯ VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã§ãã¾ã™ãŒã€VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¯ DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã«å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

â‡’ VPC ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’ã—ãªãã¦ã‚‚ã€DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¯ã§ãã‚‹ã€‚

[DNS zones overview | Google Cloud](https://cloud.google.com/dns/docs/zones/zones-overview#peering_zones)

### â€»DNS Forwarding ã¨ã®é•ã„

ã‚ªãƒ³ãƒ—ãƒ¬ã¨ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã¯ãŠäº’ã„ã« DNS ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹ã€Œãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã€ãŒæŽ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ãŒã€DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ã¯ VPC å†…éƒ¨ã®è©±ã€‚ä»¥ä¸‹ã®å›³ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã€‚

![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled15.png)

[Cloud DNS ã®è»¢é€ã€ãƒ”ã‚¢ãƒªãƒ³ã‚°ã€é™å®šå…¬é–‹ã‚¾ãƒ¼ãƒ³ã«ã¤ã„ã¦ | Google Cloud Blog](https://cloud.google.com/blog/ja/products/networking/cloud-forwarding-peering-and-zones)

:::
:::details ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ DNS resolution ãŒå®Ÿè¡Œã•ã‚Œã‚‹å ´æ‰€ã®æŽ¨å¥¨æ–¹æ³•ã¯ï¼Ÿç•°ãªã‚‹ GCP ç’°å¢ƒã®å ´åˆã¯ã©ã†ã™ã‚‹ã‹ï¼Ÿ
**Use a hybrid approach with two authoritative DNS systems**
â‡’ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

> _Google-recommended practice is to use a hybrid approach with two authoritative DNS systems. Authoritative DNS resolution for your private Google Cloud environment is done by Cloud DNS. Authoritative DNS resolution for on-premises resources is hosted by existing DNS servers on-premises._
> â‡’ DNS ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µãƒ¼ãƒãƒ¼(=æ¨©å¨ DNS ã‚µãƒ¼ãƒãƒ¼)ã‚’ Cloud ã¨ On Prem ã«ãŠã„ã¦ã€äº’ã„ã«ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹ã€‚
> â€» ç•°ãªã‚‹ GCP ç’°å¢ƒã® DNS ã¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ããªã„ã€‚
> Cloud DNS cannot manage interorganizations DNS querys.
> ãã®å ´åˆã€VPN ã§äºŒã¤ã®ç’°å¢ƒã‚’æŽ¥ç¶šã—ã¦ã€DNS ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ã‚¾ãƒ¼ãƒ³è»¢é€ã®è¨­å®šã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
> [â€» **ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**é™å®šå…¬é–‹ãƒžãƒãƒ¼ã‚¸ãƒ‰ ã‚¾ãƒ¼ãƒ³ã«ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ã‚‚ã¤ Cloud DNS ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µãƒ¼ãƒãƒ¼ã«ã‚¯ã‚¨ãƒªã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€**DNS ãƒ”ã‚¢ãƒªãƒ³ã‚°ï¼ˆãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚¾ãƒ¼ãƒ³ï¼‰**ã‚’ä½¿ç”¨ã™ã‚‹ã€‚â‡” ä¸€æ–¹ã€**åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®**VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®ã¿ã‚¯ã‚¨ãƒªã™ã‚‹å ´åˆã€**é™å®šå…¬é–‹ã‚¾ãƒ¼ãƒ³**ã‚’ä½¿ã†ã€‚](https://www.notion.so/DNS-Cloud-DNS-DNS-VPC-d0e452355f56491b858f7397270814c3) > ![Untitled](MYWIKIb4ca2b4d73c84cfbabf6d0ddb61ef716/GCP7e976df6073f406ab4e0ec2704209da5/Networkee71dbe4ef384117b73419e3d5bf8ac0/Untitled.png) > [Best practices for Cloud DNS | Google Cloud](https://cloud.google.com/dns/docs/best-practices#choose_where_dns_resolution_is_performed)

:::

:::details Router vs Gateway?

> ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¯ã€ç•°ãªã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŒå£«ã‚’ä¸­ç¶™ã™ã‚‹ä»•çµ„ã¿ã®ç·ç§°ã€‚ãã® 1 ã¤ã¨ã—ã¦ã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’åˆ¤åˆ¥ã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä¸­ç¶™ã™ã‚‹ãƒ«ãƒ¼ã‚¿ãƒ¼ãŒã‚ã‚‹ã€‚
> VPN ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’ä½¿ã†ã¨ãã«ã€Cloud ã€€ Router ã‚‚ä¸€ç·’ã«ä½¿ã£ã¦ã„ã‚‹ã€‚è¦ã™ã‚‹ã« L3 ãƒ¬ãƒ™ãƒ«ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã« Router ãŒå¿…è¦ã§ã€ãã‚Œä»¥ä¸Šã®å±¤ã® VPN é€šä¿¡ã®å‡ºå…¥ã‚Šå£ã«ã¯ VPN ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒå¿…è¦ã€‚
> ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled16.png)

:::

:::details Cloud Router

## **Cloud Router**

Cloud Router ã¯ã‚¹ã‚¿ãƒ†ã‚£ãƒƒã‚¯ã¨ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«å¯¾å¿œã€‚

- Dynamic Routing
  ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ä½¿ã†ã«ã¯ã€BGP è¨­å®šãŒå¿…è¦ã€‚ãƒ«ãƒ¼ã‚¿ãƒ¼åŒå£«ã§ BGP ã«å¾“ã„ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¿½åŠ å‰Šé™¤ãªã©ã®ãƒˆãƒãƒ­ã‚¸ãƒ¼å¤‰åŒ–ã‚’è‡ªå‹•ã§ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚ºã—ã€é™çš„ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç®¡ç†ã¨ã‹ãŒä¸è¦ã«ãªã‚‹ã€‚
  - ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚ºã™ã‚‹
    ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶å¾¡åˆ†é‡Žã®ç”¨èªžã€‚Cloud Router ã®å ´åˆã€éš£æŽ¥ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒ«ãƒ¼ã‚¿ã«å¯¾è±¡ï¼ˆã‚µãƒ–ãƒãƒƒãƒˆã‚„å¤–éƒ¨ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã¸ã®çµŒè·¯æƒ…å ±ã‚’ä¼é”ã™ã‚‹ã“ã¨ã‚’æŒ‡ã™ã€‚
    çµŒè·¯åˆ¶å¾¡ã®ãŸã‚ã®ä»£è¡¨çš„ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒ BGPã€‚BGP ã§ GCP å†…å¤–ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒ Cloud Routerã€‚Cloud Router ã¨å¤–éƒ¨ã®ãƒ«ãƒ¼ã‚¿ãªã‚Šã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®é–“ã§ BGP ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒãªã•ã‚Œã€å„ AS å†…éƒ¨ã®ãƒ«ãƒ¼ãƒˆæƒ…å ±ãŒäº¤æ›ã•ã‚Œã‚‹ã“ã¨ã§ã€ã»ã‹ã® AS ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç²å¾—ã§ãã‚‹ã€‚
    æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯è‡ªå‹•çš„ã«é€šçŸ¥(ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚º)ã•ã‚Œã‚‹
    []()
    ![image.png](/images/20221015_professional-cloud-security-engineer/image9.png)
- Static Routing
  BGP ãŒä¸è¦ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
  > Policy-based and Route-based routing are the possible routing options in Cloud VPN that does not require BGP.
  > â‡” "Dynamic" requires BGP

### Cloud Router ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ«ãƒ¼ãƒˆ ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚º

Cloud Router ã¯ã€åŸºæœ¬çš„ã«ãƒªãƒ¼ã‚¸ãƒ§ãƒŠãƒ«ã€‚
â‡’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒžãƒ«ãƒãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã® VPC ã«ä¸€ã¤ã® Cloud Router ãŒå¯¾å¿œã™ã‚‹ã®ã§ã¯ãªãã¦ã€ãã®ä¸­ã®ç‰¹å®šãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚µãƒ–ãƒãƒƒãƒˆã«å¯¾ã—ã¦ä¸€ã¤ã® Cloud Router ãŒå¯¾å¿œã™ã‚‹(**ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰**)ã€‚è¨­å®šã‚’å¤‰ãˆã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã€ã¤ã¾ã‚Š VPC ã®ã‚µãƒ–ãƒãƒƒãƒˆå…¨ä½“ã®ãƒ«ãƒ¼ãƒˆã‚’ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚ºã™ã‚‹**ã‚°ãƒ­ãƒ¼ãƒãƒ«å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰**ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚

> Cloud Router ã«ã‚ˆã£ã¦ã€ãƒ«ãƒ¼ã‚¿ãƒ¼ãŒæ§‹æˆã•ã‚Œã¦ã„ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¾ãŸã¯ Virtual Private Cloudï¼ˆVPCï¼‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å…¨ä½“ã§ã‚µãƒ–ãƒãƒƒãƒˆãŒå‹•çš„ã«ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚ºã•ã‚Œã¦ã€å­¦ç¿’æ¸ˆã¿ãƒ«ãƒ¼ãƒˆãŒä¼æ’­ã•ã‚Œã¾ã™ã€‚
> VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã® Cloud Router ãŒãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‹ã¯ã€VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã¾ãŸã¯ç·¨é›†ã™ã‚‹ã¨ãã«ã€å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¾ãŸã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è¨­å®šã§ãã¾ã™ã€‚
> [å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ | Cloud Router | Google Cloud](https://cloud.google.com/network-connectivity/docs/router/how-to/configuring-routing-mode?hl=ja)

:::

:::details WAF ã¨ã¯ï¼ŸFirewall ã¨ã®é•ã„ã¯ä½•ï¼Ÿ

> WAFï¼ˆWeb Application Firewallï¼‰ã¯ã€Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã‚’çªã„ãŸæ”»æ’ƒã¸å¯¾ã™ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®ã²ã¨ã¤ã€‚Web ã‚¢ãƒ—ãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã€Œã‚·ã‚°ãƒãƒãƒ£ã€ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨˜éŒ²ã—ã¦ã„ã‚‹ã‚‚ã®ï¼‰ã‚’ç”¨ã„ã¦ç…§åˆã—ã€æ”»æ’ƒã‚’æ¤œçŸ¥ã€é€šä¿¡å¯å¦ã®åˆ¤æ–­ã‚’è¡Œã†ã€‚
> ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ï¼ˆFirewallï¼‰ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¬ãƒ™ãƒ«ã§ã®å¯¾ç­–ã§ã‚ã‚Šã€IP:ãƒãƒ¼ãƒˆç•ªå·ã§ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŠã‚ˆã³ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ã“ã¨ã€‚ç¤¾å†…ã§ã®ã¿ä½¿ç”¨ã™ã‚‹æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ã¸ã®å¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã‚‹ã“ã¨ã¯å¯èƒ½ã ãŒã€å¤–éƒ¨ã¸å…¬é–‹ã™ã‚‹å¿…è¦ã®ã‚ã‚‹ Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆ¶é™ã‚’æŽ›ã‘ã‚‹ã“ã¨ã¯ã§ããªã„ã®ã§ã€WAF ã®ç¯„ç–‡ã¨ãªã‚‹ã€‚

:::

:::details Google Front End ã¨ã€Cloud Armor ã«ã¤ã„ã¦ç°¡æ½”ã«èª¬æ˜Žã›ã‚ˆã€‚

### GFEï¼ˆGoogle Front Endï¼‰

ä»¥ä¸‹ã®å…¨ä½“ã‚’æŒ‡ã™ã‚‰ã—ã„

1. GCP ã® PoP ï¼ˆPoint Of Presenceï¼‰ï¼šå„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã®å…¥ã‚Šå£
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(å¤–éƒ¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ç€ä¿¡ã™ã‚‹ HTTP(S)ã€TCPã€TLS ãƒ—ãƒ­ã‚­ã‚·ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯)ã¯ã€PoP ã®ä¸­ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã«å‘ã‹ã„ã€ä¸€ç•ªè¿‘ã„ PoP ã¸å…¥ã‚‹
3. ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã§çµ‚ç«¯ã—ã€DDoS æ”»æ’ƒå¯¾ç­–ã‚’æä¾›(â†’L7 ãƒ¬ãƒ™ãƒ«ã€**Cloud Armor**)ã—ã¦ã€Google Cloud ã‚µãƒ¼ãƒ“ã‚¹è‡ªä½“ã¸ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŠã‚ˆã³è² è·åˆ†æ•£(over Google's global network to the closest backend that has sufficient capacity available.)

   â‡’ CloudArmor ã‚‚ã€LB ã¨åŒã˜ãã‚¨ãƒƒã‚¸ POP ã«ã‚ã‚‹

   > Google Cloud ãƒ—ãƒ­ã‚­ã‚·ãƒ™ãƒ¼ã‚¹å¤–éƒ¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã¯ã™ã¹ã¦ã€Google ã®æœ¬ç•ªç’°å¢ƒã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ä¸€éƒ¨ã§ã‚ã‚‹ Google Front Endï¼ˆGFEï¼‰ã‹ã‚‰ DDoS ä¿è­·ã‚’è‡ªå‹•çš„ã«ç¶™æ‰¿ã—ã¾ã™ã€‚

### Cloud Armor

- Google Cloud Armor ã¯ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ä»˜åŠ æ©Ÿèƒ½ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã€‚
- DDoS ä¿è­·ï¼‹ WAFã€‚ãƒ¬ã‚¤ãƒ¤ 7 å±žæ€§ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ¬ã‚¤ãƒ¤ 7 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚„ã‚¹ã‚¯ãƒ©ãƒ–ã«ã‚ˆã‚Šãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã€‚
  - DoS
    TWO ways that Google Cloud helps mitigate the risk of DDoS for its customers.
    1. **Internal capacity many times that of any traffic load we can anticipate.**â†’ å¤§è¦æ¨¡ DoS æ”»æ’ƒã®è² è·ã‚‚ç°¡å˜ã«å¸åŽã—ã¦ã—ã¾ã†ã€‚
    2. **State-of-the-art physical security for hardware and servers.**
- å¤–éƒ¨ HTTP(S) ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã€TCP ãƒ—ãƒ­ã‚­ã‚· ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã€ã¾ãŸã¯ SSL ãƒ—ãƒ­ã‚­ã‚· ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®èƒŒå¾Œã«ã‚ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ã‚µãƒ¼ãƒ“ã‚¹ã«ã®ã¿ä½¿ç”¨ã§ãã‚‹ã€‚è² è·åˆ†æ•£ã‚¹ã‚­ãƒ¼ãƒ ã¯ external ã§ã‚ã‚‹å¿…è¦ã€‚
- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†ã¨ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã—ãªãã¦ã‚‚ã€ãã®å½±éŸ¿ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¯èƒ½ã€‚
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled.jpeg)

:::

:::details Google Cloud ã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿è»¢é€æ™‚ã®æš—å·åŒ–ã«ã¤ã„ã¦ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨å®Ÿè£…ã«ä½¿ã‚ã‚Œã‚‹ã®ã¯ï¼Ÿ

### BoringSSL(å®Ÿè£…ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)

Google ã«ãŠã‘ã‚‹ã€è»¢é€æ™‚ã®ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚GoogleFrontEnd ã«ãŠã‘ã‚‹ TLS æš—å·åŒ–ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å®Ÿè£…ã«ä½¿ã‚ã‚Œã‚‹ã€‚ Google ãŒç¶­æŒç®¡ç†ã™ã‚‹ TLS ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹å®Ÿè£…ã§ã‚ã‚Šã€OpenSSL ã‹ã‚‰åˆ†å²ã—ãŸã‚‚ã®ã€‚
å†…éƒ¨ HTTP(S) è² è·åˆ†æ•£ã¯ã€Google ã® BoringSSL ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã€‚Google ã¯ã€FIPS-2 æº–æ‹ ãƒ¢ãƒ¼ãƒ‰ã§å†…éƒ¨ HTTP(S) è² è·åˆ†æ•£ã®ãŸã‚ã® Envoy ãƒ—ãƒ­ã‚­ã‚·ã‚’æ§‹ç¯‰ã€‚
â‡” HTTP(S) è² è·åˆ†æ•£ã¨ SSL ãƒ—ãƒ­ã‚­ã‚·è² è·åˆ†æ•£ã¯ Google ã® BoringCrypto ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹

> BoringSSL as a whole is not FIPS validated. However, there is a core library (called BoringCrypto) that has been FIPS validated.
> â€» **FIPS**ï¼ˆFederal Information Processing Standardï¼šç±³å›½é€£é‚¦æƒ…å ±å‡¦ç†è¦æ ¼ï¼‰**140-2**ã¯ã€æš—å·åŒ–ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æœ‰åŠ¹æ€§ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯ã€‚è£½å“ãŒ FIPS 140-2 èªå®šã®å ´åˆã€ãã®è£½å“ãŒç±³å›½æ”¿åºœã¨ã‚«ãƒŠãƒ€æ”¿åºœã«ã‚ˆã£ã¦ãƒ†ã‚¹ãƒˆã•ã‚Œã€æ­£å¼ã«æ¤œè¨¼ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã™ã€‚
> â‡’ Boring SSL ã®ã†ã¡ã€FIPS-2 æº–æ‹ ã®ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ Boring Crypto ã¨å‘¼ã°ã‚Œã‚‹ã€‚é¡§å®¢è»¢é€ä¸­ã‚„ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼é–“ã€ä¿å­˜ä¸­ãƒ‡ãƒ¼ã‚¿ãªã©ã¯ BoringCrypto ã§ FIPS-2 æº–æ‹ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§æš—å·åŒ–ã•ã‚Œã‚‹ãŒã€ãƒ­ãƒ¼ã‚«ãƒ« SSD ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãªã©ã¯éžå¯¾å¿œãªã®ã§ã€ç‹¬è‡ªã®æš—å·åŒ–ã‚’æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

### TLS/ALTS( ãƒ—ãƒ­ãƒˆã‚³ãƒ«)

**ALTS**(Application Layer Transport Security)ã¨ã„ã†æš—å·åŒ–ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚‚ã‚ã‚Šã€ã“ã¡ã‚‰ã‚‚ BoringSSL ã§å®Ÿè£…ã•ã‚Œã‚‹ã€‚ ALTS ã¯ç›¸äº’èªè¨¼/æš—å·åŒ–ã«ã‚ˆã‚Š RPC ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€‚Google Cloud ã‚µãƒ¼ãƒ“ã‚¹ã®å ´åˆã€RPC ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ ALTS ã‚’ä½¿ç”¨ã—ã¦ä¿è­·ã•ã‚Œã‚‹ã€‚

> Googleâ€™s Application Layer Transport Security (**ALTS**) is a mutual authentication and transport encryption system developed by Google and typically used for securing Remote Procedure Call (RPC) communications within Googleâ€™s infrastructure. ALTS is similar in concept to mutually authenticated TLS but has been designed and optimized to meet the needs of Googleâ€™s datacenter environments.

> â€» **remote procedure call**Â (**RPC**) is when a computer program causes a procedure (subroutine) to execute in a different address space (commonly on another computer on a shared network), which is coded as if it were a normal (local) procedure call, without the programmer explicitly coding the details for the remote interaction.
> ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled17.png)
> ALTS ã«ã¯ç›¸äº’ TLS ã«ä¼¼ãŸå®‰å…¨ãª **handshake** ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒã‚ã‚‹ã€‚ALTS ã‚’ä½¿ç”¨ã—ã¦é€šä¿¡ã—ã‚ˆã†ã¨ã™ã‚‹ 2 ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€æ©Ÿå¯†æƒ…å ±ã‚’é€ä¿¡ã™ã‚‹å‰ã«ã€ã“ã® handshake ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦é€šä¿¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èªè¨¼ãŠã‚ˆã³ãƒã‚´ã‚·ã‚¨ãƒ¼ãƒˆã™ã‚‹ã€‚
> ![https://cloud.google.com/static/images/security/alts-handshake.png?hl=ja](https://cloud.google.com/static/images/security/alts-handshake.png?hl=ja) > [Google Cloud ã§ã®è»¢é€ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ– | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cloud.google.com/docs/security/encryption-in-transit?hl=ja)

:::

:::details API Throttling and Rate Limiting: Whatâ€™s the Difference?

> throttling ã¯ã‚µãƒ¼ãƒãƒ¼(API)ã¸ã®è² è·ã‚’åˆ¶é™ã™ã‚‹ç›®çš„ã€API rate limiting ã¯å€‹äººã«ã‚ˆã‚‹é›†ä¸­ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã‚‹ç›®çš„ã€‚
> ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled18.png)

:::

:::details ã‚¿ã‚°ã¨ãƒ©ãƒ™ãƒ«ã€ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã«ã¤ã„ã¦èª¬æ˜Žã›ã‚ˆã€‚

### (ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯)ã‚¿ã‚°

- VPC å†…ã®ç‰¹å®šã® VM ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç¾¤ã«ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã‚’ç°¡å˜ã«é©ç”¨ã§ãã‚‹ã‚‚ã®ã€‚
  Network tags are used by networks to identify which VM instances are subject to certain firewall rules and network routes.
- ãƒ•ã‚¡ã‚¤ãƒ¤ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã¯ã‚¿ã‚°ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚‚ã¤ã‘ã‚‰ã‚Œã‚‹ï¼
  - ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé–“ã§ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚Œã°ã€ã‚¿ã‚°é–“ã¨ã¯é•ã£ã¦ã€ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¨­å®šã§ãã‚‹ã®ã§ã€ã‚¹ã‚³ãƒ¼ãƒ—ã§èªå¯ã•ã‚ŒãŸé€šä¿¡ã®ã¿ã‚’è¨±å¯ã§ãã‚‹ã€‚
  - ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã«ãªã‚‹ã®ã§ã€IAM ãƒ­ãƒ¼ãƒ«ã¨çµ„ã¿åˆã‚ã›ã¦ç‰¹å®šã®æ‰¿èªãƒ¦ãƒ¼ã‚¶ãƒ¼ã ã‘ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ã‚ˆã†ã«ã§ãã‚‹ã€‚
    ![image.png](/images/20221015_professional-cloud-security-engineer/image10.png)
    []()

### ãƒ©ãƒ™ãƒ«

- ãƒ©ãƒ™ãƒ«ã¯ã€GCP ã® Billing æƒ…å ±ã«ãƒžãƒ¼ã‚­ãƒ³ã‚°ã—ã¦ã€BQ ã‚„ DataStudio ã§è¦‹ã‚‹ã¨ãã«ä¾¿åˆ©
- ãƒªã‚½ãƒ¼ã‚¹éšŽå±¤ã‚’è¨­å®šã™ã‚‹ã¨ãã«ã‚‚ã€Œãƒ©ãƒ™ãƒ«ã€ã‚’ä½¿ã†ã¨ä¾¿åˆ©
  ![image.png](/images/20221015_professional-cloud-security-engineer/image11.png)

### ãƒ•ã‚¡ã‚¤ãƒ¤ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«

[]()

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã§ã¯ã€ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ã¯å…¨ã¦ãƒ–ãƒ­ãƒƒã‚¯ã€ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ã¯å…¨ã¦è¨±å¯

  ![image.png](/images/20221015_professional-cloud-security-engineer/image12.png)

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ(æš—é»™)ã®ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ã®ãƒ­ã‚°ã¯å‡ºåŠ›ã•ã‚Œãªã„ã€‚ãƒ­ã‚°ãŒæ¬²ã—ã‘ã‚Œã° priority65500 ã§åŒã˜ãƒ«ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚(VM ã®ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–ã—ã¦ã‚‚æ„å‘³ãªã„ã®ã§ã€VPC ã®ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹)
  > The traffic is not matching the expected ingress rule, thus it will fall to the IMPLICIT DENY INGRESS RULE which is never logged. Ingress packets are sampled after ingress firewall rules. If an ingress firewall rule denies inbound packets, those packets are not sampled by VPC Flow Logs.
  > â‡’ VPC ã®å…¨ traffic ã‚’è¦‹ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹äºŒã¤ã®ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ã‚ã‚Š

1. VPC Flow logs

   VPC Flow logs captures samples of the traffic flowing in and out of the subnet

2. Firewall logs

   Firewall logs shows traffic (allowed or denied) that has matched a firewall rule

- Network Admin/Security Roleã€ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã§ãã‚‹ã®ã¯ã€ã€
  - **Network Admin:**Â Permissions to create, modify, and delete networking resources, except for firewall rules and SSL certificates.
  - **Security Admin:**Â Permissions to create, modify, and delete \*\*\*\*firewall rules and SSL certificates.
- egress firewall rule ã‚’è¨­å®šã§ãã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ï¼Ÿ
  There are **only two google services that allow to filter egress traffic and those are Google Compute Engine and Kubernetes Engine**.Â  Regarding App Engine and Cloud functions, ingress rules are available but egress ones are not, so it's not a valid option. Cloud storage doesn't not allow to apply firewall rules.
- hostname ã§ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã§ãã‚‹ã‹ï¼Ÿ
  â‡’ å‡ºæ¥ãªã„ã€‚
  > When specifying a source for an ingress rule or a destination for an egress rule by address, you can only use an IPv4 address or IPv4 block in CIDR notation. Therefore is not possible to allow the traffic to a hostname.

:::
:::details å¤–éƒ¨ IP ã‚’æŒãŸãªã„ VM ãŒ Egress ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã‚’äºŒã¤æŒ™ã’ã€ãã‚Œãžã‚Œèª¬æ˜Žã›ã‚ˆã€‚

### NAT Gateway vs Private Google Access

- Google API ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã®å ´åˆã€Private Google Access ã‚’ä½¿ã†ã€‚

  > VM instances that have no external IP addresses can use **Private Google Access** to reach external IP addresses of Google APIs and services. By default, Private Google Access is disabled on a VPC network

  â‡’ VPC ã®ã‚µãƒ–ãƒãƒƒãƒˆã®è¨­å®šã§ Private Google Access ã‚’ On ã«ã™ã‚‹ï¼ˆVPC ãƒ¬ãƒ™ãƒ«ã§ã¯ enable ã«ã§ããªã„ï¼ï¼‰ã€‚ãã‚Œã«ã‚ˆã‚Šãã®ã‚µãƒ–ãƒãƒƒãƒˆã® VM ã¯ external IP ã‚’æŒãŸãšã¨ã‚‚ã€GCS ã¨ã‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ï¼ãŸã ã—ã€Cloud NAT ã‚’è¨­å®šã—ãªã„ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã€‚apt update ã¨ã‹ã‚‚ã§ããªã„ã€‚ã€‚

  â€» **VPC Service Control ã¨ã®é•ã„**

  - åˆ©ç”¨ã™ã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé•ã†ã€‚[private.googleapis.com](http://private.googleapis.com/) ã‚’ä½¿ã†ã®ãŒ Private Google Accessã€ [restricted.googleapis.com](http://restricted.googleapis.com/) ã‚’ä½¿ã†ã®ãŒ VPC Service Control
  - ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ API ã®ç¨®é¡žã‚‚é•ã†ã€‚restricted.googleapis.com ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ API ãŒé™å®šã•ã‚Œã‚‹ã€‚
    ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled19.png)
    [é™å®šå…¬é–‹ã® Google ã‚¢ã‚¯ã‚»ã‚¹ã®ä»•çµ„ã¿ã¨æ‰‹é †ã‚’ãã£ã¡ã‚Šè§£èª¬ - G-gen Tech Blog](https://blog.g-gen.co.jp/entry/private-google-access-explained#privategoogleapiscom--restrictedgoogleapiscom-%E3%81%AE%E9%81%95%E3%81%84)

- Google API ä»¥å¤–ã®å…¬é–‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯ NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒå¿…è¦ - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã®ã‚µãƒ–ãƒãƒƒãƒˆã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸ VM ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰å¤–ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æŽ¥ç¶šã—ã¦ã€å¿…è¦ãªã‚‚ã®ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€ãªã©ã®å ´åˆã€NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’ä½œã‚‹ãŒã€ãã®éš›ã«ã¯ Cloud Router ã‚’ã‚µãƒ–ãƒãƒƒãƒˆã”ã¨ã«è¨­ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ > Instead, you will setup the Cloud NAT service to allow these VM instances to make outbound requests in order to install Apache Web server and PHP when they are launched. You create a **Cloud Router** for each managed instance group, one inÂ **us-central1**Â and one in theÂ **europe-west1**Â region, which you configure in the next task.
  â‡” é€†ã«ã€å¤–éƒ¨ IP ã‚’æŒãŸãªã„éžå…¬é–‹ VPC ã® VM ã¸ SSH ãªã©ã‚’ã™ã‚‹å ´åˆã€IP ç¯„å›² Â 35.235.240.0/20Â  ã‹ã‚‰ã®ä¸Šã‚Šï¼ˆå†…å‘ãï¼‰ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’è¨±å¯ã—ã€IAP TCP è»¢é€ã‚’ä½¿ã†ã€‚
  â‡’ å¤–ã‹ã‚‰éžå…¬é–‹ VPC å†…éƒ¨ã® INTERNAL IP ã¸ TCP ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ãŒ IAP TCP è»¢é€
  â€» ï¼¶ï¼­ã‹ã‚‰éžå…¬é–‹ VPC å†…éƒ¨ã® INTERNAL IP ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ã¯ Private Service Access
  [Private Service Access ã¨ã¯ï¼Ÿä¾‹ã‚’æŒ™ã’ã¦èª¬æ˜Žã›ã‚ˆã€‚Private Google Access ã¨ã®é•ã„ã¯ï¼Ÿ](https://www.notion.so/Private-Service-Access-Private-Google-Access-17022c2142454da0b8c72e7f26cb3ca6)
  :::
  :::details Private Service Access ã¨ã¯ï¼Ÿä¾‹ã‚’æŒ™ã’ã¦èª¬æ˜Žã›ã‚ˆã€‚Private Google Access ã¨ã®é•ã„ã¯ï¼Ÿ
  ä¾‹ï¼šCloudSQL
  > You require access to Cloud SQL instances from VPC instances with private IPs. Google and third parties (known as service producers) offer services with internal IP addresses hosted in an underlying VPC network. Cloud SQL is one of those Google services.
  > Private service access lets you create private connections between your VPC network and the underlying Google service producers' VPC network.
  > To use private service access, you must activate the service networking API in the project, then create a private connection to a service producer.

### Private Google Access ã¨ã®é•ã„

> Private Google Access is not the same as private service access. Private Google access allows VM instances with internal IPs to reach the EXTERNAL IP addresses of Google APIs and Services.
> â‡’ Google ã‚µãƒ¼ãƒ“ã‚¹ã®å¤–éƒ¨ API ã«ï¼ˆéžå…¬é–‹ VPC å†…éƒ¨ã® VM ã‹ã‚‰ï¼‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ãŒ Private Google Access
> â‡” VPC ã® INTERNAL IP ã¸ï¼ˆVM ã‹ã‚‰ï¼‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ãŒ Private Service Accessã€‚
> â‡” GCP ã®ã‚µãƒ¼ãƒãƒ¬ã‚¹ç’°å¢ƒã‹ã‚‰ VPC ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ãŒã‚µãƒ¼ãƒãƒ¬ã‚¹ VPC ã‚¢ã‚¯ã‚»ã‚¹ã€‚
> [AppEngine ã‚„ CloudRun/Functions ãªã©ã‹ã‚‰ VPC ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ](https://www.notion.so/AppEngine-CloudRun-Functions-VPC-e916ca12f54b4708a59ba0c69448af22)

:::

:::details AppEngine ã‚„ CloudRun/Functions ãªã©ã‹ã‚‰ VPC ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ
**ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ VPC ã‚¢ã‚¯ã‚»ã‚¹**ã‚’ä½¿ã†ã€‚**VPC æŽ¥ç¶šã‚³ãƒã‚¯ã‚¿**ã‚’é€šã—ã¦ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ç’°å¢ƒã¨ VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å‡¦ç†ã™ã‚‹ã€‚ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ VPC ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ§‹æˆã™ã‚‹ã¨ã€ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ç’°å¢ƒã§ã€å†…éƒ¨ DNS ã¨å†…éƒ¨ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆRFC 1918 ãŠã‚ˆã³ RFC 6598 ã§å®šç¾©ï¼‰ã‚’ä½¿ç”¨ã—ã¦ VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚‚å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
[Serverless VPC Access | Google Cloud](https://cloud.google.com/vpc/docs/serverless-vpc-access) > ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled20.png)

ä¾‹ï¼‰App Engine ã§ã¯ã€é¡§å®¢ã® VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ç‰¹å®šã®é™çš„ IP ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ãã“ã«ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚App Engine ã§ã¯ä¸‹ã‚Šï¼ˆå¤–å‘ãï¼‰åˆ¶å¾¡ã§ã€ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ VPC ã‚¢ã‚¯ã‚»ã‚¹ã¨ Cloud NAT ã‚’ä½¿ç”¨ã—ã¦ã€å®‰å®šæ€§ã®ã‚ã‚‹é™çš„ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ§‹æˆã—ã¦ã„ã‚‹ã€‚

> C. Correct! App Engine uses a fixed set of NAT and health check IP address ranges that must be permitted into the VPC. Because the charges must be incurred by the credit analysis team, you need to create the connector on the client side.

:::

:::details VPC ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒå®ˆã‚‹ã‚‚ã®ã¯ï¼Ÿã©ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã‹ï¼ŸBridge ã¨ã¯ï¼ŸPrivate Google Access ã¨ã®é•ã„ã¯ï¼Ÿ

### API ã‚’å®ˆã‚‹

- VPC å¤–ã«ã‚ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ã€ã¨å‹˜é•ã„ã•ã‚ŒãŒã¡ã ãŒã€å®Ÿéš›ã«ã¯å„ç¨® API ã‚’åˆ¶å¾¡ã™ã‚‹ã€‚ã‚ãã¾ã§ API ã‚’åˆ¶å¾¡ã™ã‚‹ã®ã§ã€GCE ã¸ã® SSH ã‚„ RDP ã¨ã„ã£ãŸç›´æŽ¥ã‚¢ã‚¯ã‚»ã‚¹ã¯åˆ¶å¾¡ã§ããªã„ã€‚
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¼å¢ƒç•Œã‚’ä½œæˆã—ã€å¢ƒç•Œå†…ã®å„ç¨® Google Cloud API ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ IP ã ã‘ã§ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ä½ç½®ã€ãƒ‡ãƒã‚¤ã‚¹ã€æ™‚é–“å¸¯ãªã©æ§˜ã€…ãªæ–¹æ³•ã§åˆ¶å¾¡ã§ãã‚‹ã€‚
  ![image.png](/images/20221015_professional-cloud-security-engineer/image13.png)

### è¨­å®šæ–¹æ³•

- **Access Context Manager**ã§**ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«**ã‚’å®šç¾©ã—ã€ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã‹ã‚‰å‚ç…§ã™ã‚‹ã“ã¨ã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã™ã‚‹ã€‚(åˆæœŸã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ãŸæ©Ÿèƒ½ã€‚API æ¯Žã«ç•°ãªã‚‹ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’åˆ©ç”¨ã—ãŸã„å ´åˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ†é›¢ã—ã€åˆ¥ã€…ã®ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã§ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸ)
- API æ¯Žã«ã‚ˆã‚Šç´°ã‹ãåˆ¶å¾¡ã™ã‚‹å ´åˆã¯**Ingress Policy**ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
- å¢ƒç•Œå†…ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰å¢ƒç•Œå¤–ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã§ããªã„ã€‚ãã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã«ã¯**Egress Policy**ã‚’è¨­å®šã—ã€æŽ¥ç¶šã•ã‚Œã‚‹å´ã§ã¯ Ingress Policy ã‚’è¨­å®šã™ã‚‹å¿…è¦ã‚ã‚Šã€‚
  ![IMG_7545.jpg](/images/20221015_professional-cloud-security-engineer/IMG_7545.jpg)
  Google Cloud ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º IT åŸºç›¤æ§‹ç¯‰ã‚¬ã‚¤ãƒ‰ p247 ãƒšãƒ¼ã‚¸

### Bridge ã¨ã¯

VPC Service Controls help define scope perimeter and protect a VPC from unauthorized access. Two VPC Service Control perimeters can be interconnected with the help of a bridge. A bridge is bidirectional in communication, but not transitive. This means that if Project A and B have their perimeters bridged, and if Project B and C also have a bridge, Project A will not automatically be bridged to Project C.
[ãƒ–ãƒªãƒƒã‚¸ã‚’ä½¿ç”¨ã—ã¦å¢ƒç•Œã‚’è¶Šãˆã¦å…±æœ‰ã™ã‚‹ | VPC Service Controls | Google Cloud](https://cloud.google.com/vpc-service-controls/docs/share-across-perimeters?hl=ja)
[VPC Service Controls ã‚’åˆ†ã‹ã‚Šã‚„ã™ãè§£èª¬ - G-gen Tech Blog](https://blog.g-gen.co.jp/entry/vpc-service-controls-explained#VPC-Service-Controls-%E3%81%A8%E3%81%AF)

### **VPC Service Control ã¨ Private Google Access ã®é•ã„**

- åˆ©ç”¨ã™ã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé•ã†ã€‚[private.googleapis.com](http://private.googleapis.com/) ã‚’ä½¿ã†ã®ãŒ Private Google Accessã€ [restricted.googleapis.com](http://restricted.googleapis.com/) ã‚’ä½¿ã†ã®ãŒ VPC Service Control
- ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ API ã®ç¨®é¡žã‚‚é•ã†ã€‚restricted.googleapis.com ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ API ãŒé™å®šã•ã‚Œã‚‹ã€‚
- Private Google Access ã¯å¤–éƒ¨ IP ã‚’æŒãŸãªã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚‚ Google ã®ã‚µãƒ¼ãƒ“ã‚¹ APIï¼ˆå¤–éƒ¨ IPï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ä»•çµ„ã¿
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled19.png)
  [é™å®šå…¬é–‹ã® Google ã‚¢ã‚¯ã‚»ã‚¹ã®ä»•çµ„ã¿ã¨æ‰‹é †ã‚’ãã£ã¡ã‚Šè§£èª¬ - G-gen Tech Blog](https://blog.g-gen.co.jp/entry/private-google-access-explained#privategoogleapiscom--restrictedgoogleapiscom-%E3%81%AE%E9%81%95%E3%81%84)
  :::
  :::details SOCKS proxy ã¨ã¯ï¼ŸHTTP proxyã€NAT ã¨ã®é•ã„ã‚’èª¬æ˜Žã›ã‚ˆã€‚
  ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒå¤–éƒ¨ã¨é€šä¿¡ã™ã‚‹æŠ€è¡“ã¨ã—ã¦ NAT ã¨ãƒ—ãƒ­ã‚­ã‚·ãŒã‚ã‚‹ã€‚ãƒ—ãƒ­ã‚­ã‚·ã®ã†ã¡ã€ä¸»ã« Web ã§åˆ©ç”¨ã™ã‚‹ã®ãŒ HTTP ãƒ—ãƒ­ã‚­ã‚·ã€ãƒ¡ãƒ¼ãƒ«ãªã© TCP/IP å…¨èˆ¬ã‚’å¯¾è±¡ã¨ã™ã‚‹ã®ãŒ SOCKS ãƒ—ãƒ­ã‚­ã‚·ã€‚
- NAT ã¯é€éŽæ€§ãŒã‚ã‚‹ï¼ˆï¼ã‚°ãƒ­ãƒ¼ãƒãƒ« IP ã‚’æŒã£ã¦ã„ãªã„ã“ã¨ã‚’æ„è­˜ã—ãªãã¦ã„ã„ã€‚IP ãƒ‘ã‚±ãƒƒãƒˆã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ NAT è£…ç½®ãŒæ›¸ãæ›ãˆã‚‹ã ã‘ãªã®ã§ã€LAN å†…ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¯å…ˆæ–¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆã ã‘åˆ†ã‹ã‚Œã°ã„ã„ï¼‰
- â‡” ãƒ—ãƒ­ã‚­ã‚·ã¯é€éŽæ€§ãŒãªã„ï¼ˆ=æ˜Žç¤ºçš„ã« SOCKS ã‚µãƒ¼ãƒãƒ¼ã‚’æŒ‡å®šã—ã€SOCKS ã‚µãƒ¼ãƒãƒ¼ãŒå…ˆæ–¹ã¨é€šä¿¡ã™ã‚‹ï¼‰
  [NAT ã‚’ã‚„ã‚ã¦ã€é€éŽ SOCKS ãƒ—ãƒ­ã‚­ã‚·ã‚’å°Žå…¥ã—ãŸ - Cybozu Inside Out | ã‚µã‚¤ãƒœã‚¦ã‚ºã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ãƒ–ãƒ­ã‚°](https://blog.cybozu.io/entry/2016/03/14/130000)
  :::
  :::details ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œã€target filteringã€subnet isolation ã«ã¤ã„ã¦èª¬æ˜Žã›ã‚ˆã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œã¨ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã®é•ã„ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œã¨ AccessContextManager ã«ã‚ˆã‚‹åˆ¶å¾¡ã®ç›´æ„Ÿçš„é•ã„ã‚’ä¸€è¨€ã§è¨€ã†ã¨ï¼Ÿ

### Security perimiter

a security perimiter is what you create when you implement a firewall using egress rules to block outbound traffic. In thise case you can use the firewall rules to block all external communications so information will never leave the VPC.
â‡’ ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã¨ã¯é•ã†ï¼ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã¯ API ã‚’ä¿è­·ã™ã‚‹å¢ƒç•Œ â‡” åŸºæœ¬çš„ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œã¯ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ã®æƒ…å ±æ¼æ´©ã‚’é®æ–­ã™ã‚‹ã‚‚ã®ã‚‰ã—ã„ã€‚

### target filetering

fire wall ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã® VM ã‚’çµžã‚Šè¾¼ã‚€ã“ã¨ã€‚tag or service account ã‚’ä½¿ã†ã€‚å¾Œè€…ã¯**subnet isolation**ã¨ã„ã†ã€‚

> Summary:
> VPCs allow secure communication between resources. The specific rules for resource communication should be added to the firewall. Firewalls can use target filtering with the help of tags or subnet isolation. **Subnet isolation** with the help of service accounts is the recommended method for this situation.

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œã¨ AccessContextManager ã«ã‚ˆã‚‹åˆ¶å¾¡ã®é•ã„

> Compromised code: Access Context Manager is more focused on checking that certain requirements are met before granting users access to the resources, but will be useless for stopping malicious code inside GCP trying to connect to the outside to leak information.

â‡’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œã¯ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ã¸ã®æƒ…å ±é€ä¿¡ã‚’é®æ–­ã™ã‚‹ã€‚ACM ã¯ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ã«ä»˜åŠ çš„ãªèªè¨¼æ¡ä»¶ã‚’è¿½åŠ ã™ã‚‹ã€‚
[Best practices and reference architectures for VPC design | Cloud Architecture Center | Google Cloud](https://cloud.google.com/architecture/best-practices-vpc-design#isolate-vms-service-accounts)
:::

:::details IAP ã¨ AccessContextManager ã‚’æ¯”è¼ƒã›ã‚ˆã€‚

- BeyondCorp ã¯ã„ã‚ã‚“ãªæŠ€è¡“ã®çµ„ã¿åˆã‚ã›ã§ã‚ã‚Šã€Identity-Aware Proxy (IAP)ã‚„ Access Context Manager ãŒãã®ä¸­ã®ä¸»è¦ãªæ§‹æˆè¦ç´ 
  - BeyondCorp ã¨ã¯
    BeyondCorp ã¯ã€Google ãŒå®Ÿè£…ã—ãŸã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆ ãƒ¢ãƒ‡ãƒ«ã€‚
    ä¿¡é ¼ã•ã‚Œãªã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ VPN ã‚’ä½¿ã‚ãšã«ã™ã¹ã¦ã®å¾“æ¥­å“¡ãŒä½œæ¥­ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¢ƒç•Œã§è¡Œã£ã¦ã„ãŸã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼å˜ä½ã§è¡Œã†ã“ã¨ã§ã€å¾“æ¥ã®ã‚ˆã†ã« VPN ã‚’ä»‹ã•ãªãã¦ã‚‚å®Ÿè³ªçš„ã«ã©ã“ã‹ã‚‰ã§ã‚‚å®‰å…¨ã«ä½œæ¥­ã§ãã‚‹ã€‚
    - BeyondCorp ã¯ã„ã‚ã‚“ãªæŠ€è¡“ã®çµ„ã¿åˆã‚ã›ã§ã‚ã‚Šã€**Identity-Aware Proxy (IAP)**ã‚„**Access Context Manager**ãŒãã®ä¸­ã®ä¸»è¦ãªæ§‹æˆè¦ç´ 
      BeyondCorp ã§ã¯ã€ã‚·ãƒ³ã‚°ãƒ« ã‚µã‚¤ãƒ³ã‚ªãƒ³ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒãƒªã‚·ãƒ¼ã€ãƒ—ãƒ­ã‚­ã‚·ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŠã‚ˆã³ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ã®èªè¨¼ã¨æ‰¿èªãŒå¯èƒ½ã€‚BeyondCorp ã®åŽŸå‰‡
    - æŽ¥ç¶šã—ã¦ã„ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã‚ˆã£ã¦ã€ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹å¯å¦ãŒå·¦å³ã•ã‚Œã‚‹ã“ã¨ã¯ãªã„
    - ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã«åŸºã¥ã„ã¦ä»˜ä¸Žã•ã‚Œã‚‹
    - ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’èªè¨¼ã€èªå¯ã€æš—å·åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- AccessContextManager ã§ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’ä½œæˆã§ãã€IAP ã§ä¿è­·ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã« IAM condition ã§ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’æŒ‡å®šã—ã¦é©ç”¨ã•ã›ã‚‹ã€‚ã¾ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒ‡ãƒã‚¤ã‚¹ã®ç¨®é¡žã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID ãªã©ï¼‰ã«åŸºã¥ã„ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã€‚
- IAP(ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒªã‚½ãƒ¼ã‚¹ä¿è­·)ã¨ã‹ VPC ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«(API ä¿è­·)ãŒèªè¨¼ãƒ¬ã‚¤ãƒ¤ã‚’è¿½åŠ ã™ã‚‹ä»•çµ„ã¿ã§ã€IAM æ¡ä»¶(IAM conditions)ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’æŒ‡å®šã§ãã‚‹ã€‚
- ãŸã¨ãˆã°ã€High_Level ã¨ã„ã†ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’ä½œæˆã—ã¦ã€é«˜ã„æ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å°‘äººæ•°ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã—ãŸã‚Šã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã™ã‚‹ IP ç¯„å›²ãªã©ã€ä¿¡é ¼ã§ãã‚‹ã‚ˆã‚Šä¸€èˆ¬çš„ãªã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç‰¹å®šã—ã€Medium_Level ã¨ã„ã†ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’ä½œæˆã—ã¦ã€ã“ã‚Œã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã™ã‚‹ã€‚ > Cloud Identity Aware proxy allows to control access to cloud-based and on-premises applications and VMs running on Google Cloud and also verify user identity and use context to determine if a user should be granted access. This effectively implements a zero-trust access model that also supports multi factor authentication. > [ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã®ä½œæˆã¨é©ç”¨ | BeyondCorp Enterprise | Google Cloud](https://cloud.google.com/beyondcorp-enterprise/docs/access-levels?hl=ja) > ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled21.png)
  :::
  :::details VM ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ä½¿ã„æ–¹ï¼Ÿ
  Use VM metadata to read the current machineâ€™s IP address and use a startup script to add access to Cloud SQL. Store Cloud SQLâ€™s connection string, username, and password in Secret Manager.
  â‡’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯ä½¿ãˆãªã„ã€‚
  [About VM metadata | Compute Engine Documentation | Google Cloud](https://cloud.google.com/compute/docs/metadata/overview#vm_metadata_uses)
  :::

:::details Confidential VM/Shielded VM ã®å…±é€šç‚¹ã¨é•ã„ã‚’è¿°ã¹ã‚ˆã€‚
**Confidential VM**ï¼šãƒ¡ãƒ¢ãƒªãƒ¼ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚‚å€‹åˆ¥ã®æš—å·éµã§æš—å·åŒ–ã™ã‚‹ã€‚

> Summary:
> Confidential VMs use AMDâ€™s Secure Encrypted Virtualization, which keeps data encrypted in RAM. They can be managed using Customer-Supplied or Customer-Managed Encryption Keys. These instances contain dedicated AES engines that encrypt data as it flows out of sockets and decrypt data when it is read.
> **Shielded VM**ï¼šVM ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ¤œè¨¼å¯èƒ½ãªæ•´åˆæ€§ã‚’æä¾›ã™ã‚‹ã€‚
> ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒãƒ–ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã¾ãŸã¯ã‚«ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã®ãƒžãƒ«ã‚¦ã‚§ã‚¢ã‚„ãƒ«ãƒ¼ãƒˆã‚­ãƒƒãƒˆã«ã‚ˆã£ã¦æ”¹ã–ã‚“ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚ Shielded VM ã®æ•´åˆæ€§æ¤œè¨¼æ©Ÿèƒ½ã¯ã€æ¬¡ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦å®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚

- ã‚»ã‚­ãƒ¥ã‚¢ãƒ–ãƒ¼ãƒˆ
- vTPM å¯¾å¿œã®ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒ‰ ãƒ–ãƒ¼ãƒˆ
- æ•´åˆæ€§ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### Confidential VM/Shielded VM ã®é•ã„

- Confidential VM ã¯ãƒ¡ãƒ¢ãƒªãƒ¼ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚‚å€‹åˆ¥ã®æš—å·éµã§æš—å·åŒ–ã™ã‚‹ã“ã¨ã€Shielded VM ã¯ã‚»ã‚­ãƒ¥ã‚¢ãƒ–ãƒ¼ãƒˆã«å¯¾å¿œã™ã‚‹ã“ã¨ã€‚
  â€» **ã‚»ã‚­ãƒ¥ã‚¢ãƒ–ãƒ¼ãƒˆ**ï¼šãƒ–ãƒ¼ãƒˆãƒ—ãƒ­ã‚»ã‚¹ä¸­ã«èµ·å‹•ã—ãŸå„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åãŒä»˜ã‘ã‚‰ã‚Œã€ã“ã®ç½²åãŒ UEFI BIOS ã«å†…è”µã•ã‚ŒãŸä¿¡é ¼æ¸ˆã¿è¨¼æ˜Žæ›¸ã®ã‚»ãƒƒãƒˆã¨ç…§åˆã•ã‚Œã¦æ¤œè¨¼ã•ã‚Œã€æ­£å½“ãªã‚‚ã®ã—ã‹èµ·å‹•ã—ãªã„ã€‚å¾“æ¥ã® BIOS ã«ä»£ã‚ã‚‹ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ â‡”OS é–“ã®é€šä¿¡ä»•æ§˜ã‚’å®šã‚ãŸæ¨™æº–è¦æ ¼**UEFI**ï¼ˆUnified Extensible Firmware Interfaceï¼‰ãƒ–ãƒ¼ãƒˆãƒžãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒæä¾›ã™ã‚‹æ©Ÿèƒ½ã€‚
  ï¼ˆè¨­å®šä¾‹ï¼‰
  Prepare a shell script. Add the command gcloud compute instances stop with the Node.js instance name
  â‡’ You need to stop the Compute Engine instance before creating the image.
  Set up certificates for secure boot. Add gcloud compute images
  create, and specify the Compute Engine instanceâ€™s persistent disk and zone and the certificate files
  â‡’ Secure boot requires setting up certificates to establish trust between platform, firmware, and OS.
  Add gcloud compute images add-iam-policy-binding and specify the â€˜developmentâ€™ group.
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled22.png)
  [UEFI ã¨ã¯ - IT ç”¨èªžè¾žå…¸](https://e-words.jp/w/UEFI.html#:~:text=UEFI%E3%80%90UnifiedExtensibleFirmwareInterface,%E3%81%AEBIOS%E3%81%AB%E4%BB%A3%E3%82%8F%E3%82%8B%E3%82%82%E3%81%AE%E3%80%82)
  ![image.png](/images/20221015_professional-cloud-security-engineer/image14.png)

### Confidential VM/Shielded VM ã®å…±é€šç‚¹

1. SEV

   Confidential VM or Shielded VMs ã¯ã€AMD Secure Encrypted Virtualizationï¼ˆ**SEV**ï¼‰ã‚’æ­è¼‰ã—ãŸ AMD EPYC ãƒ—ãƒ­ã‚»ãƒƒã‚µã‚’ä½¿ç”¨ã™ã‚‹ãƒ›ã‚¹ãƒˆã§å®Ÿè¡Œã•ã‚Œã‚‹ã€‚

2. æ•´åˆæ€§ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼ˆã¨ã€ãã‚Œã«ä½¿ã‚ã‚Œã‚‹ vTPM å¯¾å¿œã®ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒ‰ ãƒ–ãƒ¼ãƒˆæ¸¬å®šå€¤ï¼‰

   - A way to determine whether a VM instance's boot sequence has changed
   - Virtual Trusted Platform Module (**vTPM**)ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ Confidential VM or Shielded VM ã§æ•´åˆæ€§ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚’ä½¿ãˆã‚‹ã€‚

     - **TPM**

       > Trusted Platform Module ã¨ã¯ ã‚»ã‚­ãƒ¥ã‚¢ãªæš—å·ãƒ—ãƒ­ã‚»ãƒƒã‚µã®å›½éš›è¦æ ¼ã§ã™ã€‚æš—å·éµã‚’ãƒ‡ãƒã‚¤ã‚¹å†…ã«æŒã¤ã“ã¨ã§ã‚»ã‚­ãƒ¥ã‚¢ãªæš—å·ãƒ—ãƒ­ã‚»ãƒƒã‚µã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

       TPM ã¯é€šå¸¸ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¾ã™ãŒã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®å®Ÿè£…ã‚‚ã‚ã‚Šã¾ã™ã€‚TPM ã®è¦ã¯æš—å·éµãŒãƒ‡ãƒã‚¤ã‚¹ã®ä¸­ã«ã‚ã‚‹ã“ã¨ã€‚

     - **vTPM**
       > ä»®æƒ³ Trusted Platform Module (vTPM) ã¯ã€ç‰©ç†çš„ãª Trusted Platform Module 2.0 ãƒãƒƒãƒ—ã‚’ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã—ãŸã‚‚ã®ã§ã™ã€‚
       > vTPM ã¯ã€ãƒ©ãƒ³ãƒ€ãƒ ãªç•ªå·ã®ç”Ÿæˆã€è¨¼æ˜Žã€ã‚­ãƒ¼ã®ç”Ÿæˆãªã©ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ ãƒ™ãƒ¼ã‚¹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚vTPM ã‚’ä»®æƒ³ãƒžã‚·ãƒ³ã«è¿½åŠ ã™ã‚‹ã¨ã€ã‚²ã‚¹ãƒˆ OS ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚­ãƒ¼ã‚’ä½œæˆã—ã¦ã€ä¿ç®¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ã¯ã€ã‚²ã‚¹ãƒˆ OS è‡ªä½“ã«ã¯å…¬é–‹ã•ã‚Œã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€ä»®æƒ³ãƒžã‚·ãƒ³æ”»æ’ƒã®å¯¾è±¡é ˜åŸŸãŒç‹­ã‚ã‚‰ã‚Œã¾ã™ã€‚é€šå¸¸ã€ã‚²ã‚¹ãƒˆ OS ã®ä¾µå®³ãŒèµ·ãã‚‹ã¨æ©Ÿå¯†æƒ…å ±ãŒä¾µå®³ã•ã‚Œã¾ã™ãŒã€ã‚²ã‚¹ãƒˆ OS ã§ vTPM ã‚’æœ‰åŠ¹ã«ã—ã¦ãŠãã¨ã€ã“ã®ãƒªã‚¹ã‚¯ã‚’å¤§å¹…ã«ä½Žæ¸›ã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ã¯ã€ã‚²ã‚¹ãƒˆ OS ãŒæš—å·åŒ–ã¾ãŸã¯ç½²åã®ç›®çš„ã«ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚
       > [ä»®æƒ³ Trusted Platform Module ã®æ¦‚è¦](https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.security.doc/GUID-6F811A7A-D58B-47B4-84B4-73391D55C268.html)

   - vTPM ã¯ãƒ–ãƒ¼ãƒˆæ™‚ï½žå¾Œç¶šã®ã‚¤ãƒ™ãƒ³ãƒˆã®ã™ã¹ã¦ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦ä¿å­˜ã™ã‚‹ï¼ˆ**ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒ–ãƒ¼ãƒˆ**ï¼‰ã€‚æœ€åˆã®ãƒ–ãƒ¼ãƒˆæ™‚ã®ãƒãƒƒã‚·ãƒ¥ãŒãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼ˆbaseline policyï¼‰ã¨ã—ã¦ä½¿ã‚ã‚Œã€ä»¥å¾Œã®å„ãƒªãƒ–ãƒ¼ãƒˆã®ãƒãƒƒã‚·ãƒ¥ã¨æ¯”è¼ƒã•ã‚Œã€å¤‰æ›´ç‚¹ã‚’æ¤œçŸ¥ã™ã‚‹ã€‚
     ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled23.png)
   - ãƒ–ãƒ¼ãƒˆæ™‚ã®ãƒ­ã‚°ï¼ˆLaunch Attestationï¼‰ã¯ãƒ­ã‚®ãƒ³ã‚°ã§ sevLaunchAttestationReportEvent ã¨ã—ã¦æ•´åˆæ€§æ¤œè¨¼ã‚¤ãƒ™ãƒ³ãƒˆãŒæ•´åˆæ€§ãƒ¬ãƒãƒ¼ãƒˆã«å‡ºåŠ›ã•ã‚Œã‚‹ã€‚

   > When restarting, Confidential VMs generate a unique log called **Launch Attestation**. Cloud Logging can be used to filter the logs and collect **sevLaunchAttestationReportEvent**.

   [Cloud Monitoring ã‚’ä½¿ç”¨ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ¤œè¨¼ | Confidential VMs | Google Cloud](https://cloud.google.com/compute/confidential-vm/docs/monitoring?hl=ja#about_launch_attestation_report_events)

### ã‚·ãƒ¼ãƒ«ãƒ‰ã•ã‚ŒãŸ GKE ãƒŽãƒ¼ãƒ‰ã¨ã®é–¢ä¿‚

> ã‚·ãƒ¼ãƒ«ãƒ‰ã•ã‚ŒãŸ GKE ãƒŽãƒ¼ãƒ‰ã¯ã€Compute Engine ã® Â [Shielded VM](https://cloud.google.com/security/shielded-cloud/shielded-vm)Â  ä¸Šã«æ§‹ç¯‰ã•ã‚Œã¾ã™ã€‚ã‚·ãƒ¼ãƒ«ãƒ‰ã•ã‚ŒãŸ GKE ãƒŽãƒ¼ãƒ‰ãŒãªã„ã¨ã€æ”»æ’ƒè€…ã¯ Pod ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã—ã€ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—èªè¨¼æƒ…å ±ã‚’æŠœãå–ã£ã¦ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®ãƒŽãƒ¼ãƒ‰ã«ãªã‚Šã™ã¾ã™ã“ã¨ã§ã€ã‚¯ãƒ©ã‚¹ã‚¿ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚ã‚·ãƒ¼ãƒ«ãƒ‰ã•ã‚ŒãŸ GKE ãƒŽãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€GKE ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« ãƒ—ãƒ¬ãƒ¼ãƒ³ã¯æš—å·ã‚’ä½¿ç”¨ã—ã¦ã€æ¬¡ã®å†…å®¹ã‚’ç¢ºèªã—ã¾ã™ã€‚
>
> - ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®ã™ã¹ã¦ã®ãƒŽãƒ¼ãƒ‰ãŒã€Google ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼å†…ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ä»®æƒ³ãƒžã‚·ãƒ³ã§ã‚ã‚‹ã“ã¨ã€‚
> - ã™ã¹ã¦ã®ãƒŽãƒ¼ãƒ‰ãŒã€ã‚¯ãƒ©ã‚¹ã‚¿ã«ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸ[ãƒžãƒãƒ¼ã‚¸ãƒ‰ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆMIGï¼‰](https://cloud.google.com/compute/docs/instance-groups#managed_instance_groups)ã®ä¸€éƒ¨ã§ã‚ã‚‹ã“ã¨ã€‚
> - kubelet ãŒã€ãã‚ŒãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ãƒŽãƒ¼ãƒ‰ã®è¨¼æ˜Žæ›¸ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã¦ã„ã‚‹ã“ã¨ã€‚
>
> [](https://cloud.google.com/kubernetes-engine/docs/how-to/shielded-gke-nodes)

:::
:::details Binary Authorization ã¨ Container Analysis
ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãƒ¡ãƒ¢ã‚’æ·»ä»˜ã™ã‚‹ä»•çµ„ã¿ã‚’**ã‚¢ãƒ†ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**ã¨ã„ã†ã€‚ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ­£å¼ã«èªè¨¼ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã‚ã«ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚¢ãƒ†ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã€‚ä¿¡é ¼ã§ãã‚‹æ©Ÿé–¢ã«ã‚ˆã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã¸ã®ç½²åã‚’å¿…é ˆã«ã—ã¦ã€ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ãã®ç½²åã‚’æ¤œè¨¼ã§ãã‚‹ã€‚

> ã“ã‚Œã‚‰ã®ãƒ¡ãƒ¢ã€ã¤ã¾ã‚Š**è¨¼æ˜Žæ›¸**ã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã¤ã„ã¦ã®èª¬æ˜Žã§ã™ã€‚è¨¼æ˜Žæ›¸ã¯å®Œå…¨ã«æ§‹æˆå¯èƒ½ã§ã™ãŒã€ä¸€èˆ¬çš„ãªä¾‹ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚
>
> - ã‚¢ãƒ—ãƒªãŒå˜ä½“ãƒ†ã‚¹ãƒˆã«åˆæ ¼ã—ãŸã€‚
> - ã‚¢ãƒ—ãƒªãŒå“è³ªä¿è¨¼ï¼ˆQAï¼‰ãƒãƒ¼ãƒ ã«ã‚ˆã£ã¦æ¤œè¨¼ã•ã‚ŒãŸã€‚
> - ã‚¢ãƒ—ãƒªãŒã‚¹ã‚­ãƒ£ãƒ³ã•ã‚Œã€è„†å¼±æ€§ãŒæ¤œå‡ºã•ã‚Œãªã‹ã£ãŸã€‚

- Binary Authorization policy
  **Binary Authorization ãƒãƒªã‚·ãƒ¼**ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã«ã‚¢ãƒ†ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒãªã„ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã€ã„ã‚ã‚†ã‚‹ã€Œé‡Žè‰¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã€ã®æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’é˜²ãã“ã¨ãŒã§ãã‚‹ã€‚
  â‡’ Binary Authorizationpolicy ã®ä¸€ã¤ã¨ã—ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã«åˆæ ¼ã—ãŸã‹ï¼Ÿã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§ã—ãŸã‚Šã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã®ã ã‚ã†ã€‚ãƒãƒªã‚·ãƒ¼ã«å¾“ã£ãŸãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã«ã™ã¹ã¦åˆæ ¼ã™ã‚‹ã¨ã€è¨¼æ˜Žæ›¸ã€ã¤ã¾ã‚Šã‚¢ãƒ†ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸Žãˆã‚‰ã‚Œã‚‹ã€‚
  [Cloud Build ã¨ GKE ã‚’ä½¿ç”¨ã—ãŸ Binary Authorization ã®å®Ÿè£… | Cloud ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ã‚»ãƒ³ã‚¿ãƒ¼ | Google Cloud](https://cloud.googles.ltd/architecture/binary-auth-with-cloud-build-and-gke?hl=ja)
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled24.png)
- Container Analysis ã¨è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³
  Container Analysis ã¯ã€æ—¢çŸ¥ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è„†å¼±æ€§ã¾ãŸã¯ **CVE** ã«ã¤ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æä¾›ã™ã‚‹ã€‚ã‚¹ã‚­ãƒ£ãƒ³ ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€Artifact Registry ã¨ Container Registry å†…ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å¯¾ã—ã¦è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã€API ã‚’ä»‹ã—ã¦åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã¯ã€è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã€ä»–ã®ã‚¯ãƒ©ã‚¦ãƒ‰ ã‚µãƒ¼ãƒ“ã‚¹ã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãªã©ã€ã•ã¾ã–ã¾ãªã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®æƒ…å ±ã‚’ä¿å­˜ã§ãã‚‹ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã«é‡å¤§åº¦ã‚¹ã‚³ã‚¢ãŒ 5 ã‚’è¶…ãˆã‚‹ CVE ãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆã€ãã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯é‡å¤§ãª CVE ãŒãªã„ã“ã¨ãŒè¨¼æ˜Žã•ã‚Œã€è‡ªå‹•çš„ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã€‚ã‚¹ã‚³ã‚¢ãŒ 5 ã‚’è¶…ãˆã‚‹ã¨ã€ä¸­ç¨‹åº¦ã‹ã‚‰é‡å¤§ãªè„†å¼±æ€§ãŒã‚ã‚‹ã“ã¨ã‚’ç¤ºã•ã‚Œã€è¨¼æ˜Žã‚‚ãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚ã•ã‚Œãªã„ã€‚ - CVE
  å…±é€šè„†å¼±æ€§è­˜åˆ¥å­ CVE(Common Vulnerabilities and Exposures)
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled25.png)

  :::

  :::details Compute Engine image ã¨ã¯ï¼Ÿ

  > Summary:
  > Compute Engine images provide reusability and ease of redeployment. Images can be built from a persistent disk or its snapshot or from an existing image. This existing image could be in a project or Cloud Storage. Shielded VMs leverage the image reusability only if firmware is UEFI-compliant, and you can enable secure boot in images.
  > Shell scripts and Cloud Build can be used to automate the image creation process if the task is small and does not require a complete CI/CD pipeline. Before creating the image, ensure that the instance is stopped.

  :::

:::details è¤‡æ•°ã® NIC ã‚’æŒã¤ VM ä½œæˆã«ã¤ã„ã¦

> GCP ã ã¨ã€VPC ã« NIC ãŒå¯¾å¿œã™ã‚‹ã‚‰ã—ãã€è¤‡æ•°ã® NIC ã‚’ VM ã«æŒãŸã›ã‚‹ã«ã¯ã€ã‚ã‚‰ã‹ã˜ã‚å¯¾å¿œã™ã‚‹åˆ¥ã€…ã® VPC ã‚’ä½œã£ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã£ã½ã„
> In a multiple interface instance, every interface gets a route for the subnet that it is in. In addition, the instance gets a single default route that is associated with the primary interface eth0. Unless manually configured otherwise, any traffic leaving an instance for any destination other than a directly connected subnet will leave the instance via the default route on eth0.
> The maximum number of NICs per instance is 8
> [è¤‡æ•°ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æŒã¤ VM ã‚’ä½œæˆã™ã‚‹ | VPC | Google Cloud](https://cloud.google.com/vpc/docs/create-use-multiple-interfaces?hl=ja)

:::

:::details å€‹äººç®¡ç†ã® Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã§ä½¿ã† Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®é•ã„ã¯ï¼ŸCloud Identity ã‚’ä¸€è¨€ã§ã„ã†ã¨ï¼Ÿ

> Goolge ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¯å€‹äººã§ç®¡ç†ã™ã‚‹ã‚‚ã®ã¨ã€Workspace ã‚„ Cloud Identity ãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ç®¡ç†ã™ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®äºŒç¨®é¡žãŒã‚ã‚‹ã€‚
> Workspace ã‚„ Cloud Identity ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ç®¡ç†è€…ã«ã‚ˆã‚‹ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†(ä½œæˆãƒ»åœæ­¢ãƒ»å‰Šé™¤)ãŒå¯èƒ½ã¨ãªã‚‹ã€‚ã¾ãŸã€äºŒè¦ç´ èªè¨¼ã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã®é©ç”¨ã€ç›£æŸ»ãƒ­ã‚°ã®å–å¾—ã€Access Context Manager ã‚’åˆ©ç”¨ã—ãŸã‚¢ã‚¯ã‚»ã‚¹å…ƒ IP ã‚„ãƒ‡ãƒã‚¤ã‚¹ã®åˆ¶å¾¡ã‚‚å¯èƒ½ã€‚å€‹äººç®¡ç†ã® Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å€‹äººã§ã—ã‹ç®¡ç†ã§ããªã„ã€‚

### Cloud Identity ã‚’ä¸€è¨€ã§ã„ã†ã¨

Workspace ã® ID ç®¡ç†æ©Ÿèƒ½ã®ã¿ã‚’æä¾›ã™ã‚‹ IDaaS(ID as a Service)ã§ã‚ã‚‹ã€‚
![IMG_7542.jpg](/images/20221015_professional-cloud-security-engineer/IMG_7542.jpg)

- CloudIdentity ã«ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã„ã‚‰ãªã„
  []()
  ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä¸€ã¤æ±ºã‚ã‚‹ã“ã¨ãŒå¿…è¦ã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç™»éŒ²ã™ã‚‹ã€‚
  ![image.png](/images/20221015_professional-cloud-security-engineer/image15.png)
  Google Cloud ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º IT åŸºç›¤æ§‹ç¯‰ã‚¬ã‚¤ãƒ‰ p230 ãƒšãƒ¼ã‚¸
  :::
  :::details ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åˆ©ç”¨æ–¹æ³• 4 ã¤ã‚’èª¬æ˜Žã›ã‚ˆã€‚ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ç®¡ç†è² è·ãŒé«˜ã„ãŒã€ä¸‰ç¨®é¡žã®èªè¨¼æƒ…å ±ã®ç¨®é¡žã‚’æŒ™ã’ã€ä½¿ã„åˆ†ã‘ã‚’ç°¡æ½”ã«èª¬æ˜Žã›ã‚ˆã€‚
  ä»¥ä¸‹ã®ï¼”ã¤ã€‚ãƒªã‚½ãƒ¼ã‚¹ã«é–¢é€£ä»˜ã‘ã‚‹å ´åˆã¨ã„ã†ã®ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’æº–å‚™ã—ãŸã‚Šã—ãªãã¦ã‚‚ã€å˜ã«ãƒªã‚½ãƒ¼ã‚¹ã«é–¢é€£ä»˜ã‘ã‚‹ã ã‘ã€‚GCP ã«æ§‹ç¯‰ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã¯ä½œæˆã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã ã‘ã€‚ã‚­ãƒ¼ç®¡ç†ã¯ä¸è¦ã€‚
  ![IMG_7543.jpg](/images/20221015_professional-cloud-security-engineer/IMG_7543.jpg)
  ![IMG_7544.jpg](/images/20221015_professional-cloud-security-engineer/IMG_7544.jpg)
  Google Cloud ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º IT åŸºç›¤æ§‹ç¯‰ã‚¬ã‚¤ãƒ‰ p232 ãƒšãƒ¼ã‚¸

### 3 ç¨®é¡žã®èªè¨¼æƒ…å ±ã®ç¨®é¡ž

1. API ã‚­ãƒ¼

   ä¸€ç•ªå˜ç´”ã§ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¯è­˜åˆ¥ã›ãšã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ã‚’è­˜åˆ¥ã™ã‚‹ã€‚

   ä¾‹ãˆã°ã€ãã® API ã‚­ãƒ¼ã‚’æŒã£ã¦ã„ãŸã‚‰ã€èª°ã§ã‚‚ GCS ã®ç‰¹å®šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã€ãªã©ã€‚

2. OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèªè¨¼

   èªè¨¼æ™‚ã« Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå¿…è¦ã«ãªã‚‹ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒ User accounts(äººé–“ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹)ã‚’æƒ³å®šã—ãŸèªè¨¼ã€‚

3. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼

   èªè¨¼æ™‚ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ç´ã¥ã‘ã‚‰ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ ã‚­ãƒ¼ãŒå¿…è¦ã«ãªã‚‹ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒ Service accounts(äººé–“ä»¥å¤–ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹)ã‚’æƒ³å®šã—ãŸèªè¨¼ã€‚èªè¨¼æƒ…å ±ã«å€‹äººã® Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å¿…è¦ã¨ã—ãªã„ã®ã§ã€**æœ¬ç•ªç’°å¢ƒ**ã®ã‚·ã‚¹ãƒ†ãƒ ã‚„ CI/CD ã®ã‚ˆã†ãªå…±æœ‰ã—ã¦ã„ã‚‹ã‚‚ã®ã«å¯¾ã—ã¦ä½¿ãˆã‚‹ã€‚

### ä½¿ã„åˆ†ã‘æˆ¦ç•¥

- API ã‚­ãƒ¼ã¯ã•ã¦ãŠãã€OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèªè¨¼ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã€é–‹ç™ºæ™‚ã¯ã©ã¡ã‚‰ã§ã‚‚è‰¯ã„ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’ä½¿ã†ãªã‚‰ã€æœ¬ç•ªç’°å¢ƒã€‚ãã®éš›ã¯ãƒªã‚½ãƒ¼ã‚¹ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚„ WorkloadIdentity ãŒä½¿ãˆãªã„ã“ã¨ã‚’ç¢ºèªã®ä¸Šã€ã‚­ãƒ¼ã®ç®¡ç†ã‚’ã—ã£ã‹ã‚Šã™ã‚‹ãªã©ä¸‡å…¨ã‚’æœŸã™ã€‚
- application default login ã§ OAuth èªè¨¼ã§ãã‚‹ã®ã§ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚‹ã¾ã§ã‚‚ãªã„å ´åˆã¯æ¥½
- ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ ã¯ IAM ãƒ­ãƒ¼ãƒ«ã§æ¨©é™ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹ã€‚ãã‚Œä»¥å¤–ã¯é–‹ç™ºè€…å€‹äººã® Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã£ã¦ OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèªè¨¼ã‚’ä½¿ã£ã¦ã‚‚ã‚ˆã„ã€‚OAuth scopes ã¯ã€IAM role ã‚ˆã‚Šä»¥å‰ã®ãƒ¬ã‚¬ã‚·ãƒ¼ãªæ–¹æ³•
- Unlike users, service accounts can't authenticate by signing in with a password or with single sign-on (SSO)
  â‡’ OAuth ã¯ä¸€å¿œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã—ã¦ã„ã‚‹ã®ã§ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚ˆã‚Šã¯å®‰å…¨ã¨ã„ã†å‰æã‚‰ã—ã„ï¼Ÿ
  - ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ vs OAuth
    > ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã«ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã¯ãªãï¼ˆãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã®ç§»è¡Œã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹å¯èƒ½æ€§ã‚ã‚‹ãŸã‚ï¼‰ã€[OAuth åŒæ„ãƒ•ãƒ­ãƒ¼](https://cloud.google.com/docs/authentication/end-user)ã‚’ä½¿ç”¨ã—ã¦ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒæ„ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã™ã€‚ãã®å¾Œã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID ã§å‡¦ç†ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä»£ã‚ã‚Šã« OAuth ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ¬¡ã®ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
    > ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä»˜ä¸Žã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã€è‡ªèº«ã®åŒæ„ã¾ãŸã¯æ‹’å¦ã‚’æ˜Žç¤ºçš„ã«è¡¨æ˜Žã§ãã¾ã™ã€‚
    > ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯éšæ™‚ã€[[ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±](https://myaccount.google.com/permissions)] ãƒšãƒ¼ã‚¸ã§åŒæ„ã‚’å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã™ã€‚
    > ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ç„¡åˆ¶é™ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä»˜ä¸Žã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚
    > ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æƒ…å ±ã®ä½¿ç”¨ã‚’è¨±å¯ã™ã‚‹ã“ã¨ã§ã€Google Cloud APIs ã«å¯¾ã™ã‚‹æ¨©é™ãƒã‚§ãƒƒã‚¯ã‚’å»¶æœŸã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° ã‚¨ãƒ©ãƒ¼ãŒåŽŸå› ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ãªã„ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã€èª¤ã£ã¦å…¬é–‹ã•ã‚Œã¦ã—ã¾ã†ãƒªã‚¹ã‚¯ï¼ˆ[æ··ä¹±ã—ãŸä½¿ç¯€ã«é–¢ã™ã‚‹å•é¡Œ](https://www.wikipedia.org/wiki/Confused_deputy_problem)ï¼‰ã‚’ä½Žæ¸›ã§ãã¾ã™ã€‚
- é–‹ç™ºä¸­ã«ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ãªã„
  æ—¥å¸¸æ¥­å‹™ã§ Google Cloud CLIã€`gsutil`ã€`terraform`Â  ãªã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œã§ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚ä»£ã‚ã‚Šã«ã€`gcloud auth login`ï¼ˆgcloud CLI ã¨ Â `gsutil`ã®å ´åˆï¼‰ã¾ãŸã¯ Â `gcloud auth application-default login`ï¼ˆ`terraform`Â  ãªã©ã®ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ ãƒ„ãƒ¼ãƒ«ã®å ´åˆï¼‰ã‚’å®Ÿè¡Œã—ã¦ã€ãƒ„ãƒ¼ãƒ«ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚
  Google Cloud ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹äºˆå®šã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºã¨ãƒ‡ãƒãƒƒã‚°ã«ã‚‚ã€åŒæ§˜ã®æ–¹æ³•ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå¿…è¦ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ãŒã€ãƒ­ãƒ¼ã‚«ãƒ« ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€å€‹äººç”¨ã®èªè¨¼æƒ…å ±ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚
  ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å€‹äººã®èªè¨¼æƒ…å ±ã¨ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼æƒ…å ±ã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã«ã¯ã€[Cloud ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ãƒ©ã‚¤ãƒ–ãƒ©ãƒª](https://cloud.google.com/apis/docs/cloud-client-libraries)ã‚’ä½¿ç”¨ã—ã¦[èªè¨¼æƒ…å ±ã‚’è‡ªå‹•çš„ã«æ¤œç´¢](https://cloud.google.com/docs/authentication/production#automatically)ã—ã¾ã™ã€‚
  [API ã‚­ãƒ¼ã€OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ IDã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®é•ã„:Google APIs - ç„¡ç²‹ãªæ—¥ã€…ã«](https://messefor.hatenablog.com/entry/2020/10/08/080414#3%E3%81%A4%E3%81%AE%E8%AA%8D%E8%A8%BC%E6%83%85%E5%A0%B1%E3%81%AF%E6%83%B3%E5%AE%9A%E3%81%95%E3%82%8C%E3%82%8B%E5%88%A9%E7%94%A8%E3%82%B7%E3%83%BC%E3%83%B3%E3%81%8C%E7%95%B0%E3%81%AA%E3%82%8B)
  [Best practices for working with service accounts | IAM Documentation | Google Cloud](https://cloud.google.com/iam/docs/best-practices-service-accounts#choosing_when_to_use_service_accounts)
  [Best practices for managing service account keys | IAM Documentation | Google Cloud](https://cloud.google.com/iam/docs/best-practices-for-managing-service-account-keys)
- ï¼ˆè¿½è¨˜ï¼‰ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚‚ OAuth ã§ã®ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®èªè¨¼ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã€‚
  ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’ä½¿ã£ãŸèªè¨¼ã§ã‚‚ã€OAuth ã‚„ Jwtã€OIDC ãƒˆãƒ¼ã‚¯ãƒ³ãªã©ã®æœ‰åŠ¹æœŸé™ã®çŸ­ã„èªè¨¼æƒ…å ±ã‚’ä½¿ç”¨ã—ãŸèªè¨¼ãŒä½¿ãˆã‚‹ã€‚ãã‚Œã«ã‚ˆã‚Šã‚­ãƒ¼ã®æ¼æ´©ãƒªã‚¹ã‚¯ãŒæ¸›ã‚‰ã›ã‚‹ã€‚
  â€» èªè¨¼ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã® credential ãŒå¿…è¦ã«ãªã‚‹ã“ã¨ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å ´åˆï¼ˆOAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ IDï¼‰ã¨åŒã˜ã€‚
  â€» ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã« OAuth èªè¨¼ï¼ˆOAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ IDï¼‰ã™ã‚‹å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æƒ³å®šã—ã¦ã„ã‚‹ãŒã€OAuth ï¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼ã®ä»£ã‚ã‚Šã ã‘ã§ã¯ãªã„ã€‚**ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®èªè¨¼ã®æ‰‹æ®µã¨ã—ã¦ã‚‚ OAuth ã‚’å«ã‚€ãƒˆãƒ¼ã‚¯ãƒ³ã§ã®èªè¨¼ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ï¼**
  [æœ‰åŠ¹æœŸé–“ãŒçŸ­ã„ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼æƒ…å ±ã‚’ä½œæˆã™ã‚‹ Â |Â  IAM ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ Â |Â  Google Cloud ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« OAuth ã‚’ã¤ã‘ã‚‰ã‚Œã‚‹ï¼ç‹¬ç«‹æŽ’ä»–ã§ã¯ãªã„ã®ã ï¼ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹çš„ã«ã¯ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®ã‚ˆã†ãªé•·æœŸé–“æœ‰åŠ¹ãªã‚‚ã®ã‚ˆã‚Šã‚‚ OAuth ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®æ–¹ãŒã„ã„ã€‚](https://www.notion.so/IAM-Google-Cloud-OAuth--55ed156959b143b18e4dd89d6960aac5)

:::
:::details WorkloadIdentity ã¨ã¯ï¼ŸWorkload Identity é€£æºã¨ã¯ï¼Ÿ
AWS ã® IAM ãªã© IdP ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãªã‚Šã™ã¾ã™ã“ã¨ã§ã€Google Cloud ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ“ä½œã™ã‚‹ã€‚OAuth2.0 ã®ä»•æ§˜ã«å¾“ã£ã¦ token ãŒè‡ªå‹•ç™ºè¡Œã•ã‚Œã‚‹ã€‚OIDC ï¼‹ OAuth ã§ã® SSO ã¿ãŸã„ãªã‚‚ã®ï¼Ÿ
Workload Identity ã¯ GKE ä¸Šã® pod ãŒã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãªã‚Šã™ã¾ã™å ´åˆã€Workload Identity é€£æºã¯ AWS/Azure/å¤–éƒ¨ IdP ã‹ã‚‰ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãªã‚Šã™ã¾ã™å ´åˆã€‚
Google Cloud ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º IT åŸºç›¤æ§‹ç¯‰ã‚¬ã‚¤ãƒ‰ p232 ãƒšãƒ¼ã‚¸
:::
:::details ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒå†…ã§ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç”¨ã®éµã‚’æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€Google ãŒæŽ¨å¥¨ã™ã‚‹æ–¹æ³•ã«æ²¿ã£ã¦å¯¾å¿œã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ
æ¯Žæ—¥ã®éµã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ—ãƒ­ã‚»ã‚¹ã‚’å°Žå…¥ã—ã€ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã«ã¯ã€æ¯Žæ—¥æ–°ã—ã„éµã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ Cloud Storage ãƒã‚±ãƒƒãƒˆã‚’æä¾›ã™ã‚‹ã€‚_ã“ã®æ–¹æ³•ãªã‚‰ã€ç®¡ç†è€…ãŒéµã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ—ãƒ­ã‚»ã‚¹ã‚’ä¸€å…ƒç®¡ç†ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã€éµã®ç”Ÿæˆã‚’ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã«å§”ä»»ã™ã‚‹å¿…è¦ãŒãªãã€æ¼æ´©ãŒç”Ÿã˜ã‚‹æã‚ŒãŒå°‘ãªã„ã€‚_
:::
:::details ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚­ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªã‚±ãƒ¼ã‚¹ã¯ï¼Ÿã©ã†ã‚„ã£ã¦è‡ªå‹•åŒ–ã™ã‚‹ã‹ï¼Ÿ
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ GCP ä¸Šã ã‘ã§å®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ã‚ã‚Œã°ã€ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ ã‚­ãƒ¼ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã¯ GCP ãŒè‡ªå‹•çš„ã«è¡Œã£ã¦ãã‚Œã‚‹ã€‚
â‡” GCP ä»¥å¤–ã®ç’°å¢ƒã§ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ã‚­ãƒ¼ã®ç®¡ç†ãŒå¿…è¦ã«ã‚ã‚‹ã€‚

> Google recommends to use the IAM service account API to automatically rotate your service account keys. You can rotate a key by creating a new key, switching applications to use the new key and then deleting the old key. To do so you need to use theÂ `[serviceAccount.keys.create()](https://cloud.google.com/iam/reference/rest/v1/projects.serviceAccounts.keys/create)`
> andÂ `[serviceAccount.keys.delete()](https://cloud.google.com/iam/reference/rest/v1/projects.serviceAccounts.keys/delete)`
> methods together to automate the rotation.
> â‡’ è‡ªå‹•åŒ–ç”¨ã®ã‚³ãƒžãƒ³ãƒ‰ã¯ãªã„ãŒã€è‡ªåˆ†ã§è‡ªå‹•åŒ–ã™ã‚‹ã‚ˆã†ã«æŽ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ w

:::

:::details DLP API ã®ä»®ååŒ– 3 ç¨®ã‚’æ¯”è¼ƒãƒ»èª¬æ˜Žã›ã‚ˆã€‚ã¾ãŸã€infoTypeã€Date shifting ã¨ã¯ï¼Ÿ

### ä»®ååŒ–å¤‰æ›æ–¹å¼

- Cloud DLP ã¯ã€åŒ¿ååŒ–ã® 3 ã¤ã®ä»®ååŒ–æ‰‹æ³•ã‚’ã‚µãƒãƒ¼ãƒˆã€‚
- ä»®ååŒ–=ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã€ã‚µãƒ­ã‚²ãƒ¼ãƒˆç½®æ›ã€‚æš—å·éµã‚’ä½¿ã†ã€‚Cryptoã€‚
- å…ƒã®æ©Ÿå¯†å€¤ â†’ å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³
- å¯é€†ãªãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã¯ã€FPEï¼ˆFormat-Preserving-Encryptionï¼‰ã¨ç¢ºå®šçš„ï¼ˆDeterministicï¼‰æš—å·åŒ–ã€‚æ™®é€šã® CryptoHashConfig ã¯ä¸å¯é€† ã€‚
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled26.png)
  [å¤‰æ›ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ | ãƒ‡ãƒ¼ã‚¿æå¤±é˜²æ­¢ï¼ˆDLPï¼‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | Google Cloud](https://cloud.google.com/dlp/docs/transformations-reference?hl=ja)
  æš—å·åŒ–ã‚­ãƒ¼ã‚’æ®‹ã—ã¦ãŠã‘ã°å¾©å…ƒã§ãã€æ®‹ã•ãªã‘ã‚Œã°å¾©å…ƒã§ããªã„ã€‚
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled27.png)

### infoType

> Cloud Data Loss Prevention ã§ã¯ã€_æƒ…å ±ã‚¿ã‚¤ãƒ—_ï¼ˆ_infoType_ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹å¯¾è±¡ã‚’å®šç¾©ã—ã¾ã™ã€‚infoType ã¯ã€åå‰ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€é›»è©±ç•ªå·ã€è­˜åˆ¥ç•ªå·ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ ã‚«ãƒ¼ãƒ‰ç•ªå·ãªã©ã®æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®ã‚¿ã‚¤ãƒ—ã‚’è¡¨ã—ã¾ã™ã€‚
> Cloud DLP ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ infoType ã«ã¯ã€ãã‚Œãžã‚Œå¯¾å¿œã™ã‚‹æ¤œå‡ºå™¨ãŒã‚ã‚Šã¾ã™ã€‚Cloud DLP ã§ã¯ã€ã‚¹ã‚­ãƒ£ãƒ³ã®æ§‹æˆã«å«ã¾ã‚Œã‚‹ infoType æ¤œå‡ºå™¨ã‚’ä½¿ç”¨ã—ã¦ã€æ¤œæŸ»ã®å¯¾è±¡ã¨æ¤œæŸ»çµæžœã®å¤‰æ›æ–¹æ³•ãŒæ±ºå®šã•ã‚Œã¾ã™ã€‚

- Cloud DLP uses built-in and custom infoType detectors to scan images, documents, and text. Custom infoTypes can be dictionaries, regular expressions, or dictionaries extracted from BigQuery or Cloud Storage. Use dictionaries when you want to match a list of words or phrases, and use regular expressions when you want to detect matches based on a regex patte
  [InfoType detector reference | Data Loss Prevention Documentation | Google Cloud](https://cloud.google.com/dlp/docs/infotypes-reference)

### Date shifting

é †åºã¨æŒç¶šæ™‚é–“ã¯ä¿æŒã—ã¦ã‚·ãƒ•ãƒˆã•ã›ã‚‹ã“ã¨ã€‚
[æ—¥ä»˜ã‚·ãƒ•ãƒˆ | ãƒ‡ãƒ¼ã‚¿æå¤±é˜²æ­¢ï¼ˆDLPï¼‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | Google Cloud](https://cloud.google.com/dlp/docs/concepts-date-shifting?hl=ja)
:::
:::details Cloud Audit Logs ã®ç¨®é¡žã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã®æœ‰åŠ¹/ç„¡åŠ¹ã¯ï¼Ÿã¾ãŸã€ãƒ­ã‚°è¡¨ç¤ºã«å¿…è¦ãªæ¨©é™ã¯ï¼Ÿ

### Cloud Audit Logsï¼ˆç›£æŸ»ãƒ­ã‚°ï¼‰ã®ç¨®é¡ž

ä¸‹è¨˜ 4 ç¨®é¡žãŒã‚ã‚‹ã€‚

- ç®¡ç†ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ç›£æŸ»ãƒ­ã‚°
  - ç®¡ç†ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ç›£æŸ»ãƒ­ã‚°ã¯å¸¸ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹ã€‚æ§‹æˆã™ã‚‹ã€é™¤å¤–ã™ã‚‹ã€ã¾ãŸã¯ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ã¯ã§ããªã„ã€‚Cloud Logging API ã‚’ç„¡åŠ¹ã«ã—ã¦ã‚‚ã€ç®¡ç†ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ç›£æŸ»ãƒ­ã‚°ã¯ç”Ÿæˆã•ã‚Œã‚‹ã€‚
  - ãŸã¨ãˆã°ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ** VM ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ãŸã¨ãã‚„ Identity and Access Management æ¨©é™ã‚’å¤‰æ›´ã—ãŸã¨ã
- ã‚·ã‚¹ãƒ†ãƒ  ã‚¤ãƒ™ãƒ³ãƒˆç›£æŸ»ãƒ­ã‚°
  - ç›´æŽ¥çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã§ã¯ãªãã€**Google ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã£ã¦**æœ‰åŠ¹åŒ–ã•ã‚Œã‚‹
  - ã‚·ã‚¹ãƒ†ãƒ  ã‚¤ãƒ™ãƒ³ãƒˆç›£æŸ»ãƒ­ã‚°ã¯å¸¸ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹ã€‚æ§‹æˆã—ãŸã‚Šã€é™¤å¤–ã—ãŸã‚Šã€ç„¡åŠ¹ã«ã—ãŸã‚Šã™ã‚‹ã“ã¨ã¯ã§ããªã„ã€‚
- ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ç›£æŸ»ãƒ­ã‚°
  - BigQuery ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ç›£æŸ»ãƒ­ã‚°ã‚’é™¤ãã€ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ç›£æŸ»ãƒ­ã‚°ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºãŒéžå¸¸ã«å¤§ãããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼‰ã€‚BigQuery ä»¥å¤–ã® Google Cloud ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ç›£æŸ»ãƒ­ã‚°ã‚’æ›¸ãè¾¼ã‚€ã«ã¯ã€æ˜Žç¤ºçš„ã«æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
- ãƒãƒªã‚·ãƒ¼æ‹’å¦ç›£æŸ»ãƒ­ã‚°
  [Cloud Audit Logs ã®æ¦‚è¦ | Cloud Logging | Google Cloud](https://cloud.google.com/logging/docs/audit?hl=ja#data-access)

### ãƒ­ã‚°è¡¨ç¤ºã«å¿…è¦ãªæ¨©é™ã¨è¨­å®šä¾‹

| ãƒ­ãƒ¼ãƒ«                           | ãƒªã‚½ãƒ¼ã‚¹           | ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«                                                                  | èª¬æ˜Ž                                                                                                                                                                                                       |
| -------------------------------- | ------------------ | ----------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| logging.viewer                   | çµ„ç¹”               | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒãƒ¼ãƒ                                                            | logging.viewerÂ  ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†ãƒãƒ¼ãƒ ã¯ã€ç®¡ç†ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚                                                                                                            |
| logging.privateLogViewer         | çµ„ç¹”               | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒãƒ¼ãƒ                                                            | logging.privateLogViewerÂ  ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ ãƒ­ã‚°ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚                                                                                                                                |
| logging.viewer                   | ãƒ•ã‚©ãƒ«ãƒ€           | ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ ãƒãƒ¼ãƒ                                                            | logging.viewerÂ  ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚Šã€ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ ãƒãƒ¼ãƒ ã¯ã€ã™ã¹ã¦ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸç®¡ç†ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚ |
| logging.privateLogViewer         | ãƒ•ã‚©ãƒ«ãƒ€           | ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ ãƒãƒ¼ãƒ                                                            | logging.privateLogViewerÂ  ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ ãƒ­ã‚°ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚                                                                                                                                |
| [ç›£æŸ»é–¢é€£ã‚¸ãƒ§ãƒ–æ©Ÿèƒ½ã® IAM ãƒ­ãƒ¼ãƒ« | IAM ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | Google Cloud](https://cloud.google.com/iam/docs/job-functions/auditing?hl=ja) |

### ä¾‹ï¼šSecret Manager ã®ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ

Admin activity logs and Data Access Logs are the ones containing secret management related information.
![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled28.png)
â€» [Access Transparency log ã¨ã¯ï¼Ÿ](https://www.notion.so/Access-Transparency-log-b0b6c6ead9c44091b736a9c54c26901e)
:::
:::details Access Transparency log ã¨ã¯ï¼Ÿ

ã‚¢ã‚¯ã‚»ã‚¹ã®é€æ˜Žæ€§ãƒ­ã‚°ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹æƒ…å ±ã¯ã€Cloud ç›£æŸ»ãƒ­ã‚°ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹æƒ…å ±ã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚Cloud ç›£æŸ»ãƒ­ã‚°ã«ã¯ã€Google Cloud çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒ Google Cloud ãƒªã‚½ãƒ¼ã‚¹ã§è¡Œã£ãŸæ“ä½œãŒè¨˜éŒ²ã•ã‚Œã¾ã™ã€‚ä¸€æ–¹ã€ã‚¢ã‚¯ã‚»ã‚¹ã®é€æ˜Žæ€§ãƒ­ã‚°ã«ã¯ã€Google ã®æ‹…å½“è€…ãŒè¡Œã£ãŸæ“ä½œãŒè¨˜éŒ²ã•ã‚Œã¾ã™ã€‚

:::
:::details é›†ç´„ã•ã‚ŒãŸã‚·ãƒ³ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ

> é›†ç´„ã•ã‚ŒãŸã‚·ãƒ³ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Google Cloud ã®çµ„ç¹”ã¾ãŸã¯ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«ã‚·ãƒ³ã‚¯ã‚’ä½œæˆã—ã€ã‚·ãƒ³ã‚¯ã®**includeChildren ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**ã‚’ True ã«è¨­å®šã—ã¾ã™ã€‚ãã®ã‚·ãƒ³ã‚¯ã¯ã€çµ„ç¹”ã¾ãŸã¯ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‹ã‚‰ã®ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªã«åŠ ãˆã¦ã€å«ã¾ã‚Œã¦ã„ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã€è«‹æ±‚å…ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã¾ãŸã¯ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªã‚’ï¼ˆå†å¸°çš„ã«ï¼‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ãã¾ã™ã€‚
> â‡’ ãƒ­ã‚°ã‚’ã»ã¼ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¤–éƒ¨ SIEM ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

- SIEM
  Security Information and Event Management
  æ•°ç§’ã§å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šè¾¼ã‚“ã§è§£æžã—ã€ç•°å¸¸ãªè¡Œå‹•ã‚’æ¤œå‡ºã™ã‚‹ã¨ãŸã ã¡ã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é€ä¿¡ã™ã‚‹æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ“ã‚¸ãƒã‚¹ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¾—ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
  :::
  :::details VPC ãƒ‘ã‚±ãƒƒãƒˆãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ã¨ã¯ï¼ŸVPC ãƒ•ãƒ­ãƒ¼ãƒ­ã‚°ã¨ã®é•ã„ã¯ï¼Ÿ

- VPC ãƒ‘ã‚±ãƒƒãƒˆãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°
  - ç‰¹å®šã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å‡ºå…¥ã‚Šã™ã‚‹ãƒ‘ã‚±ãƒƒãƒˆ ã‚’ãƒŸãƒ©ãƒ¼ã§ãã‚‹æ©Ÿèƒ½ã€‚ã‚µãƒ–ãƒãƒƒãƒˆå…¨ä½“ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚°ã‚’æŒ‡å®šã—ã¦ã€è¤‡æ•°ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ã¾ã¨ã‚ã¦å¯¾è±¡ã¨ã—ã¦æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚
  - Packet Mirroring ã¯æŒ‡å®šã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ãƒ‘ã‚±ãƒƒãƒˆã‚’è¤‡è£½ã—ã¦ Â **ã‚³ãƒ¬ã‚¯ã‚¿å®›å…ˆ**
    Â (collector destination) ã«é€ä¿¡
  - ãƒ‘ã‚±ãƒƒãƒˆãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼ã§ãƒ•ã‚£ãƒ«ã‚¿ä½œæˆï¼ˆãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€CIDR ç¯„å›²ã€æ–¹å‘ï¼‰
- VPC ãƒ•ãƒ­ãƒ¼ãƒ­ã‚°ã¨ã®é•ã„
  > VPC ãƒ•ãƒ­ãƒ¼ãƒ­ã‚°ã«ã¯ã„ã‚ã‚†ã‚‹ 5 ã‚¿ãƒ—ãƒ« (é€ä¿¡å…ƒ IP ã€é€ä¿¡å…ƒãƒãƒ¼ãƒˆç•ªå·ã€é€ä¿¡å…ˆ IP ã€é€ä¿¡å…ˆãƒãƒ¼ãƒˆç•ªå·ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ç•ªå·) ãŒå«ã¾ã‚Œã‚‹ä»–ã€æ™‚åˆ»ã€ãƒã‚¤ãƒˆæ•°ã€ TCP ã® ACK ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãªã©ãŒå«ã¾ã‚Œã¾ã™ã€‚ã“ã†ã„ã£ãŸ Â  ãƒ‘ã‚±ãƒƒãƒˆã®é–¢é€£æƒ…å ±ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã®ã§ã‚ã‚Šã€Â  ãƒ‘ã‚±ãƒƒãƒˆãã®ã‚‚ã®ãŒã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚Œã‚‹ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“
  > â‡’ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å«ã‚€ã™ã¹ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã¨ãƒ‘ã‚±ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ¤œæŸ»ã—ãŸã„å ´åˆã€ãƒ‘ã‚±ãƒƒãƒˆãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ã‚’ä½¿ã†

:::
:::details Cloud Logging ã§ã¯ã€Google Cloud ä»¥å¤–ã®ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã‚‚ãƒ­ã‚°ã‚„æŒ‡æ¨™ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŽé›†ã§ãã‚‹ã€‚

Google ãŒæä¾›ã™ã‚‹ Cloud Monitoring ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã€AWS EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½ã€‚ã¾ãŸã€ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã®ãƒžã‚·ãƒ³ã« fluentd ã‚„ collectd ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€Cloud Monitoring ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚ã‚‹ã€‚

Logging Agent ã‚„ Monitoring Agent ã‚’ GCE ã® linux/windows ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€ãã‚Œã¯ fluentd ãƒ™ãƒ¼ã‚¹ã®ãƒ„ãƒ¼ãƒ«ã§ã€å‹æ‰‹ã« Logging ã‚„ monitoring ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ­ã‚°ã‚„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’é€ä¿¡ã—ã¦åŽé›†ã—ã¦ãã‚Œã‚‹ï¼GCP ã˜ã‚ƒãªãã¦ã‚‚ AWS ã¨ã‹ã‚ªãƒ³ãƒ—ãƒ¬ã§ã‚‚ã„ã„ï¼

- Cloud Logging ã®å‡ºã—æ–¹
  ã‚¢ãƒ—ãƒªã‹ã‚‰ API ã‚’å©ã„ã¦ãƒ­ã‚°ã«å…¥ã‚Œã‚‹ã€‚\_Default ãƒã‚±ãƒƒãƒˆã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ã‚ˆã†ãªã‚·ãƒ³ã‚¯ã«ãªã£ã¦ã„ã¦ã€30 æ—¥é–“ä¿å­˜ã•ã‚Œã‚‹ã€‚pubsub ã‚„ BigQueryã€GCS ã¸ã®ã‚«ã‚¹ã‚¿ãƒ ã‚·ãƒ³ã‚¯ã‚’ä½œã‚Œã°åˆ¶é™ã¯ãªããªã‚‹ã€‚
  [https://qiita.com/HishiM/items/63b93742c098e1591f77](https://qiita.com/HishiM/items/63b93742c098e1591f77)

> Cloud Logging ã® \_Required ãƒã‚±ãƒƒãƒˆã¯ã€ç®¡ç†ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ç›£æŸ»ãƒ­ã‚°ã¨ã‚·ã‚¹ãƒ†ãƒ  ã‚¤ãƒ™ãƒ³ãƒˆç›£æŸ»ãƒ­ã‚°ã‚’å–ã‚Šè¾¼ã‚“ã§ä¿å­˜ã—ã¾ã™ã€‚\_Required ãƒã‚±ãƒƒãƒˆã‚„ãƒã‚±ãƒƒãƒˆå†…ã®ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã¯æ§‹æˆã§ãã¾ã›ã‚“ã€‚ \_Default ãƒã‚±ãƒƒãƒˆã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ç›£æŸ»ãƒ­ã‚°ã¨ãƒãƒªã‚·ãƒ¼æ‹’å¦ç›£æŸ»ãƒ­ã‚°ã‚’å–ã‚Šè¾¼ã‚“ã§ä¿å­˜ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ç›£æŸ»ãƒ­ã‚°ãŒ \_Default ãƒã‚±ãƒƒãƒˆã«ä¿å­˜ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã€ãƒ­ã‚°ã‚’ç„¡åŠ¹ã«ã—ã¾ã™ã€‚ãƒãƒªã‚·ãƒ¼æ‹’å¦ç›£æŸ»ãƒ­ã‚°ãŒ \_Default ãƒã‚±ãƒƒãƒˆã«ä¿å­˜ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã€ã‚·ãƒ³ã‚¯ã®ãƒ•ã‚£ãƒ«ã‚¿ã‚’å¤‰æ›´ã—ã¦ãƒãƒªã‚·ãƒ¼æ‹’å¦ç›£æŸ»ãƒ­ã‚°ã‚’é™¤å¤–ã—ã¾ã™ã€‚

[Cloud Audit Logs ã®æ¦‚è¦ | Cloud Logging | Google Cloud](https://cloud.google.com/logging/docs/audit?hl=ja)

:::
:::details GCS ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã€æœ€å°ä¿å­˜æœŸé–“ã‚’æŒ™ã’ã‚ˆã€‚
![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled29.png)
[Storage classes | Google Cloud](https://cloud.google.com/storage/docs/storage-classes)

> Summary:
> Cloud Storage lets you use storage classes that are less expensive than standard storage. These storage classes use low-performance HDDs compared to standard SDDs. The cost-performance trade-off lets you build low-cost, resilient applications that still have the fastest read access and lowest latency in the cloud space. Cloud Storage object lifecycle rules let you change storage classes or set expiration rules to further reduce storage costs.

:::

:::details SCC ã¨ Forseti Security ã«ã¤ã„ã¦æ¦‚è¦³ã—ã¦æ¯”è¼ƒã›ã‚ˆã€‚ã“ã‚Œã‚‰ã¯ä¸€è¨€ã§ã„ã†ã¨ã©ã‚“ãªç”¨é€”ã«ä½¿ãˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‹ï¼Ÿ

### ä¸€è¨€ã§ã„ã†ã¨

SCC ã‚„ Forseti ã¯**CSPM ç”¨é€”**ã«ä½¿ãˆã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã„ãˆã‚‹

- CSPM
  > ã‚¯ãƒ©ã‚¦ãƒ‰ã®è¨­å®šãƒŸã‚¹ã«ã‚ˆã‚‹æƒ…å ±æ¼æ´©ã«å¯¾ã—ã¦æœ‰åŠ¹ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦æ³¨ç›®ã•ã‚Œã¦ã„ã‚‹ã®ãŒ CSPMï¼ˆCloud Security Posture Management : ã‚¯ãƒ©ã‚¦ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ…‹å‹¢ç®¡ç†ï¼‰ã§ã™ã€‚
  > CSPM ã¯ã€IaaS ã‚„ PaaS ã¨ã„ã£ãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¦ãƒ‰ã«å¯¾ã—ã¦ API é€£æºã«ã‚ˆã‚Šã€ã‚¯ãƒ©ã‚¦ãƒ‰å´ã®è¨­å®šã‚’è‡ªå‹•çš„ã«ç¢ºèªã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è¨­å®šãƒŸã‚¹ã‚„å„ç¨®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ç­‰ã¸ã®é•åãŒç„¡ã„ã‹ã‚’ç¶™ç¶šã—ã¦ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€IaaS/PaaS ã‚’åˆ©ç”¨ã™ã‚‹éš›ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ã¨ã—ã¦ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠã‚Šã€ãƒ¦ãƒ¼ã‚¶ã¸ã‚ˆã‚Šå®‰å…¨ãªåˆ©ç”¨æ–¹æ³•ã‚’æç¤ºã—ã¦ãã‚Œã¾ã™ã€‚
  > [CSPM ã¨ã¯ï¼Ÿã‚¯ãƒ©ã‚¦ãƒ‰ã®è¨­å®šãƒŸã‚¹é˜²æ­¢ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ï½œé¸å®šã§å¤±æ•—ã—ãªã„ï¼“ã¤ã®ãƒã‚¤ãƒ³ãƒˆ](https://www.nri-secure.co.jp/blog/preventing-cloud-configuration-mistakes-with-cspm)

### Cloud Security Command Center

> Security Command Centerï¼ˆä»¥ä¸‹ SCCï¼‰ã¯ã€Google Cloud ã®çµ„ç¹”é…ä¸‹ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã„ã¦ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã®ã‚ã‚‹è¨­å®šã‚„ã€è„†å¼±æ€§ï¼ˆã‚¢ãƒ—ãƒªã‚‚å«ã‚€ï¼‰ã‚’è¦‹ã¤ã‘ã¦ãã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ è¦‹ã¤ã‘ãŸçµæžœã‚’è¡¨ç¤ºã™ã‚‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½ã‚‚ã‚ã‚Šã¾ã™ã€‚ ãªãŠã€SCC ã¯[çµ„ç¹”](https://cloud.google.com/resource-manager/docs/creating-managing-organization/?hl=JA)ã«å¯¾ã—ã¦è¨­å®šã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®ãŸã‚ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½“ã§ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚
> ç„¡æ–™ã®ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ ãƒ†ã‚£ã‚¢ã¨æœ‰æ–™ã®ãƒ—ãƒ¬ãƒŸã‚¢ãƒ  ãƒ†ã‚£ã‚¢ãŒã‚ã‚Šã€ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã§ã¯ä¸€éƒ¨æ©Ÿèƒ½ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚
> | æ©Ÿèƒ½ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰å | æ©Ÿèƒ½æ¦‚è¦ | ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ | ãƒ—ãƒ¬ãƒŸã‚¢ |
> | -------------------------- | ----------------------------------------------------- | -------------------------------------------- | ---------------------------------------------------- |
> | Security Health Analytics | å…¬é–‹ FW ãªã©ã€Google Cloud ã®è„†å¼±æ€§ã¨æ§‹æˆãƒŸã‚¹ã‚’ã«æ¤œå‡º | ä¸€éƒ¨åˆ©ç”¨å¯ï¼ˆå…¬é–‹ FW ãªã©ä¸€éƒ¨ã®è¨­å®šæ¤œçŸ¥ã®ã¿ï¼‰ | åˆ©ç”¨å¯ï¼ˆCIS ãªã©å„ç¨®åŸºæº–ã«å¯¾ã™ã‚‹æº–æ‹ ãƒã‚§ãƒƒã‚¯ã‚‚å«ã‚€ï¼‰ |
> | Web Security Scanner | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ | ä¸€éƒ¨åˆ©ç”¨å¯ï¼ˆå…¬é–‹ URL ã¨ IP ã‚’ã‚¹ã‚­ãƒ£ãƒ³ï¼‰ | åˆ©ç”¨å¯ï¼ˆã‚¢ãƒ—ãƒªè„†å¼±æ€§ã‚’å«ã‚ã‚¹ã‚­ãƒ£ãƒ³ï¼‰ |
> | Event Threat Detection | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ãªã©å„ç¨®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œçŸ¥ | åˆ©ç”¨ä¸å¯ | åˆ©ç”¨å¯ |
> | Container Threat Detection | ã‚³ãƒ³ãƒ†ãƒŠã¸ã®æ”»æ’ƒã‚’æ¤œçŸ¥ | åˆ©ç”¨ä¸å¯ | åˆ©ç”¨å¯ |

- Web Security Scanner
  > [Web Security Scanner](https://cloud.google.com/security-command-center/docs/concepts-web-security-scanner-overview)Â  ã§ App Engine ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦è„†å¼±æ€§ã‚’æ¤œå‡ºã—ã¾ã™ã€‚Web Security Scanner ã¯ã€App Engineã€Google Kubernetes Engineï¼ˆGKEï¼‰ã€Compute Engine ã®å„ã‚¦ã‚§ãƒ– ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è„†å¼±æ€§ã‚’ç‰¹å®šã—ã¾ã™ã€‚
  > ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€é–‹å§‹ URL ã®ç¯„å›²å†…ã«ã‚ã‚‹ã™ã¹ã¦ã®ãƒªãƒ³ã‚¯ã‚’ãŸã©ã‚Šã€ã§ãã‚‹é™ã‚Šå¤šãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¨ã‚¤ãƒ™ãƒ³ãƒˆ ãƒãƒ³ãƒ‰ãƒ©ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚ã‚¯ãƒ­ã‚¹ ã‚µã‚¤ãƒˆ ã‚¹ã‚¯ãƒªãƒ—ãƒ†ã‚£ãƒ³ã‚°ï¼ˆXSSï¼‰ã€Flash ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€æ··åˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆHTTPS å†…ã® HTTPï¼‰ã€æ›´æ–°ã•ã‚Œã¦ã„ãªã„ / å®‰å…¨ã§ã¯ãªã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã©ã€4 ã¤ã®ã‚ˆãã‚ã‚‹è„†å¼±æ€§ã«å¯¾ã—ã¦è‡ªå‹•çš„ã«ã‚¹ã‚­ãƒ£ãƒ³ã—ã€è„…å¨ã‚’æ¤œå‡ºã—ã¾ã™ã€‚
  > ã“ã‚Œã‚‰ã®åŸºæœ¬ 4 ã‚µãƒ¼ãƒ“ã‚¹ã®ã»ã‹ã€ä»¥ä¸‹ã® 3 ã¤ã‚‚çµ±åˆã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ã€æ¤œçŸ¥å†…å®¹ã‚’ SCC ä¸Šã§ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã§ã‚‚åˆ©ç”¨å¯èƒ½ã§ã™ã€‚
  > | çµ±åˆã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹å | æ©Ÿèƒ½æ¦‚è¦ |
  > | -------------------- | ------------------------------------------------------------------------------------- |
  > | Anomaly Detection | ä»®æƒ³ãƒžã‚·ãƒ³ï¼ˆVMï¼‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç•°å¸¸ï¼ˆæ¼æ´©ã•ã‚ŒãŸèªè¨¼æƒ…å ±ã‚„ã‚³ã‚¤ãƒ³ ãƒžã‚¤ãƒ‹ãƒ³ã‚°ãªã©ï¼‰ã‚’æ¤œçŸ¥ |
  > | Cloud Armor | DDoS ã‚„ XSS ãªã©ã®æ”»æ’ƒã‚’ä¿è­· |
  > | Data Loss Prevention | æ©Ÿå¯†æ€§ã®é«˜ã„ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œå‡ºã€åˆ†é¡žã€ä¿è­· |
  > [Security Command Center ã‚’ä½¿ç”¨ã—ã¦ Google Cloud å†…ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œçŸ¥ã™ã‚‹ - NRI ãƒãƒƒãƒˆã‚³ãƒ  Blog](https://tech.nri-net.com/entry/gcp-scc-notification) > [Security sources | Security Command Center | Google Cloud](https://cloud.google.com/security-command-center/docs/concepts-security-sources#threats)

### Forseti Security

> Forseti ã¯ã€é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†ãŒ GCP å…¨ä½“ã«è¡Œãæ¸¡ã£ã¦ã„ã‚‹ã¨ã„ã†è‡ªä¿¡ã¨å®‰å¿ƒæ„Ÿã‚’ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒãƒ¼ãƒ ã«ä¸Žãˆã‚‹ã“ã¨ã‚’ç›®æ¨™ã¨ã—ã¦ä½œã‚‰ã‚ŒãŸã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ„ãƒ¼ãƒ«ã‚­ãƒƒãƒˆã§ã™ã€‚Forseti ã«ã¯æ¬¡ã®ã‚ˆã†ãªæœ‰ç”¨ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒ„ãƒ¼ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

- Inventory : æ—¢å­˜ã® GCP ãƒªã‚½ãƒ¼ã‚¹ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚
- Scanner : GCP ãƒªã‚½ãƒ¼ã‚¹å…¨ä½“ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒãƒªã‚·ãƒ¼ãŒé©åˆ‡ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
- Enforcer : GCP ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹å•é¡Œã®ã‚ã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã‚’å–ã‚Šé™¤ãã¾ã™ã€‚
- Explain : GCP ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦èª°ãŒã©ã®ã‚ˆã†ãªã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’æŒã¤ã‹ã‚’åˆ†æžã—ã¾ã™ã€‚
  [Spotify ã¨ Google ãŒå…±åŒé–‹ç™º : ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã® GCP ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒ„ãƒ¼ãƒ« Forseti Security | Google Cloud Blog](https://cloud.google.com/blog/ja/products/gcp/with-forseti-spotify-and-google-release-gcp-security-tools-to-open-source-community15)

### SCC ã¨ Forseti ã®é•ã„

![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled30.png)

> can have a historical record of what was running in Google Cloud Platform at any point in time.
>
> Security Command Center will only scan resources once a day while forseti can scan them as frequently as you establish.
>
> Also Cloud Security Command Center only includes projects in an active state, while Forseti Inventory includes projects all possible states.
> â‡’ Forseti ã¯ Security Command Center ã« connect ã‚‚ã§ãã€ã‚ã‚‰ã‚†ã‚‹æ™‚ç‚¹ã®å…¨å±¥æ­´ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¿æŒã—ã¦ã„ã‚‹ï¼
> â‡” Security Command Center ã¯ä¸€æ—¥ä¸€å›žã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã®ã¿ã€‚

:::

:::details Network Intelligence Center vs Security Command Center

### Security Command Centerï¼ˆSCCï¼‰

Security Health Analyticsã€Web Security Scannerã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼è£½å“é€£æºï¼ˆForseti, Splunk..etcï¼‰ã€ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†ã€Event Threat Detectionã€Container Threat Detectionã€ ç¶™ç¶šçš„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### Network Intelligence Center

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒãƒ­ã‚¸ãƒ¼ã€æŽ¥ç¶šãƒ†ã‚¹ãƒˆã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚¤ãƒ³ã‚µã‚¤ãƒˆ

- ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
  Network Intelligence Center ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¸€ã¤ã€‚**æŒ‡æ¨™ãƒ¬ãƒãƒ¼ãƒˆã¨ã‚¤ãƒ³ã‚µã‚¤ãƒˆ ãƒ¬ãƒãƒ¼ãƒˆ**ã‚’æä¾›ã™ã‚‹ã€‚ã“ã® 2 ã¤ã®ãƒ¬ãƒãƒ¼ãƒˆã«ã¯ã€VPC ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®ä½¿ç”¨çŠ¶æ³ã¨ã€ã•ã¾ã–ã¾ãªãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« ãƒ«ãƒ¼ãƒ«ãŒä¸Žãˆã‚‹å½±éŸ¿ã«ã¤ã„ã¦ã®æƒ…å ±ãŒå«ã¾ã‚Œã‚‹ã€‚
  æ§‹æˆèª¤ã‚Šç™ºè¦‹ã€ç·©ã™ãŽã‚‹ãƒ«ãƒ¼ãƒ«ã®ä¿®æ­£ã€ç‰¹å®šã®ãƒ«ãƒ¼ãƒ«ãƒ’ãƒƒãƒˆæ•°ã€ã»ã‹ã®ãƒ«ãƒ¼ãƒ«ã§éš ã•ã‚Œã¦ã„ã‚‹ã‚·ãƒ£ãƒ‰ã‚¦ãƒ«ãƒ¼ãƒ«ã®æ¤œå‡ºã€ãªã©ã€‚
  [ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’ä½¿ç”¨ã—ãŸãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« ãƒ«ãƒ¼ãƒ«ã®ç®¡ç† | Google Cloud Blog](https://cloud.google.com/blog/ja/products/identity-security/eliminate-firewall-misconfigurations-with-firewall-insights)
  :::

  :::details Secret Manager vs Hashicorp Vault

- Secret Manager
  Secret Manager helps save confidential details such as passwords and URLs. You can provide access to secrets using Cloud IAM. Secret Manager lets organizations share configured secrets instead of confidential information with developers.
- Hashicorp Vault
  **Hashicorp Vault** is the best option for secure storage with automatic, scheduled secrets rotation. Cloud Key Management Service does **not** support automatic rotation of **asymmetric keys.**
  ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled31.png)
  :::

:::details CSEK ã¯ GCS ã¨ GCE ã®ã¿ã§ä½¿ãˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ï¼BigQuery ã¨ã‹ã§ã¯ä½¿ãˆãªã„ã€‚
CSEK ã§ã¯ GCS or GCE ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†ã¨ãã«é¡§å®¢è‡ªèº«ãŒ API call ã¨ä¸€ç·’ã«éµã‚’æ¸¡ã™ã€‚ã¤ã¾ã‚Šçµå±€ GCP ã«éµã¯æ¸¡ã‚‹ã€‚ãŒã€Google ã¯ãã‚Œã‚’ãƒ¡ãƒ¢ãƒªä¸Šã§ã®ã¿ä½¿ã„ã€storage ã«ã¯æ›¸ãè¾¼ã¾ãªã„ã€‚

> CSEK are not supported in BigQuery at the time of writing and are only available for Cloud Storage and Compute Engine services
> â‡’ BigQuery ã®å ´åˆã€CMEK ã‚’æ¤œè¨Žã™ã‚‹ã€‚

### ã‚­ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³

Each key created in Cloud KMS holds a key version, and each key version holds a state.

1. *Pending generation*Â (`PENDING_GENERATION`)

   (Applies to asymmetric keys only.) This key version is still being generated. It may not be used, enabled, disabled, or destroyed yet. Cloud Key Management Service will automatically change the state to enabled as soon as the version is ready.

2. *Enabled*Â (`ENABLED`)

   The key version is ready for use.

3. *Disabled*Â (`DISABLED`)

   This key version may not be used, but the key material is still available, and the version can be placed back into the enabled state.

4. **_Scheduled for destruction_**Â (`DESTROY_SCHEDULED`)

   This key version is scheduled for destruction, and will be destroyed soon.Â **It can be placed back into the disabled state.**

5. *Destroyed*Â (`DESTROYED`)

   This key version is destroyed,Â **and the key material is no longer stored in Cloud KMS**. If the key version was used for asymmetric or symmetric encryption, any ciphertext encrypted with this version is not recoverable. If the key version was used for digital signing, new signatures cannot be created. Additionally, for all asymmetric key versions, the public key is no longer available for download. A key version may not leave the destroyed state once entered.
   ![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled32.png)
   :::

:::details Gsuite ã¯ â—‹â—‹ application?
GSuite is provided by google as a **SaaS** application. The following picture shows the shared responsibility model for SaaS apps provided by GCP:
![https://img-c.udemycdn.com/redactor/raw/test_question_description/2021-01-23_09-36-48-8c55739b0561ddecab7400d2321ef926.png](https://img-c.udemycdn.com/redactor/raw/test_question_description/2021-01-23_09-36-48-8c55739b0561ddecab7400d2321ef926.png)
Network security is provided out of the box by google in both PaaS and SaaS models, so It's not necessary for the customers to configure anything related to network security for GSuite.

> GSuite is provided by google as a SaaS application.
> â‡’ Gsuites ã®ã‚ˆã†ãª saas ã§ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ Google ã®è²¬ä»»ç¯„å›²

:::

:::details ä»®æƒ³ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã¨ã¯ï¼Ÿ
ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ï¼šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§ç‰¹å®šã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹å°‚ç”¨ã®æ©Ÿå™¨
**ä»®æƒ³ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ï¼š**ä»®æƒ³åŒ–æŠ€è¡“ã‚’ç”¨ã„ã¦ã€ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹æ©Ÿèƒ½ãŒç¨¼åƒã™ã‚‹ç’°å¢ƒã‚’å³åº§ã«æ§‹æˆã§ãã‚‹ã‚ˆã†ã«ã—ãŸã‚‚ã®ã€‚**[ä»®æƒ³ãƒžã‚·ãƒ³](https://e-words.jp/w/VM.html)**ï¼ˆVMï¼‰ã®**[ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«](https://e-words.jp/w/%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8.html)**ãªã©ã¨ã—ã¦æä¾›ã•ã‚Œã‚‹ã€‚
ä¾‹ï¼‰Cisco ãƒ«ãƒ¼ã‚¿ã® VMWare ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã€NGFW ã®ã‚¤ãƒ¡ãƒ¼ã‚¸
:::
:::details NGFW ã¨ã¯ï¼Ÿ \***\*æ¬¡ä¸–ä»£ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« Â ã€next generation firewallã€‘Â NGFW\*\***

> å¾“æ¥ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¯ã€é€šä¿¡ç›¸æ‰‹ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€é€ä¿¡å…ƒã‚„å®›å…ˆã®**[ãƒãƒ¼ãƒˆç•ªå·](https://e-words.jp/w/%E3%83%9D%E3%83%BC%E3%83%88%E7%95%AA%E5%8F%B7.html)**ã€**[TCP](https://e-words.jp/w/TCP.html)**ã®é€šä¿¡çŠ¶æ…‹ã«çŸ›ç›¾ãŒãªã„ã‹ï¼ˆ**[ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ãƒ‘ã‚±ãƒƒãƒˆã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³](https://e-words.jp/w/%E3%82%B9%E3%83%86%E3%83%BC%E3%83%88%E3%83%95%E3%83%AB%E3%83%91%E3%82%B1%E3%83%83%E3%83%88%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%9A%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3.html)**ï¼‰ãªã©ã‚’å…ƒã«é€šä¿¡ã®è¨±å¯ã‚„æ‹’å¦ã‚’åˆ¤æ–­ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã ã£ãŸã€‚
> æ¬¡ä¸–ä»£ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¯ã“ã‚Œã«åŠ ãˆã€**[ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤](https://e-words.jp/w/%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E5%B1%A4.html)**ï¼ˆHTTP ãªã©ï¼‰ã®é€šä¿¡å†…å®¹ã‚’è§£æžï¼ˆ**[ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ‘ã‚±ãƒƒãƒˆã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³](https://e-words.jp/w/%E3%83%87%E3%82%A3%E3%83%BC%E3%83%97%E3%83%91%E3%82%B1%E3%83%83%E3%83%88%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%9A%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3.html)**ï¼‰ã—ã€ã©ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒé€šä¿¡ã‚’è©¦ã¿ã¦ã„ã‚‹ã®ã‹ã‚’è­˜åˆ¥ã—ãŸã‚Šã€å¤–éƒ¨ã‹ã‚‰ã®ä¸å¯©ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’æŽ¢çŸ¥ï¼ˆ**[IDS](https://e-words.jp/w/IDS.html)**/**[IPS](https://e-words.jp/w/IPS.html)**ï¼šä¾µå…¥æ¤œçŸ¥/é˜²æ­¢ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã—ã€å¯å¦ã®åˆ¤æ–­ã«åŠ ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
> [æ¬¡ä¸–ä»£ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¨ã¯ - IT ç”¨èªžè¾žå…¸](https://e-words.jp/w/%E6%AC%A1%E4%B8%96%E4%BB%A3%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB.html)

:::

:::details Cloud Healthcare API

> **HIPAAï¼ˆHealth Insurance Portability and Accountability Actï¼‰**ã¯ã€ŒåŒ»ç™‚ä¿é™ºã®æºè¡Œæ€§ã¨è²¬ä»»ã«é–¢ã™ã‚‹æ³•å¾‹ã€ã¨è¨³ã•ã‚Œã€ã€Œä¿è­·å¯¾è±¡ä¿é™ºæƒ…å ±ï¼ˆ**PHIï¼šProtected health information**ï¼‰ã€ã‚’æ‰±ã†ä¼æ¥­ã«ç‰©ç†çš„ã€ãƒ‡ã‚¸ã‚¿ãƒ«ä¸Šã§ã€ãŠã‚ˆã³æ‰‹ç¶šãä¸Šã§ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¼å¯¾ç­–ã‚’è¬›ã˜ã€ãã‚Œã«å¾“ã†ã“ã¨ã‚’è¦å®šã—ã¦ã„ã¾ã™ã€‚
> The Cloud Healthcare API has a de-identification module to redact patient information and is already HIPAA-compliant. You can then use Dataflow to read the information from source and write into a target bucket with anonymization for further analysis.
> Summary:
> The Cloud Healthcare API and the Google Cloud Healthcare Data Protection Toolkit can be used to maintain HIPAA compliance for data storage, application development, data analysis, and machine learning. The Google Cloud Healthcare Data Protection Toolkit helps you set up HIPAA-compliant architecture using an infrastructure-as-a-code script (IaaS). The Cloud Healthcare API is a fully managed HIPAA-compliant service that contains a de-identification module, along with security built around location and privacy.

:::

:::details ISO27017 ã¨ã¯ï¼Ÿ

### ISO27001

ã€Œæƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å…¨èˆ¬ã«é–¢ã™ã‚‹ãƒžãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ è¦æ ¼ã€
ISO 27001 outlines and provides the requirements for an information security management system (ISMS), specifies a set of best practices, and details the security controls that can help manage information risks but it's not specific to cloud

### ISO27017

ã€Œã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã™ã‚‹æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†ç­–ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³è¦æ ¼ã€

### ISO27018

ã€Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¦ãƒ‰ã«ãŠã‘ã‚‹å€‹äººæƒ…å ±ä¿è­·ä½“åˆ¶ã€
ISO 27018 relates to one of the most critical components of cloud privacy: the protection of personally identifiable information (PII)

:::

:::details SLAã€SLOã€RPOã€RTO ã«ã¤ã„ã¦ãã‚Œãžã‚Œç°¡æ½”ã«èª¬æ˜Žã›ã‚ˆã€‚

### SLA

SLA ã¨ã¯ã€ŒService Level Agreementã€ã®ç•¥ã§ã€**ã€Œã‚µãƒ¼ãƒ“ã‚¹å“è³ªä¿è¨¼ã€ã‚’æ„å‘³ã™ã‚‹ã€‚**
ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹äº‹æ¥­è€…ãŒã‚µãƒ¼ãƒ“ã‚¹ã®å¥‘ç´„è€…ã«å¯¾ã—ã€ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã®å¥‘ç´„ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã®å¥‘ç´„æ›¸ã§ã¯ã€ä»˜å±žè³‡æ–™ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã€‚
SLA is the entire agreement that specifies what service is to be provided, how it is supported, times, locations, costs, performance, penalties, and responsibilities of the parties involved.

### SLO

SLOs are specific, measurable characteristics of the SLA, such as availability, throughput, frequency, response time, or quality.
**An SLA can contain many SLOs**.

### RTO

RTO(Recovery Time Objectiveï¼šç›®æ¨™å¾©æ—§æ™‚é–“)

### RPO

RPO(Recovery Point Objectiveï¼šç›®æ¨™å¾©æ—§ãƒã‚¤ãƒ³ãƒˆ)
å¤±ã‚ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®æœ€å¤§è¨±å®¹é‡ã®æ¸¬å®šå€¤
![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled33.png)
![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled34.png)
:::
:::details PCI DSS scope ã‚’ reduce ã™ã‚‹ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯ï¼Ÿ
Payment Card Industry Data Security Standardï¼ˆ**PCI DSS**ï¼‰

> _PCI DSS ã¯ã€PCI Security Standards Council ã§æŽ¡æŠžã•ã‚ŒãŸä¸€é€£ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŠã‚ˆã³ãƒ“ã‚¸ãƒã‚¹ä¸Šã®ãƒ™ã‚¹ãƒˆ ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«ã‚ˆã£ã¦æ§‹æˆã•ã‚Œã€ãŠå®¢æ§˜ã®æ±ºæ¸ˆã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã®ã€Œæœ€å°é™ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæº–ã€ãŒå®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™_ > [PCI Data Security Standard compliance | Cloud Architecture Center | Google Cloud](https://cloud.google.com/architecture/pci-dss-compliance-in-gcp#setting_up_your_payment-processing_environment)
> the recommendation is to segregate cardholder data environment into a separate project. That way you can implement all required measures to be compliant with PCI-DSS just where those are required and you will avoid mixing highly secure environments with less secure ones. This will effectively reduce the attack surface for payment systems.Â  Google also recommends that in its official documentation:
> This section describes how to set up your payment-processing environment. Setup includes the following:

- **Creating a new Google Cloud account to isolate your payment-processing environment from your production environment.**
- Restricting access to your environment.
- Setting up your virtual resources.
- Designing the base Linux image that you will use to set up your app servers.
- Implementing a secure package management solution.
  :::
  :::details Forensic investigations toolsï¼Ÿ
  > Summary:
  > When you create a GKE cluster, Cloud Logging is enabled by default. Both Google Cloud and the Kubernetes ecosystem provide a range of tools for forensic investigations and audit. Cloud Logging, Docker-explorer, and Kubectl Sysdig Capture plus Sysdig Inspect provide forensic mechanisms. Use Docker-explorer for offline containers, and use Kubectl Sysdig Capture to trigger system events. Cloud Logging stores Firewall rules but not data access rules by default.

### ãƒ•ã‚©ãƒ¬ãƒ³ã‚¸ãƒƒã‚¯ï¼ˆforensicï¼‰

ç›´è¨³ã™ã‚‹ã¨ã€Œæ³•å»·ã®ã€ã¨ã„ã†æ„å‘³ã€‚è¨€ã„æ›ãˆã‚‹ã¨ã€Œé‘‘è­˜ã€ã€‚é‘‘è­˜ã¨ã¯ã€äº¤é€šäº‹æ•…ã‚„åˆ‘äº‹äº‹ä»¶ãŒèµ·ããŸéš›ã«ã€ç­†è·¡ãƒ»æŒ‡ç´‹ãƒ»è¡€ç—•ãªã©ã®éºç•™ç‰©ã‚’é‘‘å®šã—ãŸæœæŸ»ã«å½¹ç«‹ã¦ã‚‹ãŸã‚ã®ä½œæ¥­ã§ã€ã“ã®è¨€è‘‰ã‚’ãƒ‡ã‚¸ã‚¿ãƒ«åˆ†é‡Žã«ç½®ãæ›ãˆãŸã®ãŒã€ï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ï¼‰ãƒ•ã‚©ãƒ¬ãƒ³ã‚¸ãƒƒã‚¯ã€‚ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚„ãã®ä»–ã®ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒã«ã‚ˆã£ã¦è¢«å®³ã‚’å—ã‘ãŸä¼æ¥­ã‚„å€‹äººãŒã€æ³•çš„è¨¼æ‹ ã‚’æŠ¼ã•ãˆã‚‹ãŸã‚ã«å®Ÿæ–½ã™ã‚‹ãƒ‡ã‚¸ã‚¿ãƒ«çš„ãªé‘‘è­˜ã®ã“ã¨ã€‚

### Docker-explorer

This project helps a forensics analyst explore offline Docker filesystems.

### Sysdig

![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled35.png)
![Untitled](/images/20221015_professional-cloud-security-engineer/Untitled36.png)
:::
:::details ãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆæ€§ç›£è¦–(FIM)ã¨ã¯ï¼Ÿ
file integrity monitoring : FIM
[Sysdig](https://www.scsk.jp/sp/sysdig/blog/sysdig_secure/post_3.html)

> ãƒ•ã‚¡ã‚¤ãƒ«ã®æ•´åˆæ€§ç›£è¦–ã«ã‚ˆã‚Šã€æ©Ÿå¯†æ€§ã®é«˜ã„ãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢é€£ã™ã‚‹ã™ã¹ã¦ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’å¯è¦–åŒ–ã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãŒæ‚ªæ„ã®ã‚ã‚‹æ”»æ’ƒãªã®ã‹ã€è¨ˆç”»å¤–ã®é‹ç”¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãªã®ã‹ã«é–¢ä¿‚ãªãã€é‡è¦ãªã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€**ä¸æ­£ãªå¤‰æ›´ã®æ”¹ã–ã‚“ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚**

:::

---

## ç”¨èªž

:::details Bastion
è¸ã¿å°
:::
:::details Attestation
è¨¼è¨€ã€ç«‹è¨¼ã€è¨¼æ˜Ž
attestation ã¯ã€attest ã¨ã„ã†å‹•è©žã‹ã‚‰æ´¾ç”Ÿã•ã›ãŸåè©žã€‚
attest ã¨ã„ã†å‹•è©žãŒã€ŒçœŸå®Ÿã§ã‚ã‚‹ã¨æ–­è¨€ã™ã‚‹ã“ã¨ã€ã¨ã„ã†æ„å‘³ã‚’æŒã¤ã“ã¨ã‹ã‚‰ã‚‚ã†ã‹ãŒãˆã‚‹ã‚ˆã†ã«ã€æ³•å»·ã§å®£èª“ã®ä¸‹ã«è¨¼è¨€ã™ã‚‹ã‚ˆã†ãªå ´åˆã«ç”¨ã„ã‚‰ã‚Œã‚‹èªžã€‚
ã ã‹ã‚‰ã€attestation ã¯ã€Œè¨¼è¨€ã€ã¨ã„ã†æ„å‘³ã§ç”¨ã„ã‚‰ã‚Œã‚‹æ–¹ãŒæ™®é€šã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
:::
:::details ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª

ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªï¼ˆInventoryï¼‰ã¨ã¯ã€å…ƒã€…ã€Œç›®éŒ²ã€ã€Œä¿æœ‰è³‡ç”£ã€ã¨ã„ã£ãŸæ„å‘³ã® inventory ãŒèªžæºã¨ãªã£ã¦ãŠã‚Šã€Â LAN ä¸Šã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ PC ã‚„æŽ¥ç¶šæ©Ÿå™¨ãŒæŒã¤ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€è¦§ã«ã—ãŸã‚‚ã®ã‚’æŒ‡ã™ã€‚ã€ŒIT è³‡ç”£ç®¡ç†ã€ãªã©ã®ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚„ PCã€ã‚µãƒ¼ãƒã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãªã©ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚„ãƒ«ãƒ¼ã‚¿ã‚„ã‚¹ã‚¤ãƒƒãƒãªã©ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿå™¨ã€ãã®ä»–ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æŽ¥ç¶šã•ã‚Œã¦ã„ã‚‹å‘¨è¾ºæ©Ÿå™¨ã®ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæƒ…å ±ã‚’è‡ªå‹•åŽé›†ã—ã€è³‡ç”£æƒ…å ±ã¨ã—ã¦ç®¡ç†ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚å–å¾—ã™ã‚‹ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæƒ…å ±ã¯ã€æ©Ÿå™¨ã®æ©Ÿç¨®ã€MAC ã‚¢ãƒ‰ãƒ¬ã‚¹ã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€CPU ã®åž‹ç•ªã‚„ãƒ¡ãƒ¢ãƒªã€ãƒãƒ¼ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã€åˆ©ç”¨å±¥æ­´ãªã©ã€å¤šãã®æƒ…å ±ã‚’åŽé›†ã€ç®¡ç†ã™ã‚‹ã€‚

:::
:::details ã‚ªãƒªã‚¸ãƒ³ã‚µãƒ¼ãƒãƒ¼
ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå­˜åœ¨ã™ã‚‹ Web ã‚µãƒ¼ãƒãƒ¼ã®ã“ã¨ã€‚
è‡ªç¤¾ãƒšãƒ¼ã‚¸ãªã©ã‚’å…¬é–‹ã™ã‚‹éš›ã«ã€ãƒšãƒ¼ã‚¸ã‚’é…ç½®ã—ãŸã‚µãƒ¼ãƒã«ç›´æŽ¥ã‚¢ã‚¯ã‚»ã‚¹ã•ã›ã‚‹ã®ã§ã¯ãªã WAF ã‚„ CDN ãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµŒç”±ã•ã›ã¦ã‚¢ã‚¯ã‚»ã‚¹ã•ã›ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã¨ã—ãŸã¨ãã«ã€WAF ã‚„ CDN ã‹ã‚‰è¦‹ãŸæŽ¥ç¶šå…ˆã¨ãªã‚‹ã‚µãƒ¼ãƒã‚’ã‚ªãƒªã‚¸ãƒ³ã‚µãƒ¼ãƒã¨å‘¼ã¶ã€‚
CDN ã‚’åˆ©ç”¨ã—ãŸå ´åˆã€ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚ªãƒªã‚¸ãƒ³ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ã§ã¯ãªãã€CDN ã®ã‚µãƒ¼ãƒï¼ˆ**ã‚¨ãƒƒã‚¸ã‚µãƒ¼ãƒãƒ¼**ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚
[ã‚ªãƒªã‚¸ãƒ³ã‚µãƒ¼ãƒãƒ¼ã¨ã¯ãªã‚“ã§ã™ã‹ï¼Ÿ](https://support.cdnext.stream.co.jp/hc/ja/articles/360001787832-%E3%82%AA%E3%83%AA%E3%82%B8%E3%83%B3%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A8%E3%81%AF%E3%81%AA%E3%82%93%E3%81%A7%E3%81%99%E3%81%8B-)
:::
:::details PCI DSS
Payment Card Industry Data Security Standardï¼ˆ**PCI DSS**ï¼‰

> _PCI DSS ã¯ã€PCI Security Standards Council ã§æŽ¡æŠžã•ã‚ŒãŸä¸€é€£ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŠã‚ˆã³ãƒ“ã‚¸ãƒã‚¹ä¸Šã®ãƒ™ã‚¹ãƒˆ ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«ã‚ˆã£ã¦æ§‹æˆã•ã‚Œã€ãŠå®¢æ§˜ã®æ±ºæ¸ˆã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã®ã€Œæœ€å°é™ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæº–ã€ãŒå®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™_ > [PCI Data Security Standard compliance | Cloud Architecture Center | Google Cloud](https://cloud.google.com/architecture/pci-dss-compliance-in-gcp#setting_up_your_payment-processing_environment)

:::

:::details PII
personally identifiable information (PII)
:::

:::details ephemeral
ä¸€æ™‚çš„ãª
:::

:::details 3-tier
3 å±¤
web-tier ã‚¦ã‚§ãƒ–å±¤
Tier ã¯åŒºåˆ†ã¨ã„ã†æ„å‘³ã‚‚ã‚ã‚‹ã€‚
premium/standard tier ã¨ã‹ã€‚
:::

:::details ASN
BGP ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã® AS ç•ªå·
å¯¾å‘ã§è¨­ç½®ã™ã‚‹ã¿ãŸã„
:::
