---
title: "BigQueryãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾ã—ã¦ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§DMLã‚’ç™ºè¡Œã™ã‚‹ã¨ãã«ç™ºç”Ÿã™ã‚‹ã‚¨ãƒ©ãƒ¼èª¿æŸ»"
emoji: ğŸ‘€
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["BigQuery"]
published: true
---

## å•é¡Œ

BigQuery ã®ãƒ‡ãƒ¼ã‚¿åŸºç›¤é‹ç”¨ä¸­ã«ã€æ—¢å­˜ã® ETL ã‚µãƒ¼ãƒãƒ¼ã®ä¸å…·åˆã«ã‚ˆã‚Šã€æ™‚æŠ˜ãƒ¬ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ãŒç™ºç”Ÿã—ã¦ã„ãŸã€‚åŸå› ã‚’èª¿æŸ»ã—ãŸçµæœã€BigQuery ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾ã—ã¦ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§ DELETEâ†’INSERT ã«ã‚ˆã‚‹ UPDATE å‡¦ç†ã‚’è¡Œã£ã¦ã„ã¦ã€ãã“ã§ã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†ãŒå®Œäº†ã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã€‚ãã®çµæœã€DELETE å‡¦ç†å®Œäº†å‰ã« INSERT å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã€é‡è¤‡ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒç™ºç”Ÿã—ã¦ã„ãŸã€‚

ã“ã®å•é¡Œã«ã¤ã„ã¦ã€è©³ç´°ã‚’èª¿æŸ»ã—ã¦ã¿ãŸã€‚

## åŸå› ã®èª¿æŸ»

å­ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã® DML ç™ºè¡Œç®‡æ‰€ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã€‚

ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®ãƒ­ã‚°ã‚’èª¿æŸ»ã—ãŸã¨ã“ã‚ã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã€‚

```
 Could not serialize access to table due to concurrent update
```

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯æ¬¡ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆã«è©²å½“ã™ã‚‹ã€‚

> This error can occur when mutating data manipulation language (DML) statements that are running concurrently on the same table conflict with each other, or when the table is truncated during a mutating DML statement. For more information, see DML statement conflicts.

https://cloud.google.com/bigquery/docs/troubleshoot-queries?hl=ja#could_not_serialize_access_to_table_due_to_concurrent_update

ä¸Šè¨˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒªãƒ³ã‚¯ã¸é£›ã¶ã¨ã€ä»¥ä¸‹ã®è¨˜è¿°ãŒã‚ã‚‹ã€‚**åŒä¸€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹åŒæ™‚æ›´æ–°ã¯ç«¶åˆã™ã‚‹**ã‚‰ã—ã„ã€‚

> Mutating DML statements that run concurrently on a table cause DML statement conflicts when the statements try to mutate the same partition. The statements succeed as long as they donâ€™t modify the same partition. BigQuery tries to rerun failed statements up to three times.

https://cloud.google.com/bigquery/docs/reference/standard-sql/data-manipulation-language#dml_statement_conflicts

ï¼ˆä»¥ä¸‹ã€æ¨æ¸¬ï¼‰

ãã‚‚ãã‚‚ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åˆ†å‰²ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã¯ãªã„ãŒã€ãã®å ´åˆã€ãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“ãŒ 1 ã¤ã®å¤§ããªãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ãŸã‚ã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åˆ†å‰²ã§ã¯ãªã„ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã‚‚åŒæ™‚æ›´æ–°ãŒç«¶åˆã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

è¨€ã„æ›ãˆã‚Œã°ã€DML æ–‡ã®ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œã¯ä¿è¨¼ã•ã‚Œã¦ã„ãªã„ã“ã¨ã«ãªã‚‹ã®ã§ã¯ï¼Ÿ

Google Cloud ãƒ–ãƒ­ã‚°ã«ã‚ˆã‚‹ã¨ã€BigQuery ã¯ DML ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®å®Ÿè¡Œã«éš›ã—ã¦ã€ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ­ãƒƒã‚¯ã§ã¯ãªãã€**æ¥½è¦³çš„ä¸¦è¡Œæ€§åˆ¶å¾¡ï¼ˆoptimistic concurrency controlï¼‰**ã¨ã„ã†æ–¹æ³•ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã€‚ã‚¯ã‚¨ãƒªã‚¸ãƒ§ãƒ–é–‹å§‹æ™‚ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŸºæº–ã«ã€DML ã®å‡¦ç†çµæœã‚³ãƒŸãƒƒãƒˆæ™‚ã®å¤‰æ›´å·®åˆ†ã‚’ç®—å‡ºã—ã¦ã€ä»–ã®ã‚¸ãƒ§ãƒ–ã«ã‚ˆã‚‹å¤‰æ›´å†…å®¹ã¨ç«¶åˆã—ãªã„ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã€‚ä»¥å‰ã¯ç«¶åˆãŒç™ºç”Ÿã—ãŸå ´åˆã€ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§å¯¾å‡¦ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã‚‰ã—ã„ãŒã€ç¾åœ¨ã¯åŸºæº–ã¨ãªã‚‹ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ›´æ–°ã—ãŸä¸Šã§ã€3 å›ã¾ã§ãƒªãƒˆãƒ©ã‚¤ã™ã‚‹ã®ã§ã€ã‚¨ãƒ©ãƒ¼æ•°ã¯å¤§å¹…ã«å°‘ãªããªã£ãŸã‚‰ã—ã„ã€‚
https://cloud.google.com/blog/ja/products/data-analytics/dml-without-limits-now-in-bigquery

ä¸Šè¨˜ã‚’è¸ã¾ãˆã‚‹ã¨ã€BigQuery ã®æ¥½è¦³çš„ä¸¦è¡Œæ€§åˆ¶å¾¡ã¨ã„ã†ä»•çµ„ã¿ä¸Šã€å¤šãã® DML ã‚’ä¸¦åˆ—ã§å®Ÿè¡Œã™ã‚‹ç¨‹ã€é«˜ã„ç¢ºç‡ã§ DML ã®ç«¶åˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚**DML æ–‡ã¯æœ¬è³ªçš„ã«ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œã‚’ä¿è¨¼ã§ããªã„ã€‚**

## å®Ÿéš›ã«æ¤œè¨¼

å®Ÿéš›ã€ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯ DML ãŒç«¶åˆã—ã€ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯ç«¶åˆã—ãªã„ã®ã‹ã€æ¤œè¨¼ã—ã¦ã¿ãŸã€‚

- ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯ã‚¹ãƒ¬ãƒƒãƒ‰æ•°ã„ãã¤ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã‹ï¼Ÿ

  - **2 ã‚¹ãƒ¬ãƒƒãƒ‰ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ãŒå‡ºå§‹ã‚ã‚‹ã€‚**
  - ã‚¹ãƒ¬ãƒƒãƒ‰æ•°ã‚’å¢—ã‚„ã™ã¨ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç¢ºç‡ãŒä¸ŠãŒã£ã¦ã„ãã€‚
  - 2,3 ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯å¤šã‚ã«ã‚¿ã‚¹ã‚¯ã‚’ç©ã¾ãªã„ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã€‚

- å¤§é‡ã® DELETE ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ–‡ã‚’ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§ç™ºè¡Œã™ã‚‹ã¨ã©ã†ãªã‚‹ã‹ï¼Ÿ

  - æ¬¡ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€‚

  ```
  Error: 400 Resources exceeded during query execution: Too many DML statements outstanding against table xxx, limit is 20
  ```

  â‡’ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã‚ã‚Šã€‚DML ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯æœ€å¤§ 20 ã¾ã§ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã§ãã€2 ã¤ã¥ã¤å®Ÿè¡Œã•ã‚Œã‚‹

- å­˜åœ¨ã—ãªã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹ DELETE æ–‡ã‚’ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã‹ï¼Ÿ

  - ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã€‚
    â‡’ ã‚¯ã‚¨ãƒªã‚¸ãƒ§ãƒ–ã‚’ API ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã—ãŸã ã‘ã§ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã€‚å®Ÿéš›ã« åŒä¸€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹ç«¶åˆ DELETE å‡¦ç†ãŒå‹•ãã€ã‹ã¤ 3 å›ã®ãƒªãƒˆãƒ©ã‚¤ã§ã™ã¹ã¦ç«¶åˆã—ãŸå ´åˆã€ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã‚‹ã€‚

- ã‚¯ã‚¨ãƒªã‚’åˆ†å‰²ã—ã¦ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œã—ã¦ã„ã‚‹ç®‡æ‰€ã‚’ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã—ãŸå ´åˆã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã‹ï¼Ÿ

  - **ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã€‚**

- DELETE å‡¦ç†ã‚’ã€åŒä¸€ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã® ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã«ã—ã¦ã¿ã‚‹ï¼ˆå„ DELETE ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯ä¸¦åˆ—ã‚¹ãƒ¬ãƒƒãƒ‰å†…ã§å®Ÿè¡Œï¼‰ã€‚
  - ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã€‚
  ```
  Error: 400 Resources exceeded during query execution: Another job dtechlab-int:asia-northeast1.b2400ebd-84ae-4bcb-9799-49f52d433241 is currently running in the session Cg4KDGR0ZWNobGFiLWludBDJARokOWU4MGNjMzktY2YyMC00YjcyLWEzN2YtMjc5MzU5NDk0ODRh. Concurrent jobs in the same session are not allowed.
  ```
  â‡’ ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã§ã¯ä¸¦åˆ—å‡¦ç†ã¯ã§ããªã„ã‚‰ã—ã„ã€‚

https://cloud.google.com/bigquery/docs/troubleshoot-queries?hl=ja#concurrent_jobs_in_the_same_session_are_not_allowed

### çµè«–ã¨ã—ã¦ã€

- ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†ã§ã¯ã€2 ã‚¹ãƒ¬ãƒƒãƒ‰ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã†ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã€‚
- ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†ã§ã¯ã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã“ã¨ã‚’ç¢ºèªã—ãŸã€‚
- BigQuery ãŒ DML ãƒ­ãƒƒã‚¯ã‚’ä½¿ã‚ãªã„ã¨ã„ã†ä»•çµ„ã¿ä¸Šã€ä¸¦åˆ— DML æ•°ãŒå¤šã„ã»ã©ã€ç«¶åˆã‚¨ãƒ©ãƒ¼ã®ç™ºç”Ÿã¯é«˜ããªã‚‹ã€‚

## å¯¾å‡¦æ–¹æ³•

ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œã«ã™ã‚‹ã“ã¨ã§å¯¾å‡¦ã€‚å¿µã®ãŸã‚ã«ä»¥ä¸‹ã®ç¢ºèªã‚’ã—ãŸã€‚

- å®Ÿè¡Œæ™‚é–“
- 1 ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ DELETE ã§ãã‚‹æœ€å¤§ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°

ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°åˆ¶é™ã¯ 1MB
https://cloud.google.com/bigquery/quotas#query_jobs
ãªã®ã§ã€ãã‚Œã‚’ã‚‚ã¨ã«æ¦‚ç®—ã™ã‚‹ã¨ã€1 ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ DELETE ã§ãã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã¯ã€DELETE ã™ã‚‹ã‚«ãƒ©ãƒ ã‚’ç‰¹å®šã™ã‚‹è¤‡åˆã‚­ãƒ¼ã®ã‚«ãƒ©ãƒ æ•°ã‚„ã€ãƒ‡ãƒ¼ã‚¿å‹ã«ã‚‚ã‚ˆã‚‹ãŒã€2 ã‚«ãƒ©ãƒ ã®è¤‡åˆã‚­ãƒ¼ã ã¨ãŠã‚ˆã 50000 ãƒ¬ã‚³ãƒ¼ãƒ‰ãã‚‰ã„ã¾ã§ã„ã‘ãã†ã€‚

å®Ÿéš›ã«è©¦ã—ã¦ã¿ã‚‹ã¨ã€
| ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° | çµæœ | çµŒéæ™‚é–“ (ç§’) |
|------------|----------|-------------------------------|
| 10 | No Error | 3.0399248600006104 |
| 6500 | No Error | 13.780000925064087 |
| 14600 | No Error | 27.104164361953735 |
| 30000 | No Error | 187.42960047721863 |
| 50000 | ERROR | ï¼ˆä¸‹è¨˜å‚ç…§ï¼‰ |

â‡’ 50000 ãƒ¬ã‚³ãƒ¼ãƒ‰ã® DELETE ã§ã¯ã€ãƒœãƒ‡ã‚£ã‚µã‚¤ã‚ºã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã¯å‡ºãªã‹ã£ãŸãŒã€ä»¥ä¸‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã€‚1 ã¤ã®ã‚¯ã‚¨ãƒªã§ã‚ã¾ã‚Šã«å¤§é‡ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã« ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã‚‰ã—ã„ã€‚
â€» ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„

> BadRequest Error: 400 Resources exceeded during query execution: Not enough resources for query planning - too many fields accessed or query is too complex.

https://cloud.google.com/bigquery/docs/troubleshoot-queries#not_enough_resources_for_query_planning_-_too_many_subqueries_or_query_is_too_complex

### ä»¥ä¸Šã€ã¾ã¨ã‚ã‚‹ã¨

- ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã® DELETE å‡¦ç†ã®å®Ÿè¡Œæ™‚é–“ã¯ååˆ†è¨±å®¹ç¯„å›²å†…[â€»]
- ã‚¯ã‚¨ãƒªã‚’åˆ†å‰²ã—ãªãã¦ã‚‚ã€1 ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã§æ•°ä¸‡è¡Œç¨‹åº¦ã®åŒæ™‚å‰Šé™¤ãŒã§ãã‚‹ã€‚

[â€»] ã‚€ã—ã‚ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†ã¨ã»ã¼å¤‰ã‚ã‚‰ãªã„ã€‚ãªãœãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†ã«ã—ã¦ã„ãŸã®ã‹è¬ã ãŒã€ETL ã‚µãƒ¼ãƒãƒ¼å®Ÿè£…æ™‚ç‚¹ã§ã® BigQuery ã«ã¯ä½•ã‚‰ã‹ã®åˆ¶ç´„ãŒã‚ã£ãŸã®ã‹ã‚‚ã—ã‚Œãªã„

## ãã®ä»–

- ã“ã“ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã‚‚ã‚ã‚‹ã‚ˆã†ã«ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚’ä½¿ã†ã¨ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ç‰¹å®šãŒæ—©ããªã‚‹ã®ã§ã€DELETE ç”¨ã®ã‚­ãƒ¼ã¨ãªã‚‹åˆ—ã«ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚’é©ç”¨ã—ã¦ãŠãã¨ã‚ˆã•ãã†ã€‚

https://cloud.google.com/bigquery/docs/reference/standard-sql/data-manipulation-language#best_practices

- ãã‚‚ãã‚‚ åˆ—æŒ‡å‘ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚ã‚‹ BigQuery ã®è¨­è¨ˆä¸Šã€é«˜é€ŸåŒæ™‚ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ç®¡ç†ã¯ä¸€èˆ¬çš„ã§ã¯ãªã„ã®ã§ã€ãƒ‡ãƒ¼ã‚¿åŸºç›¤ã®è¨­è¨ˆæ™‚ã«ã¯ã‚ˆãæ¤œè¨ã—ãŸæ–¹ãŒã‚ˆã„ã€‚ã€‚

## é–¢é€£ã™ã‚‹åˆ¶ç´„ã¾ã¨ã‚

- DML ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯æœ€å¤§ 20 ã¾ã§ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã§ãã€2 ã¤ã¥ã¤å®Ÿè¡Œã•ã‚Œã‚‹

https://cloud.google.com/bigquery/docs/reference/standard-sql/data-manipulation-language#update_delete_merge_dml_concurrency

- DML ã¯ 10s ã‚ãŸã‚Š 25 ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¾ã§/table ã‚’è¨±å®¹

Quota and limit

https://cloud.google.com/bigquery/quotas#data-manipulation-language-statements

- ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°åˆ¶é™

  - 256 KB (unresolved legacy SQL )
  - 1MB (unresolved GoogleSQL query )

https://cloud.google.com/bigquery/quotas#query_jobs

- åŒã˜ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã®ã‚¯ã‚¨ãƒªã®åŒæ™‚å®Ÿè¡Œã¯ã‚¨ãƒ©ãƒ¼(ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯å¯èƒ½)

https://cloud.google.com/bigquery/docs/troubleshoot-queries?hl=ja#concurrent_jobs_in_the_same_session_are_not_allowed

- ã‚¯ã‚¨ãƒªãŒè¤‡é›‘ã™ãã‚‹ã€ã¾ãŸã¯ä¸€åº¦ã«å¤§é‡ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹å ´åˆã«ã‚¨ãƒ©ãƒ¼

https://cloud.google.com/bigquery/docs/troubleshoot-queries?hl=ja#not_enough_resources_for_query_planning_-_too_many_subqueries_or_query_is_too_complex
